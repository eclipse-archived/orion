/*

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation
 Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2009, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 Copyright (c) 2012 VMware, Inc.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 Andrew Eisenberg - rename to jsTemplateContentAssist.js

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation
 Alex Lakatos - fix for bug#369781

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 RequireJS i18n 1.0.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details

 Copyright (c) 2011 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
*/
var requirejs,require,define;
(function(s){function q(d,j){var v,l,a,c,h,b,f,e,m,o=j&&j.split("/"),n=r.map,g=n&&n["*"]||{};if(d&&d.charAt(0)===".")if(j){o=o.slice(0,o.length-1);d=o.concat(d.split("/"));for(e=0;e<d.length;e+=1)if(v=d[e],v===".")d.splice(e,1),e-=1;else if(v==="..")if(e===1&&(d[2]===".."||d[0]===".."))break;else e>0&&(d.splice(e-1,2),e-=2);d=d.join("/")}else d.indexOf("./")===0&&(d=d.substring(2));if((o||g)&&n){v=d.split("/");for(e=v.length;e>0;e-=1){l=v.slice(0,e).join("/");if(o)for(m=o.length;m>0;m-=1)if(a=n[o.slice(0,
m).join("/")])if(a=a[l]){c=a;h=e;break}if(c)break;!b&&g&&g[l]&&(b=g[l],f=e)}!c&&b&&(c=b,h=f);c&&(v.splice(0,h,c),d=v.join("/"))}return d}function p(k,j){return function(){return a.apply(s,d.call(arguments,0).concat([k,j]))}}function i(d){return function(j){return q(j,d)}}function c(d){return function(j){m[d]=j}}function e(d){if(t.call(n,d)){var j=n[d];delete n[d];u[d]=!0;b.apply(s,j)}if(!t.call(m,d)&&!t.call(u,d))throw Error("No "+d);return m[d]}function f(d){var j,v=d?d.indexOf("!"):-1;v>-1&&(j=
d.substring(0,v),d=d.substring(v+1,d.length));return[j,d]}function g(d){return function(){return r&&r.config&&r.config[d]||{}}}var b,a,h,o,m={},n={},r={},u={},t=Object.prototype.hasOwnProperty,d=[].slice;h=function(d,j){var v,l=f(d),a=l[0],d=l[1];a&&(a=q(a,j),v=e(a));a?d=v&&v.normalize?v.normalize(d,i(j)):q(d,j):(d=q(d,j),l=f(d),a=l[0],d=l[1],a&&(v=e(a)));return{f:a?a+"!"+d:d,n:d,pr:a,p:v}};o={require:function(d){return p(d)},exports:function(d){var j=m[d];return typeof j!=="undefined"?j:m[d]={}},
module:function(d){return{id:d,uri:"",exports:m[d],config:g(d)}}};b=function(d,j,v,l){var a,b,f,g,A=[],r,l=l||d;if(typeof v==="function"){j=!j.length&&v.length?["require","exports","module"]:j;for(g=0;g<j.length;g+=1)if(f=h(j[g],l),b=f.f,b==="require")A[g]=o.require(d);else if(b==="exports")A[g]=o.exports(d),r=!0;else if(b==="module")a=A[g]=o.module(d);else if(t.call(m,b)||t.call(n,b)||t.call(u,b))A[g]=e(b);else if(f.p)f.p.load(f.n,p(l,!0),c(b),{}),A[g]=m[b];else throw Error(d+" missing "+b);j=v.apply(m[d],
A);if(d)if(a&&a.exports!==s&&a.exports!==m[d])m[d]=a.exports;else if(j!==s||!r)m[d]=j}else d&&(m[d]=v)};requirejs=require=a=function(d,j,v,l,c){if(typeof d==="string")return o[d]?o[d](j):e(h(d,j).f);else d.splice||(r=d,j.splice?(d=j,j=v,v=null):d=s);j=j||function(){};typeof v==="function"&&(v=l,l=c);l?b(s,d,j,v):setTimeout(function(){b(s,d,j,v)},4);return a};a.config=function(d){r=d;return a};define=function(d,j,v){j.splice||(v=j,j=[]);!t.call(m,d)&&!t.call(n,d)&&(n[d]=[d,j,v])};define.amd={jQuery:!0}})();
define("almond",function(){});
define("orion/util",[],function(){var s=navigator.userAgent,q=parseFloat(s.split("MSIE")[1])||void 0,p=parseFloat(s.split("Firefox/")[1]||s.split("Minefield/")[1])||void 0,i=s.indexOf("Opera")!==-1,c=parseFloat(s.split("Chrome/")[1])||void 0,e=s.indexOf("Safari")!==-1&&!c,f=parseFloat(s.split("WebKit/")[1])||void 0,g=s.indexOf("Android")!==-1,b=s.indexOf("iPad")!==-1,s=s.indexOf("iPhone")!==-1,a=b||s,h=navigator.platform.indexOf("Mac")!==-1,o=navigator.platform.indexOf("Win")!==-1,m=navigator.platform.indexOf("Linux")!==
-1;return{formatMessage:function(a){var c=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,b){return c[(b<<0)+1]})},createElement:function(a,c){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",c):a.createElement(c)},isIE:q,isFirefox:p,isOpera:i,isChrome:c,isSafari:e,isWebkit:f,isAndroid:g,isIPad:b,isIPhone:s,isIOS:a,isMac:h,isWindows:o,isLinux:m,platformDelimiter:o?"\r\n":"\n"}});
define("orion/editor/eventTarget",[],function(){function s(){}s.addMixin=function(q){var p=s.prototype,i;for(i in p)p.hasOwnProperty(i)&&(q[i]=p[i])};s.prototype={addEventListener:function(q,p,i){if(!this._eventTypes)this._eventTypes={};var c=this._eventTypes[q];c||(c=this._eventTypes[q]={level:0,listeners:[]});c.listeners.push({listener:p,useCapture:i})},dispatchEvent:function(q){var p=q.type;this._dispatchEvent("pre"+p,q);this._dispatchEvent(p,q);this._dispatchEvent("post"+p,q)},_dispatchEvent:function(q,
p){var i=this._eventTypes?this._eventTypes[q]:null;if(i){var c=i.listeners;try{if(i.level++,c)for(var e=0,f=c.length;e<f;e++)if(c[e]){var g=c[e].listener;typeof g==="function"?g.call(this,p):g.handleEvent&&typeof g.handleEvent==="function"&&g.handleEvent(p)}}finally{if(i.level--,i.compact&&i.level===0){for(e=c.length-1;e>=0;e--)c[e]||c.splice(e,1);c.length===0&&delete this._eventTypes[q];i.compact=!1}}}},isListening:function(q){return!this._eventTypes?!1:this._eventTypes[q]!==void 0},removeEventListener:function(q,
p,i){if(this._eventTypes){var c=this._eventTypes[q];if(c){for(var e=c.listeners,f=0,g=e.length;f<g;f++){var b=e[f];if(b&&b.listener===p&&b.useCapture===i){c.level!==0?(e[f]=null,c.compact=!0):e.splice(f,1);break}}e.length===0&&delete this._eventTypes[q]}}}};return{EventTarget:s}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/util"],function(s,q){function p(i,c){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(i);this.setLineDelimiter(c)}p.prototype={find:function(i){if(this._text.length>1)this._text=[this._text.join("")];var c=i.string,e=c;!i.regex&&c&&(e=c.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"));var f=null,g;if(e){var c=i.reverse,b=i.wrap,a=i.wholeWord,h=i.caseInsensitive,o=i.start||0,m=i.end,i=i.end!==void 0,n="";n.indexOf("g")===
-1&&(n+="g");h&&n.indexOf("i")===-1&&(n+="i");a&&(e="\\b"+e+"\\b");var r=this._text[0],u,t,d=0;i&&(r=r.substring(o,m),d=o);var k=RegExp(e,n);if(c)g=function(){var j=null;for(k.lastIndex=0;;){t=k.lastIndex;u=k.exec(r);if(t===k.lastIndex)return null;if(u){if(!(u.index<o)){if(!b||j)break;o=r.length}j={start:u.index+d,end:k.lastIndex+d}}else break}if(j)o=j.start;return j};else{if(!i)k.lastIndex=o;g=function(){for(;;){t=k.lastIndex;u=k.exec(r);if(t===k.lastIndex)break;if(u)return{start:u.index+d,end:k.lastIndex+
d};if(!(t!==0&&b))break}return null}}f=g()}return{next:function(){var d=f;d&&(f=g());return d},hasNext:function(){return f!==null}}},getCharCount:function(){for(var i=0,c=0;c<this._text.length;c++)i+=this._text[c].length;return i},getLine:function(i,c){var e=this.getLineCount();if(!(0<=i&&i<e))return null;var f=this._lineOffsets[i];if(i+1<e){e=this.getText(f,this._lineOffsets[i+1]);if(c)return e;for(var f=e.length,g;(g=e.charCodeAt(f-1))===10||g===13;)f--;return e.substring(0,f)}else return this.getText(f)},
getLineAtOffset:function(i){var c=this.getCharCount();if(!(0<=i&&i<=c))return-1;var e=this.getLineCount();if(i===c)return e-1;var f,g,b=this._lastLineIndex;if(0<=b&&b<e&&(f=this._lineOffsets[b],g=b+1<e?this._lineOffsets[b+1]:c,f<=i&&i<g))return b;for(var a=e,h=-1;a-h>1;)if(b=Math.floor((a+h)/2),f=this._lineOffsets[b],g=b+1<e?this._lineOffsets[b+1]:c,i<=f)a=b;else if(i<g){a=b;break}else h=b;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},
getLineEnd:function(i,c){var e=this.getLineCount();if(!(0<=i&&i<e))return-1;if(i+1<e){e=this._lineOffsets[i+1];if(c)return e;for(var f=this.getText(Math.max(this._lineOffsets[i],e-2),e),g=f.length,b;(b=f.charCodeAt(g-1))===10||b===13;)g--;return e-(f.length-g)}else return this.getCharCount()},getLineStart:function(i){return!(0<=i&&i<this.getLineCount())?-1:this._lineOffsets[i]},getText:function(i,c){i===void 0&&(i=0);c===void 0&&(c=this.getCharCount());if(i===c)return"";for(var e=0,f=0,g;f<this._text.length;){g=
this._text[f].length;if(i<=e+g)break;e+=g;f++}for(var b=e,a=f;f<this._text.length;){g=this._text[f].length;if(c<=e+g)break;e+=g;f++}if(a===f)return this._text[a].substring(i-b,c-e);b=this._text[a].substring(i-b);e=this._text[f].substring(0,c-e);return b+this._text.slice(a+1,f).join("")+e},onChanging:function(i){return this.dispatchEvent(i)},onChanged:function(i){return this.dispatchEvent(i)},setLineDelimiter:function(i,c){i==="auto"&&(i=void 0,this.getLineCount()>1&&(i=this.getText(this.getLineEnd(0),
this.getLineEnd(0,!0))));this._lineDelimiter=i?i:q.platformDelimiter;if(c){var e=this.getLineCount();if(e>1){for(var f=Array(e),g=0;g<e;g++)f[g]=this.getLine(g);this.setText(f.join(this._lineDelimiter))}}},setText:function(i,c,e){i===void 0&&(i="");c===void 0&&(c=0);e===void 0&&(e=this.getCharCount());if(!(c===e&&i==="")){for(var f=this.getLineAtOffset(c),g=this.getLineAtOffset(e),b=c,a=e-c,h=g-f,o=i.length,m=0,n=this.getLineCount(),r=0,u=0,t=0,d=[];;){r!==-1&&r<=t&&(r=i.indexOf("\r",t));u!==-1&&
u<=t&&(u=i.indexOf("\n",t));if(u===-1&&r===-1)break;t=r!==-1&&u!==-1?r+1===u?u+1:(r<u?r:u)+1:r!==-1?r+1:u+1;d.push(c+t);m++}this.onChanging({type:"Changing",text:i,start:b,removedCharCount:a,addedCharCount:o,removedLineCount:h,addedLineCount:m});d.length===0&&(r=this.getLineStart(f),g=g+1<n?this.getLineStart(g+1):this.getCharCount(),c!==r&&(i=this.getText(r,c)+i,c=r),e!==g&&(i+=this.getText(e,g),e=g));g=o-a;for(r=f+h+1;r<n;r++)this._lineOffsets[r]+=g;f=[f+1,h].concat(d);Array.prototype.splice.apply(this._lineOffsets,
f);for(g=d=0;g<this._text.length;){r=this._text[g].length;if(c<=d+r)break;d+=r;g++}n=d;for(f=g;g<this._text.length;){r=this._text[g].length;if(e<=d+r)break;d+=r;g++}r=this._text[g];c=this._text[f].substring(0,c-n);e=r.substring(e-d);f=[f,g-f+1];c&&f.push(c);i&&f.push(i);e&&f.push(e);Array.prototype.splice.apply(this._text,f);if(this._text.length===0)this._text=[""];this.onChanged({type:"Changed",start:b,removedCharCount:a,addedCharCount:o,removedLineCount:h,addedLineCount:m})}}};s.EventTarget.addMixin(p.prototype);
return{TextModel:p}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(s,q,p){function i(c){c=c||{};this._document=c.document||document}var c={};i.getTheme=function(e){var e=e||"default",f=c[e];f||(f=c[e]=new i);return f};i.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(c,f){var g=this,b=g._themeClass;g._themeClass=c;this._load(c,f,function(){g.onThemeChanged({type:"ThemeChanged",oldValue:b,newValue:g.getThemeClass()})})},onThemeChanged:function(c){return this.dispatchEvent(c)},
buildStyleSheet:function(c,f){function g(a,f,m){b.push("."+c+" ."+a+" {");b.push("\t"+(m?"background-color":"color")+": "+f+";");b.push("}")}var b=[];b.push("");var a=f.fontFamily,a=a==="sans serif"?'"Menlo", "Consolas", "Vera Mono", "monospace"':"monospace";b.push("."+c+" {");b.push("\tfont-family: "+a+";");b.push("\tfont-size: "+f.fontSize+";");b.push("\tcolor: "+f.text+";");b.push("}");b.push("."+c+".textview {");b.push("\tbackground-color: "+f.background+";");b.push("}");g("ruler.annotations",
f.annotationRuler,!0);g("ruler.lines",f.annotationRuler,!0);g("ruler.folding",f.annotationRuler,!0);g("ruler.overview",f.overviewRuler,!0);g("rulerLines",f.lineNumber,!1);g("rulerLines.even",f.lineNumberEven,!1);g("rulerLines.odd",f.lineNumberOdd,!1);g("annotationLine.currentLine",f.currentLine,!0);g("entity-name-tag",f.keyword,!1);g("entity-other-attribute-name",f.attribute,!1);g("string-quoted",f.string,!1);g("token_keyword",f.keyword,!1);g("token_string",f.string,!1);g("token_singleline_comment",
f.comment,!1);g("token_multiline_comment",f.comment,!1);g("token_doc_comment",f.comment,!1);g("token_doc_html_markup",f.comment,!1);return b.join("\n")},_createStyle:function(c,f,g,b){var a=this._document,c="orion-theme-"+c,h=a.getElementById(c);if(h){if(b||h.firstChild.data===f)return;h.removeChild(h.firstChild);h.appendChild(a.createTextNode(f))}else b?(h=p.createElement(a,"link"),h.rel="stylesheet",h.type="text/css",h.href=f,h.addEventListener("load",function(){g()})):(h=p.createElement(a,"style"),
h.appendChild(a.createTextNode(f))),h.id=c,(a.getElementsByTagName("head")[0]||a.documentElement).appendChild(h);b||g()},_load:function(c,f,g){if(c)if(typeof f==="string")this._createStyle(c,f,g);else if(f=f.href,f.substring(f.length-4)!==".css"&&(f+=".css"),/^\//.test(f)||/[a-zA-Z0-9]+:\/\//i.test(f)||!s.toUrl)this._createStyle(c,f,g,!0);else{var b=this;s(["text!"+f],function(a){b._createStyle(c,a,g,!1)})}else g()}};q.EventTarget.addMixin(i.prototype);return{TextTheme:i}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(s,q){function p(i){this._model=i;this._projections=[]}p.prototype={addProjection:function(i){if(i){var c=this._model,e=this._projections;i._lineIndex=c.getLineAtOffset(i.start);i._lineCount=c.getLineAtOffset(i.end)-i._lineIndex;var f=i.text;f||(f="");i._model=typeof f==="string"?new s.TextModel(f,c.getLineDelimiter()):f;var c=this.mapOffset(i.start,!0),f=i.end-i.start,g=i._lineCount,b=i._model.getCharCount(),
a=i._model.getLineCount()-1;this.onChanging({type:"Changing",text:i._model.getText(),start:c,removedCharCount:f,addedCharCount:b,removedLineCount:g,addedLineCount:a});var h=this._binarySearch(e,i.start);e.splice(h,0,i);this.onChanged({type:"Changed",start:c,removedCharCount:f,addedCharCount:b,removedLineCount:g,addedLineCount:a})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(i,c){var e=this._projections,f=0,g,b;if(c){for(g=
0;g<e.length;g++){b=e[g];if(b.start>i)break;if(b.end>i)return-1;f+=b._model.getCharCount()-(b.end-b.start)}return i+f}for(g=0;g<e.length;g++){b=e[g];if(b.start>i-f)break;var a=b._model.getCharCount();if(b.start+a>i-f)return-1;f+=a-(b.end-b.start)}return i-f},removeProjection:function(i){var c,e=0;for(c=0;c<this._projections.length;c++){var f=this._projections[c];if(f===i){i=f;break}e+=f._model.getCharCount()-(f.end-f.start)}if(c<this._projections.length){var f=this._model,e=i.start+e,g=i.end-i.start,
b=i._lineCount,a=i._model.getCharCount(),h=i._model.getLineCount()-1;this.onChanging({type:"Changing",text:f.getText(i.start,i.end),start:e,removedCharCount:a,addedCharCount:g,removedLineCount:h,addedLineCount:b});this._projections.splice(c,1);this.onChanged({type:"Changed",start:e,removedCharCount:a,addedCharCount:g,removedLineCount:h,addedLineCount:b})}},_binarySearch:function(i,c){for(var e=i.length,f=-1,g;e-f>1;)g=Math.floor((e+f)/2),c<=i[g].start?e=g:f=g;return e},getCharCount:function(){for(var i=
this._model.getCharCount(),c=this._projections,e=0;e<c.length;e++){var f=c[e];i+=f._model.getCharCount()-(f.end-f.start)}return i},getLine:function(i,c){if(i<0)return null;var e=this._model,f=this._projections,g=0,b=[],a=0,h,o,m;for(h=0;h<f.length;h++){m=f[h];if(m._lineIndex>=i-g)break;o=m._model.getLineCount()-1;if(m._lineIndex+o>=i-g)if(a=i-(m._lineIndex+g),a<o)return m._model.getLine(a,c);else b.push(m._model.getLine(o));a=m.end;g+=o-m._lineCount}for(a=Math.max(a,e.getLineStart(i-g));h<f.length;h++){m=
f[h];if(m._lineIndex>i-g)break;b.push(e.getText(a,m.start));o=m._model.getLineCount()-1;if(m._lineIndex+o>i-g)return b.push(m._model.getLine(0,c)),b.join("");b.push(m._model.getText());a=m.end;g+=o-m._lineCount}f=e.getLineEnd(i-g,c);a<f&&b.push(e.getText(a,f));return b.join("")},getLineAtOffset:function(i){for(var c=this._model,e=this._projections,f=0,g=0,b=0;b<e.length;b++){var a=e[b];if(a.start>i-f)break;var h=a._model.getCharCount();if(a.start+h>i-f){e=i-(a.start+f);g+=a._model.getLineAtOffset(e);
f+=e;break}g+=a._model.getLineCount()-1-a._lineCount;f+=h-(a.end-a.start)}return c.getLineAtOffset(i-f)+g},getLineCount:function(){for(var i=this._projections,c=this._model.getLineCount(),e=0;e<i.length;e++){var f=i[e];c+=f._model.getLineCount()-1-f._lineCount}return c},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(i,c){if(i<0)return-1;for(var e=this._model,f=this._projections,g=0,b=0,a=0;a<f.length;a++){var h=f[a];if(h._lineIndex>i-g)break;var o=h._model.getLineCount()-
1;if(h._lineIndex+o>i-g)return h._model.getLineEnd(i-(h._lineIndex+g),c)+h.start+b;b+=h._model.getCharCount()-(h.end-h.start);g+=o-h._lineCount}return e.getLineEnd(i-g,c)+b},getLineStart:function(i){if(i<0)return-1;for(var c=this._model,e=this._projections,f=0,g=0,b=0;b<e.length;b++){var a=e[b];if(a._lineIndex>=i-f)break;var h=a._model.getLineCount()-1;if(a._lineIndex+h>=i-f)return a._model.getLineStart(i-(a._lineIndex+f))+a.start+g;g+=a._model.getCharCount()-(a.end-a.start);f+=h-a._lineCount}return c.getLineStart(i-
f)+g},getText:function(i,c){i===void 0&&(i=0);var e=this._model,f=this._projections,g=0,b=[],a,h,o;for(a=0;a<f.length;a++){h=f[a];if(h.start>i-g)break;o=h._model.getCharCount();if(h.start+o>i-g)if(c!==void 0&&h.start+o>c-g)return h._model.getText(i-(h.start+g),c-(h.start+g));else b.push(h._model.getText(i-(h.start+g))),i=h.end+g+o-(h.end-h.start);g+=o-(h.end-h.start)}var m=i-g;if(c!==void 0){for(;a<f.length;a++){h=f[a];if(h.start>c-g)break;b.push(e.getText(m,h.start));o=h._model.getCharCount();if(h.start+
o>c-g)return b.push(h._model.getText(0,c-(h.start+g))),b.join("");b.push(h._model.getText());m=h.end;g+=o-(h.end-h.start)}b.push(e.getText(m,c-g))}else{for(;a<f.length;a++)h=f[a],b.push(e.getText(m,h.start)),b.push(h._model.getText()),m=h.end;b.push(e.getText(m))}return b.join("")},_onChanging:function(i,c,e,f,g,b){for(var a=this._model,h=this._projections,o,m=0,n,r=c+e;o<h.length;o++){e=h[o];if(e.start>c)break;m+=e._model.getCharCount()-(e.end-e.start)}c+=m;for(var u=o;o<h.length;o++){e=h[o];if(e.start>
r)break;m+=e._model.getCharCount()-(e.end-e.start);n+=e._model.getLineCount()-1-e._lineCount}e=r+m;m=o;this.onChanging(c,e-c,f,g+n,b);h.splice(h,m-u);for(i=i.length-(e-c);o<h.length;o++)e=h[o],e.start+=i,e.end+=i,e._lineIndex=a.getLineAtOffset(e.start)},onChanging:function(i){return this.dispatchEvent(i)},onChanged:function(i){return this.dispatchEvent(i)},setLineDelimiter:function(i){this._model.setLineDelimiter(i)},setText:function(i,c,e){i===void 0&&(i="");c===void 0&&(c=0);var f=c,g=e,b=this._model,
a=this._projections,h=0,o=0,m,n,r,u,t,d=0;for(m=0;m<a.length;m++){n=a[m];if(n.start>c-h)break;r=n._model.getCharCount();if(n.start+r>c-h)if(e!==void 0&&n.start+r>e-h){n._model.setText(i,c-(n.start+h),e-(n.start+h));return}else d=n._model.getLineCount()-1-n._model.getLineAtOffset(c-(n.start+h)),u={projection:n,start:c-(n.start+h)},c=n.end+h+r-(n.end-n.start);o+=n._model.getLineCount()-1-n._lineCount;h+=r-(n.end-n.start)}c-=h;var k=m,d=b.getLineAtOffset(c)+o-d;if(e!==void 0)for(;m<a.length;m++){n=a[m];
if(n.start>e-h)break;r=n._model.getCharCount();if(n.start+r>e-h){o+=n._model.getLineAtOffset(e-(n.start+h));r=e-(n.start+h);e=n.end+h;t={projection:n,end:r};break}o+=n._model.getLineCount()-1-n._lineCount;h+=r-(n.end-n.start)}else{for(;m<a.length;m++)n=a[m],o+=n._model.getLineCount()-1-n._lineCount,h+=n._model.getCharCount()-(n.end-n.start);e=g=b.getCharCount()+h}e-=h;n=b.getLineAtOffset(e)+o;g-=f;for(var o=n-d,d=i.length,j=r=n=h=0;;){n!==-1&&n<=j&&(n=i.indexOf("\r",j));r!==-1&&r<=j&&(r=i.indexOf("\n",
j));if(r===-1&&n===-1)break;j=n!==-1&&r!==-1?n+1===r?r+1:(n<r?n:r)+1:n!==-1?n+1:r+1;h++}this.onChanging({type:"Changing",text:i,start:f,removedCharCount:g,addedCharCount:d,removedLineCount:o,addedLineCount:h});b.setText(i,c,e);if(u)n=u.projection,n._model.setText("",u.start);if(t)n=t.projection,n._model.setText("",0,t.end),n.start=n.end,n._lineCount=0;a.splice(k,m-k);for(i=i.length-(e-c);m<a.length;m++)n=a[m],n.start+=i,n.end+=i,n._lineIndex=b.getLineAtOffset(n.start);this.onChanged({type:"Changed",
start:f,removedCharCount:g,addedCharCount:d,removedLineCount:o,addedLineCount:h})}};q.EventTarget.addMixin(p.prototype);return{ProjectionTextModel:p}});
define("orion/keyBinding",["orion/util"],function(s){function q(p,i,c,e,f){this.keyCode=typeof p==="string"?p.toUpperCase().charCodeAt(0):p;this.mod1=i!==void 0&&i!==null?i:!1;this.mod2=c!==void 0&&c!==null?c:!1;this.mod3=e!==void 0&&e!==null?e:!1;this.mod4=f!==void 0&&f!==null?f:!1}q.prototype={match:function(p){return this.keyCode===p.keyCode?this.mod1!==(s.isMac?p.metaKey:p.ctrlKey)?!1:this.mod2!==p.shiftKey?!1:this.mod3!==p.altKey?!1:s.isMac&&this.mod4!==p.ctrlKey?!1:!0:!1},equals:function(p){return!p?
!1:this.keyCode!==p.keyCode?!1:this.mod1!==p.mod1?!1:this.mod2!==p.mod2?!1:this.mod3!==p.mod3?!1:this.mod4!==p.mod4?!1:!0}};return{KeyBinding:q}});
define("orion/editor/textView",["orion/editor/textModel","orion/keyBinding","orion/editor/eventTarget","orion/editor/textTheme","orion/util"],function(s,q,p,i,c){function e(d,k,j,v){typeof d.addEventListener==="function"?d.addEventListener(k,j,v===!0):d.attachEvent("on"+k,j)}function f(d,k,j){if(j){k.className="";for(var j=k.attributes,v=j.length;v-- >0;)(!c.isIE||c.isIE>=9||c.isIE<9&&j[v].specified)&&k.removeAttribute(j[v].name)}if(d){if(d.styleClass)k.className=d.styleClass;if(j=d.style)for(var l in j)j.hasOwnProperty(l)&&
(k.style[l]=j[l]);if(d=d.attributes)for(var a in d)d.hasOwnProperty(a)&&k.setAttribute(a,d[a])}}function g(d){return d instanceof Array?d.slice(0):d}function b(d,k){if(d===k)return!0;if(d&&!k||!d&&k)return!1;if(d&&d.constructor===String||k&&k.constructor===String)return!1;if(d instanceof Array||k instanceof Array){if(!(d instanceof Array&&k instanceof Array))return!1;if(d.length!==k.length)return!1;for(var j=0;j<d.length;j++)if(!b(d[j],k[j]))return!1;return!0}if(!(d instanceof Object)||!(k instanceof
Object))return!1;for(j in d)if(d.hasOwnProperty(j)){if(!k.hasOwnProperty(j))return!1;if(!b(d[j],k[j]))return!1}for(j in k)if(!d.hasOwnProperty(j))return!1;return!0}function a(d,k,j){for(var v=0,l=0,a=0,c=d.length;a<c;){v!==-1&&v<=a&&(v=d.indexOf("\r",a));l!==-1&&l<=a&&(l=d.indexOf("\n",a));var b=a,h;if(l===-1&&v===-1){k(d.substring(a));break}v!==-1&&l!==-1?v+1===l?(h=v,a=l+1):(h=v<l?v:l,a=(v<l?v:l)+1):v!==-1?(h=v,a=v+1):(h=l,a=l+1);k(d.substring(b,h));j()}}function h(d){var k,j,v,l,a=d.ownerDocument.defaultView||
d.ownerDocument.parentWindow;if(a.getComputedStyle)d=a.getComputedStyle(d,null),k=d.getPropertyValue("padding-left"),j=d.getPropertyValue("padding-top"),v=d.getPropertyValue("padding-right"),l=d.getPropertyValue("padding-bottom");else if(d.currentStyle)k=d.currentStyle.paddingLeft,j=d.currentStyle.paddingTop,v=d.currentStyle.paddingRight,l=d.currentStyle.paddingBottom;return{left:parseInt(k,10)||0,top:parseInt(j,10)||0,right:parseInt(v,10)||0,bottom:parseInt(l,10)||0}}function o(d){var k,j,v,l,a=
d._trim;if(!a){var a=h(d),c=d.ownerDocument.defaultView||d.ownerDocument.parentWindow;if(c.getComputedStyle)l=c.getComputedStyle(d,null),k=l.getPropertyValue("border-left-width"),j=l.getPropertyValue("border-top-width"),v=l.getPropertyValue("border-right-width"),l=l.getPropertyValue("border-bottom-width");else if(d.currentStyle)k=d.currentStyle.borderLeftWidth,j=d.currentStyle.borderTopWidth,v=d.currentStyle.borderRightWidth,l=d.currentStyle.borderBottomWidth;k=parseInt(k,10)||0;j=parseInt(j,10)||
0;v=parseInt(v,10)||0;l=parseInt(l,10)||0;a.left+=k;a.top+=j;a.right+=v;a.bottom+=l;d._trim=a}return a}function m(d,k,j){this.start=d;this.end=k;this.caret=j}function n(d){this.left=d.left;this.top=d.top;this.right=d.right;this.bottom=d.bottom}function r(d,k,j){this.view=d;this.lineIndex=k;this._lineDiv=j}function u(d){this._init(d||{})}var t=function(){function d(d){this.options=d}d.prototype.play=function(){var d=typeof this.options.duration==="number"?this.options.duration:350,j=this.options.easing||
this.defaultEasing,v=this.options.onAnimate||function(){},l=this.options.curve[0],a=this.options.curve[1],c=a-l,b=-1,h,f=this;this.interval=this.options.window.setInterval(function(){b=b===-1?(new Date).getTime():b;var e=((new Date).getTime()-b)/d;e<1?(e=j(e),h=l+e*c,v(h)):(v(a),f.stop())},typeof this.options.rate==="number"?this.options.rate:20)};d.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};d.prototype.defaultEasing=function(d){return Math.sin(d*
(Math.PI/2))};return d}();m.prototype={clone:function(){return new m(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(d){this.caret?this.start=d:this.end=d;if(this.start>this.end)d=this.start,this.start=this.end,this.end=d,this.caret=!this.caret},setCaret:function(d){this.end=this.start=d;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?
" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(d){return this.caret===d.caret&&this.start===d.start&&this.end===d.end}};n.prototype={toString:function(){return"{l="+this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}};r.prototype={create:function(d,k){if(!this._lineDiv){var j=this._lineDiv=this._createLine(d,k,this.lineIndex);j._line=this;return j}},_createLine:function(d,k,j){var v=this.view,l=v._model,a=l.getLine(j),h=l.getLineStart(j),
e={type:"LineStyle",textView:v,lineIndex:j,lineText:a,lineStart:h};if(a.length<2E3)v.onLineStyle(e);l=k||c.createElement(d.ownerDocument,"div");if(!k||!b(k.viewStyle,e.style)){f(e.style,l,k);if(k)k._trim=null;l.viewStyle=e.style;l.setAttribute("role","presentation")}l.lineIndex=j;j=[];this._createRanges(e.ranges,a,0,a.length,h,{tabOffset:0,ranges:j});a=" ";!v._fullSelection&&c.isIE<9&&(a="\ufeff");c.isWebkit&&(a="\u200c");j.push({text:a,style:v._metrics.largestFontStyle,ignoreChars:1});var m,o,g,
n,r,a=v=0,i,u;if(k){if(o=k.modelChangedEvent)o.removedLineCount===0&&o.addedLineCount===0?(u=o.start-h,i=o.addedCharCount-o.removedCharCount):u=-1,k.modelChangedEvent=void 0;o=k.firstChild}for(h=0;h<j.length;h++){m=j[h];n=m.text;v+=n.length;e=m.style;if(o)if(r=o.firstChild.data,g=o.viewStyle,r===n&&b(e,g)){a+=r.length;o._rectsCache=void 0;m=o=o.nextSibling;continue}else for(;o;){if(u!==-1){g=v;g>=u&&(g-=i);r=(r=o.firstChild.data)?r.length:0;if(a+r>g)break;a+=r}g=o.nextSibling;l.removeChild(o);o=g}m=
this._createSpan(l,n,e,m.ignoreChars);o?l.insertBefore(m,o):l.appendChild(m);if(k)k.lineWidth=void 0}if(k)for(d=m?m.nextSibling:null;d;)g=d.nextSibling,k.removeChild(d),d=g;else d.appendChild(l);return l},_createRanges:function(d,k,j,v,l,a){if(!(j>=v)){if(d)for(var c=0;c<d.length;c++){var h=d[c];if(!(h.end<=l+j)){var f=Math.max(l+j,h.start)-l;if(f>=v)break;var e=Math.min(l+v,h.end)-l;if(f<e){f=Math.max(j,f);e=Math.min(v,e);for(j<f&&this._createRange(k,j,f,null,a);c+1<d.length&&d[c+1].start-l===e&&
b(h.style,d[c+1].style);)h=d[c+1],e=Math.min(l+v,h.end)-l,c++;this._createRange(k,f,e,h.style,a);j=e}}}j<v&&this._createRange(k,j,v,null,a)}},_createRange:function(d,k,j,v,l){if(!(k>=j)){var a=this.view._customTabSize;if(a&&a!==8)for(var c=d.indexOf("\t",k);c!==-1&&c<j;){k<c&&(k={text:d.substring(k,c),style:v},l.ranges.push(k),l.tabOffset+=k.text.length);k=a-l.tabOffset%a;if(k>0){for(var h="\u00a0",b=1;b<k;b++)h+=" ";k={text:h,style:v,ignoreChars:k-1};l.ranges.push(k);l.tabOffset+=k.text.length}k=
c+1;c=d.indexOf("\t",k)}k<j&&(k={text:d.substring(k,j),style:v},l.ranges.push(k),l.tabOffset+=k.text.length)}},_createSpan:function(d,k,j,v){var l=j&&j.tagName==="A";if(l)d.hasLink=!0;var l=l&&this.view._linksVisible?"a":"span",a=d.ownerDocument,d=c.createElement(d.ownerDocument,l);d.appendChild(a.createTextNode(k));f(j,d);if(l==="A"){var h=this.view,b=this._getWindow();e(d,"click",function(d){return h._handleLinkClick(d?d:b.event)},!1)}d.viewStyle=j;if(v)d.ignoreChars=v;return d},_ensureCreated:function(){return this._lineDiv?
this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(d,k){var j=this._ensureCreated(),v=this.view;if(d===void 0)return this._getLineBoundingClientRect(j,!0);var l=v._model,a=j.ownerDocument,h=this.lineIndex,b=null;if(d<l.getLineEnd(h)){l=l.getLineStart(h);for(h=j.firstChild;h;){var f=h.firstChild,e=f.length;h.ignoreChars&&(e-=h.ignoreChars);if(l+e>d){b=d-l;if(v._isRangeRects)a=a.createRange(),a.setStart(f,b),a.setEnd(f,b+1),b=new n(a.getBoundingClientRect());
else if(c.isIE)a=a.body.createTextRange(),a.moveToElementText(h),a.collapse(),a.moveEnd("character",b+1),a.moveStart("character",b),b=new n(a.getBoundingClientRect());else{var m=f.data;h.removeChild(f);h.appendChild(a.createTextNode(m.substring(0,b)));var o=c.createElement(a,"span");o.appendChild(a.createTextNode(m.substring(b,b+1)));h.appendChild(o);h.appendChild(a.createTextNode(m.substring(b+1)));b=new n(o.getBoundingClientRect());h.innerHTML="";h.appendChild(f);this._createdDiv||(a=v._getSelection(),
(l<=a.start&&a.start<l+e||l<=a.end&&a.end<l+e)&&v._updateDOMSelection())}c.isIE&&(a=j.ownerDocument.defaultView||j.ownerDocument.parentWindow,j=a.screen.logicalXDPI/a.screen.deviceXDPI,a=a.screen.logicalYDPI/a.screen.deviceYDPI,b.left*=j,b.right*=j,b.top*=a,b.bottom*=a);break}l+=e;h=h.nextSibling}}j=this.getBoundingClientRect();if(!b)v._wrapMode?(v=this.getClientRects(),b=v[v.length-1],b.left=b.right,b.left+=j.left,b.top+=j.top,b.right+=j.left,b.bottom+=j.top):(b=new n(j),b.left=b.right);if(k||k===
void 0)b.left-=j.left,b.top-=j.top,b.right-=j.left,b.bottom-=j.top;return b},_getClientRects:function(d,k){var j,a,l,c;if(!d._rectsCache){j=d.getClientRects();a=Array(j.length);for(c=0;c<j.length;c++)l=a[c]=new n(j[c]),l.left-=k.left,l.top-=k.top,l.right-=k.left,l.bottom-=k.top;d._rectsCache=a}j=d._rectsCache;a=[j.length];for(c=0;c<j.length;c++)a[c]=new n(j[c]);return a},getClientRects:function(d){if(!this.view._wrapMode)return[this.getBoundingClientRect()];for(var k=this._ensureCreated(),j=[],a=
k.firstChild,l,c=k.getBoundingClientRect();a;){for(var b=this._getClientRects(a,c),k=0;k<b.length;k++){var h=b[k],f;if(h.top!==h.bottom){var e=h.top+(h.bottom-h.top)/2;for(f=0;f<j.length;f++)if(l=j[f],l.top<=e&&e<l.bottom)break;if(f===j.length)j.push(h);else{if(h.left<l.left)l.left=h.left;if(h.top<l.top)l.top=h.top;if(h.right>l.right)l.right=h.right;if(h.bottom>l.bottom)l.bottom=h.bottom}}}a=a.nextSibling}return d!==void 0?j[d]:j},_getLineBoundingClientRect:function(d,k){var j=new n(d.getBoundingClientRect());
if(!this.view._wrapMode){j.right=j.left;for(var a=d.lastChild;a&&a.ignoreChars===a.firstChild.length;)a=a.previousSibling;if(a)a=a.getBoundingClientRect(),j.right=a.right+o(d).right}k&&(a=o(d),j.left+=a.left,j.right-=a.right);return j},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(d){if(!this.view._wrapMode)return 0;for(var k=this.getClientRects(),d=this.getBoundingClientRect(d),d=d.top+(d.bottom-d.top)/2,j=0;j<k.length;j++)if(k[j].top<=d&&
d<k[j].bottom)return j;return k.length-1},getLineStart:function(d){if(!this.view._wrapMode||d===0)return this.view._model.getLineStart(d);var k=this.getClientRects();return this.getOffset(k[d].left+1,k[d].top+1)},getOffset:function(d,k){var j=this.view,a=j._model,l=this.lineIndex,h=a.getLineStart(l),a=a.getLineEnd(l);if(h===a)return h;var b=this._ensureCreated(),l=this.getBoundingClientRect(),f,e;if(j._wrapMode){f=this.getClientRects();if(k<f[0].top)k=f[0].top;for(var m=0;m<f.length;m++)if(e=f[m],
e.top<=k&&k<e.bottom)break;if(d<e.left)d=e.left;d>e.right&&(d=e.right-1)}else d<0&&(d=0),d>l.right-l.left&&(d=l.right-l.left);var o=b.ownerDocument,m=o.defaultView||o.parentWindow,g=c.isIE?m.screen.logicalXDPI/m.screen.deviceXDPI:1,n=c.isIE?m.screen.logicalYDPI/m.screen.deviceYDPI:1,m=h,r=b.firstChild;a:for(;r;){var i=r.firstChild,b=i.length;r.ignoreChars&&(b-=r.ignoreChars);var u,t,p;f=this._getClientRects(r,l);for(var q=0;q<f.length;q++)if(e=f[q],e.left<=d&&d<e.right&&(!j._wrapMode||e.top<=k&&k<
e.bottom)){if(c.isIE||j._isRangeRects){for(var o=j._isRangeRects?o.createRange():o.body.createTextRange(),q=b,s=-1;q-s>1;){var D=Math.floor((q+s)/2);e=s+1;f=D===b-1&&r.ignoreChars?i.length:D+1;j._isRangeRects?(o.setStart(i,e),o.setEnd(i,f)):(o.moveToElementText(r),o.move("character",e),o.moveEnd("character",f-e));f=o.getClientRects();for(var J=!1,F=0;F<f.length;F++)if(e=f[F],u=e.left*g-l.left,p=e.right*g-l.left,t=e.top*n-l.top,e=e.bottom*n-l.top,u<=d&&d<p&&(!j._wrapMode||t<=k&&k<e)){J=!0;break}J?
q=D:s=D}m+=q;e=q;f=q===b-1&&r.ignoreChars?i.length:Math.min(q+1,i.length);j._isRangeRects?(o.setStart(i,e),o.setEnd(i,f)):(o.moveToElementText(r),o.move("character",e),o.moveEnd("character",f-e));e=o.getClientRects()[0];u=e.left*g-l.left;p=e.right*g-l.left;d>u+(p-u)/2&&m++}else{e=[];for(g=0;g<b;g++)e.push("<span>"),g===b-1?e.push(i.data.substring(g)):e.push(i.data.substring(g,g+1)),e.push("</span>");r.innerHTML=e.join("");for(g=r.firstChild;g;){e=g.getBoundingClientRect();u=e.left-l.left;p=e.right-
l.left;if(u<=d&&d<p){d>u+(p-u)/2&&m++;break}m++;g=g.nextSibling}if(!this._createdDiv)r.innerHTML="",r.appendChild(i),l=j._getSelection(),(m<=l.start&&l.start<m+b||m<=l.end&&l.end<m+b)&&j._updateDOMSelection()}break a}m+=b;r=r.nextSibling}return Math.min(a,Math.max(h,m))},getNextOffset:function(d,k,j){return k==="line"?(k=this.view._model,d=k.getLineAtOffset(d),j>0?k.getLineEnd(d):k.getLineStart(d)):k==="wordend"?this._getNextOffset_W3C(d,k,j):c.isIE?this._getNextOffset_IE(d,k,j):this._getNextOffset_W3C(d,
k,j)},_getNextOffset_W3C:function(d,k,j){function a(d){return 33<=d&&d<=47||58<=d&&d<=64||91<=d&&d<=94||d===96||123<=d&&d<=126}if(k==="word"||k==="wordend"){var l=this.view._model,c=l.getLineAtOffset(d),b=l.getLine(c),h=l.getLineStart(c),c=l.getLineEnd(c),l=b.length;d-=h;var f,e;if(j>0){if(d===l)return c;f=b.charCodeAt(d);e=a(f);j=!e&&!(f===32||f===9);for(d++;d<l;){f=b.charCodeAt(d);c=a(f);if(k==="wordend"){if(!c&&e)break}else if(c&&!e)break;f=!c&&!(f===32||f===9);if(k==="wordend"){if(!f&&j)break}else if(f&&
!j)break;j=f;e=c;d++}}else{if(d===0)return h;d--;f=b.charCodeAt(d);e=a(f);for(j=!e&&!(f===32||f===9);0<d;){f=b.charCodeAt(d-1);c=a(f);if(k==="wordend"){if(c&&!e)break}else if(!c&&e)break;f=!c&&!(f===32||f===9);if(k==="wordend"){if(f&&!j)break}else if(!f&&j)break;j=f;e=c;d--}}return h+d}return d+j},_getNextOffset_IE:function(d,k,j){var a=this._ensureCreated(),l=this.view._model,c=this.lineIndex,b=0,h;h=l.getLineStart(c);var f=a.ownerDocument;if(d===l.getLineEnd(c)){for(a=a.lastChild;a&&a.ignoreChars;)a=
a.previousSibling;if(!a)return h;b=f.body.createTextRange();b.moveToElementText(a);h=b.text.length;b.moveEnd(k,j);b=d+b.text.length-h}else if(d===h&&j<0)b=h;else for(a=a.firstChild;a;){l=a.firstChild.length;a.ignoreChars&&(l-=a.ignoreChars);if(h+l>d){b=f.body.createTextRange();d===h&&j<0?b.moveToElementText(a.previousSibling):(b.moveToElementText(a),b.collapse(),b.moveEnd("character",d-h));h=b.text.length;b.moveEnd(k,j);b=d+b.text.length-h;break}h=l+h;a=a.nextSibling}return b},destroy:function(){var d=
this._createdDiv;if(d)d.parentNode.removeChild(d),this._createdDiv=null}};u.prototype={addRuler:function(d,k){d.setView(this);var j=this._rulers;if(k!==void 0){var a,l;for(a=0,l=0;a<j.length&&l<k;a++)d.getLocation()===j[a].getLocation()&&l++;j.splice(l,0,d);k=l}else j.push(d);this._createRuler(d,k);this._update()},computeSize:function(){var d=0,k=0,j=this._model,a=this._clientDiv;if(!a)return{width:d,height:k};var l=a.style.width;if(c.isWebkit)a.style.width="0x7fffffffpx";for(var j=j.getLineCount(),
b=0;b<j;b++){var h=this._getLine(b),f=h.getBoundingClientRect(),d=Math.max(d,f.right-f.left);k+=f.bottom-f.top;h.destroy()}if(c.isWebkit)a.style.width=l;a=this._getViewPadding();d+=a.right+a.left+this._metrics.scrollWidth;k+=a.bottom+a.top+this._metrics.scrollWidth;return{width:d,height:k}},convert:function(d,k,j){if(this._clientDiv){var a=this._getScroll(),l=this._getViewPadding(),c=this._viewDiv.getBoundingClientRect();k==="document"&&(d.x!==void 0&&(d.x+=-a.x+c.left+l.left),d.y!==void 0&&(d.y+=
-a.y+c.top+l.top));j==="document"&&(d.x!==void 0&&(d.x+=a.x-c.left-l.left),d.y!==void 0&&(d.y+=a.y-c.top-l.top));return d}},destroy:function(){for(var d=0;d<this._rulers.length;d++)this._rulers[d].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._actions=this._keyBindings=this._doubleClickSelection=this._selection=this._theme=this._model=this._parent=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),c.isOpera&&this._clientDiv.blur(),this._clientDiv.focus(),
this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(d){if(d=this._actions[d])return d.actionDescription},getActions:function(d){var k=[],j=this._actions,a;for(a in j)j.hasOwnProperty(a)&&(d||!j[a].defaultHandler)&&k.push(a);return k},getBottomIndex:function(d){return!this._clientDiv?0:this._getBottomIndex(d)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},
getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var d=this._getScroll();return{x:d.x,y:d.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(d){for(var k=[],j=this._keyBindings,a=0;a<j.length;a++)j[a].actionID===d&&k.push(j[a].keyBinding);return k},getLineHeight:function(d){return!this._clientDiv?0:this._getLineHeight(d)},getLineIndex:function(d){return!this._clientDiv?
0:this._getLineIndex(d)},getLinePixel:function(d){return!this._clientDiv?0:this._getLinePixel(d)},getLocationAtOffset:function(d){if(!this._clientDiv)return{x:0,y:0};var k=this._model,d=Math.min(Math.max(0,d),k.getCharCount()),k=k.getLineAtOffset(d),j=this._getLine(k),d=j.getBoundingClientRect(d);j.destroy();j=d.left;k=this._getLinePixel(k)+d.top;return{x:j,y:k}},getOptions:function(){var d;if(arguments.length===0)d=this._defaultOptions();else if(arguments.length===1){if(d=arguments[0],typeof d===
"string")return g(this["_"+d])}else{d={};for(var k in arguments)arguments.hasOwnProperty(k)&&(d[arguments[k]]=void 0)}for(var j in d)d.hasOwnProperty(j)&&(d[j]=g(this["_"+j]));return d},getModel:function(){return this._model},getOffsetAtLocation:function(d,k){if(!this._clientDiv)return 0;var j=this._getLineIndex(k),a=this._getLine(j),j=a.getOffset(d,k-this._getLinePixel(j));a.destroy();return j},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var d=this._getSelection();
return{start:d.start,end:d.end}},getText:function(d,k){return this._model.getText(d,k)},getTopIndex:function(d){return!this._clientDiv?0:this._getTopIndex(d)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(d,k){if(this._clientDiv){var j=this._actions[d];if(j){if(!k&&j.handler&&j.handler())return;if(j.defaultHandler)return j.defaultHandler()}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(d){return this.dispatchEvent(d)},
onDragStart:function(d){return this.dispatchEvent(d)},onDrag:function(d){return this.dispatchEvent(d)},onDragEnd:function(d){return this.dispatchEvent(d)},onDragEnter:function(d){return this.dispatchEvent(d)},onDragOver:function(d){return this.dispatchEvent(d)},onDragLeave:function(d){return this.dispatchEvent(d)},onDrop:function(d){return this.dispatchEvent(d)},onDestroy:function(d){return this.dispatchEvent(d)},onLineStyle:function(d){return this.dispatchEvent(d)},onModelChanged:function(d){return this.dispatchEvent(d)},
onModelChanging:function(d){return this.dispatchEvent(d)},onModify:function(d){return this.dispatchEvent(d)},onMouseDown:function(d){return this.dispatchEvent(d)},onMouseUp:function(d){return this.dispatchEvent(d)},onMouseMove:function(d){return this.dispatchEvent(d)},onMouseOver:function(d){return this.dispatchEvent(d)},onMouseOut:function(d){return this.dispatchEvent(d)},onSelection:function(d){return this.dispatchEvent(d)},onScroll:function(d){return this.dispatchEvent(d)},onVerify:function(d){return this.dispatchEvent(d)},
onFocus:function(d){return this.dispatchEvent(d)},onBlur:function(d){return this.dispatchEvent(d)},redraw:function(){if(!(this._redrawCount>0)){var d=this._model.getLineCount();this.redrawRulers(0,d);this.redrawLines(0,d)}},redrawRulers:function(d,k){if(!(this._redrawCount>0))for(var j=this.getRulers(),a=0;a<j.length;a++)this.redrawLines(d,k,j[a])},redrawLines:function(d,k,j){if(!(this._redrawCount>0)&&(d===void 0&&(d=0),k===void 0&&(k=this._model.getLineCount()),d!==k)){var a=this._clientDiv;if(a){if(j)for(a=
(j.getLocation()==="left"?this._leftDiv:this._rightDiv).firstChild;a;){if(a._ruler===j)break;a=a.nextSibling}j?a.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(d,k);if(!j||j.getOverview()==="page")for(a=a.firstChild;a;){var l=a.lineIndex;if(d<=l&&l<k)a.lineChanged=!0;a=a.nextSibling}if(!j&&!this._wrapMode&&d<=this._maxLineIndex&&this._maxLineIndex<k)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._queueUpdate()}}},redrawRange:function(d,k){if(!(this._redrawCount>
0)){var j=this._model;d===void 0&&(d=0);k===void 0&&(k=j.getCharCount());var a=j.getLineAtOffset(d),j=j.getLineAtOffset(Math.max(d,k-1))+1;this.redrawLines(a,j)}},removeRuler:function(d){for(var k=this._rulers,j=0;j<k.length;j++)if(k[j]===d){k.splice(j,1);d.setView(null);this._destroyRuler(d);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(d,k,j){if(d){var a=this._actions,l=a[d];l||(l=a[d]={});l.handler=k;l.actionDescription=j}},setKeyBinding:function(d,
k){for(var j=this._keyBindings,a=0;a<j.length;a++){var l=j[a];if(l.keyBinding.equals(d)){k?l.actionID=k:l.predefined?l.actionID=null:j.splice(a,1);return}}k&&j.push({keyBinding:d,actionID:k})},setCaretOffset:function(d,k,j){var a=this._model.getCharCount(),d=Math.max(0,Math.min(d,a));this._setSelection(new m(d,d,!1),k===void 0||k,!0,j)},setHorizontalPixel:function(d){this._clientDiv&&(d=Math.max(0,d),this._scrollView(d-this._getScroll().x,0))},setRedraw:function(d){d?--this._redrawCount===0&&this.redraw():
this._redrawCount++},setModel:function(d){if(d&&d!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var k=this._model.getLineCount(),j=this._model.getCharCount(),a=d.getLineCount(),l=d.getCharCount(),c={type:"ModelChanging",text:d.getText(),start:0,removedCharCount:j,addedCharCount:l,removedLineCount:k,addedLineCount:a};this.onModelChanging(c);this._model=d;c={type:"ModelChanged",
start:0,removedCharCount:j,addedCharCount:l,removedLineCount:k,addedLineCount:a};this.onModelChanged(c);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(d){var k=this._defaultOptions(),j;for(j in d)if(d.hasOwnProperty(j)){var a=d[j];if(!b(this["_"+j],a)){var l=k[j]?k[j].update:null;l?l.call(this,a):this["_"+j]=g(a)}}},setSelection:function(d,k,j,a){var l=
d>k;if(l)var c=d,d=k,k=c;c=this._model.getCharCount();d=Math.max(0,Math.min(d,c));k=Math.max(0,Math.min(k,c));this._setSelection(new m(d,k,l),j===void 0||j,!0,a)},setText:function(d,k,j){var a=k===void 0&&j===void 0;k===void 0&&(k=0);j===void 0&&(j=this._model.getCharCount());this._modifyContent({text:d,start:k,end:j,_code:!0},!a);if(a)this._columnX=-1,this._setSelection(new m(0,0,!1),!0),c.isFirefox&&this._fixCaret()},setTopIndex:function(d){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,
d))-this._getScroll().y)},setTopPixel:function(d){this._clientDiv&&this._scrollView(0,Math.max(0,d)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(d,k){this._clientDiv&&(d&&this._updateStyle(),k===void 0||k?this._update():this._queueUpdate())},_handleRootMouseDown:function(d){if(c.isFirefox&&d.which===1)this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0;var k=this._overlayDiv||this._clientDiv;if(c.isIE<9)k=
this._viewDiv;for(var j=d.target?d.target:d.srcElement;j;){if(k===j)return;j=j.parentNode}d.preventDefault&&d.preventDefault();d.stopPropagation&&d.stopPropagation();if(!this._isW3CEvents){var a=this;this._getWindow().setTimeout(function(){a._clientDiv.focus()},0)}},_handleRootMouseUp:function(d){if(c.isFirefox&&d.which===1)this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1},_handleBlur:function(){if(!this._ignoreBlur){this._hasFocus=
!1;if(c.isIE<9&&!this._getSelection().isEmpty()){var d=this._rootDiv,k=c.createElement(d.ownerDocument,"div");d.appendChild(k);d.removeChild(k)}if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",d=this._getWindow(),k=this._selDiv1.ownerDocument,d.getSelection){k=d.getSelection();for(d=k.anchorNode;d;){if(d===this._clientDiv){k.rangeCount>0&&k.removeAllRanges();break}d=d.parentNode}}else if(k.selection){this._ignoreSelect=
!1;for(d=k.selection.createRange().parentElement();d;){if(d===this._clientDiv){k.selection.empty();break}d=d.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(d){c.isIE&&this._lastMouseButton===3&&this._updateDOMSelection();var k=!1;if(this.isListening("ContextMenu"))k=this._createMouseEvent("ContextMenu",d),k.screenX=d.screenX,k.screenY=d.screenY,this.onContextMenu(k),k=k.defaultPrevented;if(k)return d.preventDefault&&d.preventDefault(),
!1},_handleCopy:function(d){if(!this._ignoreCopy&&this._doCopy(d))return d.preventDefault&&d.preventDefault(),!1},_handleCut:function(d){if(this._doCut(d))return d.preventDefault&&d.preventDefault(),!1},_handleDataModified:function(){this._startIME()},_handleDblclick:function(d){this._lastMouseTime=d.timeStamp?d.timeStamp:(new Date).getTime();if(this._clickCount!==2)this._clickCount=2,this._handleMouse(d)},_handleDragStart:function(d){if(c.isFirefox){var k=this;this._getWindow().setTimeout(function(){k._clientDiv.contentEditable=
!0;k._clientDiv.draggable=!1;k._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&this._dragOffset!==-1)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",d)),this._dragOffset=-1;else return d.preventDefault&&d.preventDefault(),!1},_handleDrag:function(d){if(this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",d))},_handleDragEnd:function(d){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",
d));c.isFirefox&&(this._fixCaret(),d.dataTransfer.dropEffect==="none"&&!d.dataTransfer.mozUserCancelled&&this._fixCaret())},_handleDragEnter:function(d){var k=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(k=!1,this.onDragEnter(this._createMouseEvent("DragEnter",d)));if(c.isWebkit||k)return d.preventDefault&&d.preventDefault(),!1},_handleDragOver:function(d){var k=!0;this.isListening("DragOver")&&(k=!1,this.onDragOver(this._createMouseEvent("DragOver",d)));if(c.isWebkit||k){if(k)d.dataTransfer.dropEffect=
"none";d.preventDefault&&d.preventDefault();return!1}},_handleDragLeave:function(d){this._dropTarget=!1;if(this.isListening("DragLeave"))this.onDragLeave(this._createMouseEvent("DragLeave",d))},_handleDrop:function(d){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",d));d.preventDefault&&d.preventDefault();return!1},_handleFocus:function(){this._hasFocus=!0;c.isIOS&&this._lastTouchOffset!==void 0?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=
void 0):this._updateDOMSelection();if(this._selDiv1){var d=this._highlightRGB;this._selDiv1.style.background=d;this._selDiv2.style.background=d;this._selDiv3.style.background=d}if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(d){var k=!1;switch(d.keyCode){case 16:case 17:case 18:case 91:k=!0;break;default:this._setLinksVisible(!1)}if(d.keyCode===229){if(this._readonly)return d.preventDefault&&d.preventDefault(),!1;k=!0;c.isSafari&&c.isMac&&d.ctrlKey&&(k=!1);k&&this._startIME()}else k||
this._commitIME();if((c.isMac||c.isLinux)&&c.isFirefox<4||c.isOpera)return this._keyDownEvent=d,!0;if(this._doAction(d))return d.preventDefault?(d.preventDefault(),d.stopPropagation()):(d.cancelBubble=!0,d.returnValue=!1,d.keyCode=0),!1},_handleKeyPress:function(d){if(c.isMac&&c.isWebkit&&(63232<=d.keyCode&&d.keyCode<=63487||d.keyCode===13||d.keyCode===8))return d.preventDefault&&d.preventDefault(),!1;if(((c.isMac||c.isLinux)&&c.isFirefox<4||c.isOpera)&&this._doAction(this._keyDownEvent))return d.preventDefault&&
d.preventDefault(),!1;var k=c.isMac?d.metaKey:d.ctrlKey;if(d.charCode!==void 0&&k)switch(d.charCode){case 99:case 118:case 120:return!0}k=!1;if(c.isMac){if(d.ctrlKey||d.metaKey)k=!0}else if(c.isFirefox){if(d.ctrlKey||d.altKey)k=!0}else d.ctrlKey^d.altKey&&(k=!0);if(!k&&(k=c.isOpera?d.which:d.charCode!==void 0?d.charCode:d.keyCode,k>31))return this._doContent(String.fromCharCode(k)),d.preventDefault&&d.preventDefault(),!1},_handleKeyUp:function(d){(c.isMac?d.metaKey:d.ctrlKey)||this._setLinksVisible(!1);
d.keyCode===13&&this._commitIME()},_handleLinkClick:function(d){if(!(c.isMac?d.metaKey:d.ctrlKey))return d.preventDefault&&d.preventDefault(),!1},_handleMouse:function(d){var k=this._getWindow(),j=!0,a=k;if(c.isIE||c.isFirefox&&!this._overlayDiv)a=this._clientDiv;if(this._overlayDiv){if(this._hasFocus)this._ignoreFocus=!0;var l=this;k.setTimeout(function(){l.focus();l._ignoreFocus=!1},0)}this._clickCount===1?(j=this._setSelectionTo(d.clientX,d.clientY,d.shiftKey,!c.isOpera&&this._hasFocus&&this.isListening("DragStart")))&&
this._setGrab(a):(this._isW3CEvents&&this._setGrab(a),this._doubleClickSelection=null,this._setSelectionTo(d.clientX,d.clientY,d.shiftKey),this._doubleClickSelection=this._getSelection());return j},_handleMouseDown:function(d){if(this._linksVisible)if((d.target||d.srcElement).tagName!=="A")this._setLinksVisible(!1);else return;this._commitIME();var k=d.which;k||(d.button===4&&(k=2),d.button===2&&(k=3),d.button===1&&(k=1));var j=k!==2&&d.timeStamp?d.timeStamp:(new Date).getTime(),a=j-this._lastMouseTime,
l=Math.abs(this._lastMouseX-d.clientX),b=Math.abs(this._lastMouseY-d.clientY),h=this._lastMouseButton===k;this._lastMouseX=d.clientX;this._lastMouseY=d.clientY;this._lastMouseTime=j;this._lastMouseButton=k;if(k===1)this._isMouseDown=!0,h&&a<=this._clickTime&&l<=this._clickDist&&b<=this._clickDist?this._clickCount++:this._clickCount=1;if(this.isListening("MouseDown")&&(j=this._createMouseEvent("MouseDown",d),this.onMouseDown(j),j.defaultPrevented)){d.preventDefault();return}if(k===1&&this._handleMouse(d)&&
(c.isIE>=9||c.isOpera||c.isChrome||c.isSafari||c.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),d.preventDefault();c.isFirefox&&this._lastMouseButton===3&&this._updateDOMSelection()},_handleMouseOver:function(d){if(!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",d))},_handleMouseOut:function(d){if(!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",d))},_handleMouseMove:function(d){if(!this._animation){var k=
this._isClientDiv(d);if(this.isListening("MouseMove")&&k)this.onMouseMove(this._createMouseEvent("MouseMove",d));if(!this._dropTarget){var j=this._linksVisible||this._lastMouseMoveX!==d.clientX||this._lastMouseMoveY!==d.clientY;this._lastMouseMoveX=d.clientX;this._lastMouseMoveY=d.clientY;this._setLinksVisible(j&&!this._isMouseDown&&(c.isMac?d.metaKey:d.ctrlKey));if(!this._isW3CEvents){if(d.button===0)return this._setGrab(null),!0;if(!this._isMouseDown&&d.button===1&&(this._clickCount&1)!==0&&k)return this._clickCount=
2,this._handleMouse(d,this._clickCount)}if(this._isMouseDown&&this._dragOffset===-1){var k=d.clientX,d=d.clientY,a=this._getViewPadding(),l=this._viewDiv.getBoundingClientRect(),b=this._getClientWidth(),h=this._getClientHeight(),j=l.left+a.left,f=l.top+a.top,b=l.left+a.left+b,a=l.top+a.top+h,l=this._model,h=l.getLineAtOffset(this._getSelection().getCaret());d<f&&h!==0?this._doAutoScroll("up",k,d-f):d>a&&h!==l.getLineCount()-1?this._doAutoScroll("down",k,d-a):k<j&&!this._wrapMode?this._doAutoScroll("left",
k-j,d):k>b&&!this._wrapMode?this._doAutoScroll("right",k-b,d):(this._endAutoScroll(),this._setSelectionTo(k,d,!0))}}}},_isClientDiv:function(d){for(var k=this._overlayDiv||this._clientDiv,d=d.target?d.target:d.srcElement;d;){if(k===d)return!0;d=d.parentNode}return!1},_createMouseEvent:function(d,k){var j=this.convert({x:k.clientX,y:k.clientY},"page","document");return{type:d,event:k,clickCount:this._clickCount,x:j.x,y:j.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(d){var k=
d.which?d.button===0:d.button===1;if(this.isListening("MouseUp")&&(this._isClientDiv(d)||k&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",d));if(!this._linksVisible&&k&&this._isMouseDown){if(this._dragOffset!==-1)k=this._getSelection(),k.extend(this._dragOffset),k.collapse(),this._setSelection(k,!0,!0),this._dragOffset=-1;this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null);c.isFirefox&&d.preventDefault()}},_handleMouseWheel:function(d){var k=this._getLineHeight(),
j=0,a=0;c.isIE||c.isOpera?a=-d.wheelDelta/40*k:c.isFirefox?(k=c.isMac?d.detail*3:Math.max(-256,Math.min(256,d.detail))*k,d.axis===d.HORIZONTAL_AXIS?j=k:a=k):c.isMac?(a=j=40,d.wheelDeltaX%120!==0&&(j=1),d.wheelDeltaY%120!==0&&(a=1),j=-d.wheelDeltaX/j,-1<j&&j<0&&(j=-1),0<j&&j<1&&(j=1),a=-d.wheelDeltaY/a,-1<a&&a<0&&(a=-1),0<a&&a<1&&(a=1)):(j=-d.wheelDeltaX,a=-d.wheelDeltaY/120*8*k);if(c.isSafari){for(k=d.target;k&&k.lineIndex===void 0;)k=k.parentNode;this._mouseWheelLine=k}k=this._getScroll();this._scrollView(j,
a);j=this._getScroll();if(k.x!==j.x||k.y!==j.y)return d.preventDefault&&d.preventDefault(),!1},_handlePaste:function(d){if(!this._ignorePaste&&this._doPaste(d)){if(c.isIE){var k=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){k._updateDOMSelection();k._ignoreFocus=!1},0)}d.preventDefault&&d.preventDefault();return!1}},_handleResize:function(){var d=this._parent.clientWidth,k=this._parent.clientHeight;if(this._parentWidth!==d||this._parentHeight!==k)this._parentWidth!==d&&this._resetLineHeight(),
this._parentWidth=d,this._parentHeight=k,c.isIE<9?this._queueUpdate():this._update()},_handleRulerEvent:function(d){for(var k=d.target?d.target:d.srcElement,a=k.lineIndex;k&&!k._ruler;){if(a===void 0&&k.lineIndex!==void 0)a=k.lineIndex;k=k.parentNode}k=k?k._ruler:null;if(a===void 0&&k&&k.getOverview()==="document"){var a=this._getClientHeight(),c=this._model.getLineCount(),l=this._getViewPadding(),b=this._viewDiv.getBoundingClientRect(),a=Math.floor((d.clientY-b.top-this._metrics.scrollWidth)*c/(a+
l.top+l.bottom-2*this._metrics.scrollWidth));0<=a&&a<c||(a=void 0)}if(k)switch(d.type){case "click":if(k.onClick)k.onClick(a,d);break;case "dblclick":if(k.onDblClick)k.onDblClick(a,d);break;case "mousemove":if(k.onMouseMove)k.onMouseMove(a,d);break;case "mouseover":if(k.onMouseOver)k.onMouseOver(a,d);break;case "mouseout":if(k.onMouseOut)k.onMouseOut(a,d)}},_handleScroll:function(){var d=this._getScroll(!1),k=this._hScroll,a=this._vScroll;if(k!==d.x||a!==d.y)this._hScroll=d.x,this._vScroll=d.y,this._commitIME(),
this._update(a===d.y),this.onScroll({type:"Scroll",oldValue:{x:k,y:a},newValue:d})},_handleSelectStart:function(d){if(this._ignoreSelect)return d&&d.preventDefault&&d.preventDefault(),!1},_getModelOffset:function(d,k){if(d){var a;a=d.tagName==="DIV"?d:d.parentNode.parentNode;var c=0,l=a.lineIndex;if(d.tagName!=="DIV")for(a=a.firstChild;a;){var b=a.firstChild;if(b===d){a.ignoreChars&&(c-=a.ignoreChars);c+=k;break}a.ignoreChars&&(c-=a.ignoreChars);c+=b.data.length;a=a.nextSibling}return Math.max(0,
c)+this._model.getLineStart(l)}},_updateSelectionFromDOM:function(){var d=this._getWindow().getSelection(),k=this._getModelOffset(d.anchorNode,d.anchorOffset),d=this._getModelOffset(d.focusNode,d.focusOffset);k===void 0||d===void 0||this._setSelection(new m(k,d),!1,!1)},_handleSelectionChange:function(){if(this._imeOffset===-1)if(c.isAndroid){var d=this._getWindow();this._selTimer&&d.clearTimeout(this._selTimer);var k=this;this._selTimer=d.setTimeout(function(){if(k._clientDiv)k._selTimer=null,k._updateSelectionFromDOM()},
250)}else this._updateSelectionFromDOM()},_handleTextInput:function(d){this._imeOffset=-1;if(c.isAndroid){for(var k=this._getWindow().getSelection(),a=k.anchorNode;a;){if(a.lineIndex!==void 0)break;a=a.parentNode}if(a){var b=this._model,l=a.lineIndex,h=b.getLine(l),f=h,e=0,b=b.getLineStart(l);if(k.rangeCount>0)k.getRangeAt(0).deleteContents(),l=a.ownerDocument.createTextNode(d.data),k.getRangeAt(0).insertNode(l),e=this._getDOMText(a,l),f=e.text,e=e.offset,l.parentNode.removeChild(l);a.lineRemoved=
!0;for(a=0;h.charCodeAt(a)===f.charCodeAt(a)&&a<e;)a++;k=h.length-1;for(l=f.length-h.length;h.charCodeAt(k)===f.charCodeAt(k+l)&&k+l>=e+d.data.length;)k--;k++;h=f.substring(a,k+l);a+=b;k+=b;this._modifyContent({text:h,start:a,end:k,_ignoreDOMSelection:!0},!0)}}else this._doContent(d.data);d.preventDefault()},_handleTouchStart:function(d){this._commitIME();var k=this._getWindow();if(this._touchScrollTimer)this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",k.clearInterval(this._touchScrollTimer),
this._touchScrollTimer=null;var a=d.touches;if(a.length===1){var a=a[0],b=a.clientX,l=a.clientY;this._touchStartX=b;this._touchStartY=l;if(c.isAndroid&&(l<a.pageY-k.pageYOffset||b<a.pageX-k.pageXOffset))b=a.pageX-k.pageXOffset,l=a.pageY-k.pageYOffset;k=this.convert({x:b,y:l},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(k.x,k.y);this._touchStartTime=d.timeStamp;this._touching=!0}},_handleTouchMove:function(d){var k=d.touches;if(k.length===1){k=k[0];this._touchCurrentX=k.clientX;
this._touchCurrentY=k.clientY;if(!this._touchScrollTimer&&d.timeStamp-this._touchStartTime<200){this._vScrollDiv.style.display="block";if(!this._wrapMode)this._hScrollDiv.style.display="block";var a=this,c=this._getWindow();this._touchScrollTimer=c.setInterval(function(){var d=0,k=0;if(a._touching)d=a._touchStartX-a._touchCurrentX,k=a._touchStartY-a._touchCurrentY,a._touchSpeedX=d/10,a._touchSpeedY=k/10,a._touchStartX=a._touchCurrentX,a._touchStartY=a._touchCurrentY;else if(Math.abs(a._touchSpeedX)<
0.1&&Math.abs(a._touchSpeedY)<0.1){a._vScrollDiv.style.display="none";a._hScrollDiv.style.display="none";c.clearInterval(a._touchScrollTimer);a._touchScrollTimer=null;return}else d=a._touchSpeedX*10,k=a._touchSpeedY*10,a._touchSpeedX*=0.95,a._touchSpeedY*=0.95;a._scrollView(d,k)},10)}this._touchScrollTimer&&d.preventDefault()}},_handleTouchEnd:function(d){if(d.touches.length===0)this._touching=!1},_doAction:function(d){for(var k=this._keyBindings,a=0;a<k.length;a++){var c=k[a];if(c.keyBinding.match(d)){if(c.actionID&&
(d=this._actions[c.actionID]))if(d.handler){if(!d.handler())return d.defaultHandler?typeof d.defaultHandler()==="boolean":!1}else if(d.defaultHandler)return typeof d.defaultHandler()==="boolean";return!0}}return!1},_doBackspace:function(d){var k=this._getSelection();if(k.isEmpty()){var a=this._model,c=k.getCaret(),l=a.getLineAtOffset(c),b=a.getLineStart(l);if(c===b)l>0&&k.extend(a.getLineEnd(l-1));else{var h=!1;this._expandTab&&d.unit==="character"&&(c-b)%this._tabSize===0&&(h=!/[^ ]/.test(a.getText(b,
c)));h?k.extend(c-this._tabSize):(a=this._getLine(l),k.extend(a.getNextOffset(c,d.unit,-1)),a.destroy())}}this._modifyContent({text:"",start:k.start,end:k.end},!0);return!0},_doContent:function(d){var k=this._getSelection();this._modifyContent({text:d,start:k.start,end:k.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(d){var k=this._getSelection();return!k.isEmpty()?this._setClipboardText(this._getBaseText(k.start,k.end),d):!0},_doCursorNext:function(d){if(!d.select&&this._clearSelection("next"))return!0;
var k=this._model,a=this._getSelection(),c=a.getCaret(),l=k.getLineAtOffset(c);c===k.getLineEnd(l)?l+1<k.getLineCount()&&a.extend(k.getLineStart(l+1)):(k=this._getLine(l),a.extend(k.getNextOffset(c,d.unit,1)),k.destroy());d.select||a.collapse();this._setSelection(a,!0);return!0},_doCursorPrevious:function(d){if(!d.select&&this._clearSelection("previous"))return!0;var a=this._model,j=this._getSelection(),c=j.getCaret(),l=a.getLineAtOffset(c);c===a.getLineStart(l)?l>0&&j.extend(a.getLineEnd(l-1)):(a=
this._getLine(l),j.extend(a.getNextOffset(c,d.unit,-1)),a.destroy());d.select||j.collapse();this._setSelection(j,!0);return!0},_doCut:function(d){var a=this._getSelection();return!a.isEmpty()?(a=this._getBaseText(a.start,a.end),this._doContent(""),this._setClipboardText(a,d)):!0},_doDelete:function(d){var a=this._getSelection();if(a.isEmpty()){var j=this._model,c=a.getCaret(),l=j.getLineAtOffset(c);c===j.getLineEnd(l)?l+1<j.getLineCount()&&a.extend(j.getLineStart(l+1)):(j=this._getLine(l),a.extend(j.getNextOffset(c,
d.unit,1)),j.destroy())}this._modifyContent({text:"",start:a.start,end:a.end},!0);return!0},_doEnd:function(d){var a=this._getSelection(),j=this._model,c;if(d.ctrl)a.extend(j.getCharCount()),c=function(){};else{var l=a.getCaret(),b=j.getLineAtOffset(l);if(this._wrapMode){var h=this._getLine(b),l=h.getLineIndex(l),l=l===h.getLineCount()-1?j.getLineEnd(b):h.getLineStart(l+1)-1;h.destroy()}else l=j.getLineEnd(b);a.extend(l)}d.select||a.collapse();this._setSelection(a,!0,!0,c);return!0},_doEnter:function(d){var a=
this._model,j=this._getSelection();this._doContent(a.getLineDelimiter());if(d&&d.noCursor)j.end=j.start,this._setSelection(j,!0);return!0},_doHome:function(d){var a=this._getSelection(),j=this._model,c;if(d.ctrl)a.extend(0),c=function(){};else{var l=a.getCaret(),b=j.getLineAtOffset(l);this._wrapMode?(j=this._getLine(b),l=j.getLineIndex(l),l=j.getLineStart(l),j.destroy()):l=j.getLineStart(b);a.extend(l)}d.select||a.collapse();this._setSelection(a,!0,!0,c);return!0},_doLineDown:function(d){var a=this._model,
j=this._getSelection(),b=j.getCaret(),l=a.getLineAtOffset(b),h=this._getLine(l),f=this._columnX,e=1,m=!1;if(f===-1||d.wholeLine||d.select&&c.isIE)f=d.wholeLine?a.getLineEnd(l+1):b,f=h.getBoundingClientRect(f).left;(b=h.getLineIndex(b))<h.getLineCount()-1?e=h.getClientRects(b+1).top+1:(m=l===a.getLineCount()-1,l++);m?d.select&&(j.extend(a.getCharCount()),this._setSelection(j,!0,!0)):(h.lineIndex!==l&&(h.destroy(),h=this._getLine(l)),j.extend(h.getOffset(f,e)),d.select||j.collapse(),this._setSelection(j,
!0,!0));this._columnX=f;h.destroy();return!0},_doLineUp:function(d){var a=this._model,j=this._getSelection(),b=j.getCaret(),l=a.getLineAtOffset(b),h=this._getLine(l),f=this._columnX,e=!1,m;if(f===-1||d.wholeLine||d.select&&c.isIE)f=d.wholeLine?a.getLineStart(l-1):b,f=h.getBoundingClientRect(f).left;(b=h.getLineIndex(b))>0?m=h.getClientRects(b-1).top+1:(e=l===0,e||(l--,m=this._getLineHeight(l)-1));e?d.select&&(j.extend(0),this._setSelection(j,!0,!0)):(h.lineIndex!==l&&(h.destroy(),h=this._getLine(l)),
j.extend(h.getOffset(f,m)),d.select||j.collapse(),this._setSelection(j,!0,!0));this._columnX=f;h.destroy();return!0},_doPageDown:function(d){var a=this,j=this._model,b=this._getSelection(),l=b.getCaret(),h=j.getLineAtOffset(l),f=j.getLineCount(),e=this._getScroll(),j=this._getClientHeight(),m,o;if(this._lineHeight){m=this._columnX;e=this._getBoundsAtOffset(l);if(m===-1||d.select&&c.isIE)m=e.left;l=this._getLineIndex(e.top+j);o=this._getLine(l);h=this._getLinePixel(l);l=o.getOffset(m,e.top+j-h);j=
o.getBoundingClientRect(l);o.destroy();b.extend(l);d.select||b.collapse();this._setSelection(b,!0,!0,function(){a._columnX=m},j.top+h-e.top);return!0}if(h<f-1){var g=this._getLineHeight(),n=Math.min(f-h-1,Math.floor(j/g)),n=Math.max(1,n);m=this._columnX;if(m===-1||d.select&&c.isIE)o=this._getLine(h),m=o.getBoundingClientRect(l).left,o.destroy();o=this._getLine(h+n);b.extend(o.getOffset(m,0));o.destroy();d.select||b.collapse();d=f*g;l=e.y+n*g;l+j>d&&(l=d-j);this._setSelection(b,!0,!0,function(){a._columnX=
m},l-e.y)}return!0},_doPageUp:function(d){var a=this,j=this._model,b=this._getSelection(),l=b.getCaret(),h=j.getLineAtOffset(l),f=this._getScroll(),e=this._getClientHeight(),m;if(this._lineHeight){m=this._columnX;f=this._getBoundsAtOffset(l);if(m===-1||d.select&&c.isIE)m=f.left;l=this._getLineIndex(f.bottom-e);j=this._getLine(l);h=this._getLinePixel(l);l=j.getOffset(m,f.bottom-e-h);e=j.getBoundingClientRect(l);j.destroy();b.extend(l);d.select||b.collapse();this._setSelection(b,!0,!0,function(){a._columnX=
m},e.top+h-f.top);return!0}if(h>0){var o=this._getLineHeight(),e=Math.max(1,Math.min(h,Math.floor(e/o)));m=this._columnX;if(m===-1||d.select&&c.isIE)j=this._getLine(h),m=j.getBoundingClientRect(l).left,j.destroy();j=this._getLine(h-e);b.extend(j.getOffset(m,this._getLineHeight(h-e)-1));j.destroy();d.select||b.collapse();d=Math.max(0,f.y-e*o);this._setSelection(b,!0,!0,function(){a._columnX=m},d-f.y)}return!0},_doPaste:function(d){var a=this;return this._getClipboardText(d,function(d){d&&(c.isLinux&&
a._lastMouseButton===2&&(new Date).getTime()-a._lastMouseTime<=a._clickTime&&a._setSelectionTo(a._lastMouseX,a._lastMouseY),a._doContent(d))})!==null},_doScroll:function(d){var a=d.type,j=this._model,c=j.getLineCount(),d=this._getClientHeight(),l=this._getLineHeight();c*=l;var b=this._getScroll().y,h;switch(a){case "textStart":h=0;break;case "textEnd":h=c-d;break;case "pageDown":h=b+d;break;case "pageUp":h=b-d;break;case "lineDown":h=b+l;break;case "lineUp":h=b-l;break;case "centerLine":a=this._getSelection(),
h=j.getLineAtOffset(a.start),j=(j.getLineAtOffset(a.end)-h+1)*l,h=h*l-d/2+j/2}h!==void 0&&(h=Math.min(Math.max(0,h),c-d),this._scrollViewAnimated(0,h-b,function(){}));return!0},_doSelectAll:function(){var d=this._model,a=this._getSelection();a.setCaret(0);a.extend(d.getCharCount());this._setSelection(a,!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var d="\t";if(this._expandTab)var a=this._model,d=this._getSelection().getCaret(),j=a.getLineAtOffset(d),a=a.getLineStart(j),d=Array(this._tabSize-
(d-a)%this._tabSize+1).join(" ");this._doContent(d);return!0}},_doShiftTab:function(){return!this._tabMode||this._readonly?void 0:!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var d=this._getSelection(),a=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),j=d.getCaret(),c=this._model.getLineAtOffset(j),l;if(this._autoScrollDir==="up"||this._autoScrollDir===
"down")j=this._autoScrollY/this._getLineHeight(),j=j<0?Math.floor(j):Math.ceil(j),l=c,l=Math.max(0,Math.min(this._model.getLineCount()-1,l+j));else if(this._autoScrollDir==="left"||this._autoScrollDir==="right")l=this._getLineIndex(a.y),c=this._getLine(c),a.x+=c.getBoundingClientRect(j,!1).left,c.destroy();c=this._getLine(l);d.extend(c.getOffset(a.x,a.y-this._getLinePixel(l)));c.destroy();this._setSelection(d,!0)},_autoScrollTimer:function(){this._autoScroll();var d=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){d._autoScrollTimer()},
this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(d){if(this._lineHeight&&!this._calculateLHTimer){var a=this._model.getLineCount(),j=0;if(d){for(var d=0,c=(new Date).getTime(),l=0;j<a;)if(this._lineHeight[j]||(d++,l||(l=j),this._lineHeight[j]=this._calculateLineHeight(j)),j++,(new Date).getTime()-c>100)break;this.redrawRulers(0,a);this._queueUpdate()}d=this._getWindow();if(j!==a){var b=this;this._calculateLHTimer=d.setTimeout(function(){b._calculateLHTimer=null;b._calculateLineHeightTimer(!0)},
0)}else if(this._calculateLHTimer)d.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0}},_calculateLineHeight:function(d){var d=this._getLine(d),a=d.getBoundingClientRect();d.destroy();return Math.max(1,Math.ceil(a.bottom-a.top))},_calculateMetrics:function(){var d=this._clientDiv,a=d.ownerDocument,j=c.createElement(a,"div");j.style.lineHeight="normal";var b={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(b);f(b.style,j);j.style.position=
"fixed";j.style.left="-1000px";var l=c.createElement(a,"span");l.appendChild(a.createTextNode(" "));j.appendChild(l);var e=c.createElement(a,"span");e.style.fontStyle="italic";e.appendChild(a.createTextNode(" "));j.appendChild(e);var m=c.createElement(a,"span");m.style.fontWeight="bold";m.appendChild(a.createTextNode(" "));j.appendChild(m);b=c.createElement(a,"span");b.style.fontWeight="bold";b.style.fontStyle="italic";b.appendChild(a.createTextNode(" "));j.appendChild(b);d.appendChild(j);var g=j.getBoundingClientRect(),
l=l.getBoundingClientRect(),e=e.getBoundingClientRect(),m=m.getBoundingClientRect(),b=b.getBoundingClientRect(),l=l.bottom-l.top,e=e.bottom-e.top,m=m.bottom-m.top,n=b.bottom-b.top,r=0,b=g.bottom-g.top<=0,g=Math.max(1,g.bottom-g.top);e>l&&(r=1);m>e&&(r=2);n>m&&(r=3);var i;if(r!==0){i={style:{}};if((r&1)!==0)i.style.fontStyle="italic";if((r&2)!==0)i.style.fontWeight="bold"}l=o(j);d.removeChild(j);e=h(this._viewDiv);j=c.createElement(a,"div");j.style.position="fixed";j.style.left="-1000px";j.style.paddingLeft=
e.left+"px";j.style.paddingTop=e.top+"px";j.style.paddingRight=e.right+"px";j.style.paddingBottom=e.bottom+"px";j.style.width="100px";j.style.height="100px";m=c.createElement(a,"div");m.style.width="100%";m.style.height="100%";j.appendChild(m);d.appendChild(j);a=j.getBoundingClientRect();e=m.getBoundingClientRect();j.style.overflow="hidden";m.style.height="200px";m=j.clientWidth;j.style.overflow="scroll";n=j.clientWidth;d.removeChild(j);e={left:e.left-a.left,top:e.top-a.top,right:a.right-e.right,
bottom:a.bottom-e.bottom};return{lineHeight:g,largestFontStyle:i,lineTrim:l,viewPadding:e,scrollWidth:m-n,invalid:b}},_cancelAnimation:function(){if(this._animation)this._animation.stop(),this._animation=null},_clearSelection:function(d){var a=this._getSelection();if(a.isEmpty())return!1;d==="next"?a.start=a.end:a.end=a.start;this._setSelection(a,!0);return!0},_commitIME:function(){if(this._imeOffset!==-1){this._scrollDiv.focus();this._clientDiv.focus();var d=this._model,a=d.getLineAtOffset(this._imeOffset),
j=d.getLineStart(a),c=this._getDOMText(this._getLineNode(a)).text,d=d.getLine(a),j=this._imeOffset-j,d=j+c.length-d.length;j!==d&&this._doContent(c.substring(j,d));this._imeOffset=-1}},_createActions:function(){var d=q.KeyBinding,a=this._keyBindings=[];a.push({actionID:"lineUp",keyBinding:new d(38),predefined:!0});a.push({actionID:"lineDown",keyBinding:new d(40),predefined:!0});a.push({actionID:"charPrevious",keyBinding:new d(37),predefined:!0});a.push({actionID:"charNext",keyBinding:new d(39),predefined:!0});
c.isMac?(a.push({actionID:"scrollPageUp",keyBinding:new d(33),predefined:!0}),a.push({actionID:"scrollPageDown",keyBinding:new d(34),predefined:!0}),a.push({actionID:"pageUp",keyBinding:new d(33,null,null,!0),predefined:!0}),a.push({actionID:"pageDown",keyBinding:new d(34,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new d(37,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(39,!0),predefined:!0}),a.push({actionID:"wordPrevious",keyBinding:new d(37,null,null,
!0),predefined:!0}),a.push({actionID:"wordNext",keyBinding:new d(39,null,null,!0),predefined:!0}),a.push({actionID:"scrollTextStart",keyBinding:new d(36),predefined:!0}),a.push({actionID:"scrollTextEnd",keyBinding:new d(35),predefined:!0}),a.push({actionID:"textStart",keyBinding:new d(38,!0),predefined:!0}),a.push({actionID:"textEnd",keyBinding:new d(40,!0),predefined:!0}),a.push({actionID:"scrollPageUp",keyBinding:new d(38,null,null,null,!0),predefined:!0}),a.push({actionID:"scrollPageDown",keyBinding:new d(40,
null,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new d(37,null,null,null,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(39,null,null,null,!0),predefined:!0}),a.push({actionID:"lineStart",keyBinding:new d(38,null,null,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(40,null,null,!0),predefined:!0})):(a.push({actionID:"pageUp",keyBinding:new d(33),predefined:!0}),a.push({actionID:"pageDown",keyBinding:new d(34),predefined:!0}),a.push({actionID:"lineStart",
keyBinding:new d(36),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d(35),predefined:!0}),a.push({actionID:"wordPrevious",keyBinding:new d(37,!0),predefined:!0}),a.push({actionID:"wordNext",keyBinding:new d(39,!0),predefined:!0}),a.push({actionID:"textStart",keyBinding:new d(36,!0),predefined:!0}),a.push({actionID:"textEnd",keyBinding:new d(35,!0),predefined:!0}));c.isFirefox&&c.isLinux&&(a.push({actionID:"lineUp",keyBinding:new d(38,!0),predefined:!0}),a.push({actionID:"lineDown",keyBinding:new d(40,
!0),predefined:!0}));c.isWindows&&(a.push({actionID:"scrollLineUp",keyBinding:new d(38,!0),predefined:!0}),a.push({actionID:"scrollLineDown",keyBinding:new d(40,!0),predefined:!0}));a.push({actionID:"selectLineUp",keyBinding:new d(38,null,!0),predefined:!0});a.push({actionID:"selectLineDown",keyBinding:new d(40,null,!0),predefined:!0});a.push({actionID:"selectCharPrevious",keyBinding:new d(37,null,!0),predefined:!0});a.push({actionID:"selectCharNext",keyBinding:new d(39,null,!0),predefined:!0});a.push({actionID:"selectPageUp",
keyBinding:new d(33,null,!0),predefined:!0});a.push({actionID:"selectPageDown",keyBinding:new d(34,null,!0),predefined:!0});c.isMac?(a.push({actionID:"selectLineStart",keyBinding:new d(37,!0,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new d(39,!0,!0),predefined:!0}),a.push({actionID:"selectWordPrevious",keyBinding:new d(37,null,!0,!0),predefined:!0}),a.push({actionID:"selectWordNext",keyBinding:new d(39,null,!0,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new d(36,
null,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new d(35,null,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new d(38,!0,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new d(40,!0,!0),predefined:!0}),a.push({actionID:"selectLineStart",keyBinding:new d(37,null,!0,null,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new d(39,null,!0,null,!0),predefined:!0}),a.push({actionID:"selectLineStart",keyBinding:new d(38,null,!0,!0),predefined:!0}),
a.push({actionID:"selectLineEnd",keyBinding:new d(40,null,!0,!0),predefined:!0})):(c.isLinux&&(a.push({actionID:"selectWholeLineUp",keyBinding:new d(38,!0,!0),predefined:!0}),a.push({actionID:"selectWholeLineDown",keyBinding:new d(40,!0,!0),predefined:!0})),a.push({actionID:"selectLineStart",keyBinding:new d(36,null,!0),predefined:!0}),a.push({actionID:"selectLineEnd",keyBinding:new d(35,null,!0),predefined:!0}),a.push({actionID:"selectWordPrevious",keyBinding:new d(37,!0,!0),predefined:!0}),a.push({actionID:"selectWordNext",
keyBinding:new d(39,!0,!0),predefined:!0}),a.push({actionID:"selectTextStart",keyBinding:new d(36,!0,!0),predefined:!0}),a.push({actionID:"selectTextEnd",keyBinding:new d(35,!0,!0),predefined:!0}));a.push({actionID:"undo",keyBinding:new q.KeyBinding("z",!0),predefined:!0});c.isMac?a.push({actionID:"redo",keyBinding:new q.KeyBinding("z",!0,!0),predefined:!0}):a.push({actionID:"redo",keyBinding:new q.KeyBinding("y",!0),predefined:!0});a.push({actionID:"deletePrevious",keyBinding:new d(8),predefined:!0});
a.push({actionID:"deletePrevious",keyBinding:new d(8,null,!0),predefined:!0});a.push({actionID:"deleteNext",keyBinding:new d(46),predefined:!0});a.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0),predefined:!0});a.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0,!0),predefined:!0});a.push({actionID:"deleteWordNext",keyBinding:new d(46,!0),predefined:!0});a.push({actionID:"tab",keyBinding:new d(9),predefined:!0});a.push({actionID:"shiftTab",keyBinding:new d(9,null,!0),predefined:!0});
a.push({actionID:"enter",keyBinding:new d(13),predefined:!0});a.push({actionID:"enter",keyBinding:new d(13,null,!0),predefined:!0});a.push({actionID:"selectAll",keyBinding:new d("a",!0),predefined:!0});a.push({actionID:"toggleTabMode",keyBinding:new d("m",!0),predefined:!0});c.isMac&&(a.push({actionID:"deleteNext",keyBinding:new d(46,null,!0),predefined:!0}),a.push({actionID:"deleteWordPrevious",keyBinding:new d(8,null,null,!0),predefined:!0}),a.push({actionID:"deleteWordNext",keyBinding:new d(46,
null,null,!0),predefined:!0}));if(!c.isFirefox){var j=c.isMac&&c.isChrome;a.push({actionID:null,keyBinding:new d("u",!j,!1,!1,j),predefined:!0});a.push({actionID:null,keyBinding:new d("i",!j,!1,!1,j),predefined:!0});a.push({actionID:null,keyBinding:new d("b",!j,!1,!1,j),predefined:!0})}c.isFirefox&&(a.push({actionID:"copy",keyBinding:new d(45,!0),predefined:!0}),a.push({actionID:"paste",keyBinding:new d(45,null,!0),predefined:!0}),a.push({actionID:"cut",keyBinding:new d(46,null,!0),predefined:!0}));
c.isMac&&(a.push({actionID:"lineStart",keyBinding:new d("a",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineEnd",keyBinding:new d("e",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineUp",keyBinding:new d("p",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"lineDown",keyBinding:new d("n",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"charPrevious",keyBinding:new d("b",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"charNext",keyBinding:new d("f",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deletePrevious",
keyBinding:new d("h",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteNext",keyBinding:new d("d",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteLineEnd",keyBinding:new d("k",!1,!1,!1,!0),predefined:!0}),c.isFirefox?(a.push({actionID:"scrollPageDown",keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteLineStart",keyBinding:new d("u",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"deleteWordPrevious",keyBinding:new d("w",!1,!1,!1,!0),predefined:!0})):(a.push({actionID:"pageDown",
keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"centerLine",keyBinding:new d("l",!1,!1,!1,!0),predefined:!0}),a.push({actionID:"enterNoCursor",keyBinding:new d("o",!1,!1,!1,!0),predefined:!0})));var b=this;this._actions={lineUp:{defaultHandler:function(){return b._doLineUp({select:!1})}},lineDown:{defaultHandler:function(){return b._doLineDown({select:!1})}},lineStart:{defaultHandler:function(){return b._doHome({select:!1,ctrl:!1})}},lineEnd:{defaultHandler:function(){return b._doEnd({select:!1,
ctrl:!1})}},charPrevious:{defaultHandler:function(){return b._doCursorPrevious({select:!1,unit:"character"})}},charNext:{defaultHandler:function(){return b._doCursorNext({select:!1,unit:"character"})}},pageUp:{defaultHandler:function(){return b._doPageUp({select:!1})}},pageDown:{defaultHandler:function(){return b._doPageDown({select:!1})}},scrollPageUp:{defaultHandler:function(){return b._doScroll({type:"pageUp"})}},scrollPageDown:{defaultHandler:function(){return b._doScroll({type:"pageDown"})}},
scrollLineUp:{defaultHandler:function(){return b._doScroll({type:"lineUp"})}},scrollLineDown:{defaultHandler:function(){return b._doScroll({type:"lineDown"})}},wordPrevious:{defaultHandler:function(){return b._doCursorPrevious({select:!1,unit:"word"})}},wordNext:{defaultHandler:function(){return b._doCursorNext({select:!1,unit:"word"})}},textStart:{defaultHandler:function(){return b._doHome({select:!1,ctrl:!0})}},textEnd:{defaultHandler:function(){return b._doEnd({select:!1,ctrl:!0})}},scrollTextStart:{defaultHandler:function(){return b._doScroll({type:"textStart"})}},
scrollTextEnd:{defaultHandler:function(){return b._doScroll({type:"textEnd"})}},centerLine:{defaultHandler:function(){return b._doScroll({type:"centerLine"})}},selectLineUp:{defaultHandler:function(){return b._doLineUp({select:!0})}},selectLineDown:{defaultHandler:function(){return b._doLineDown({select:!0})}},selectWholeLineUp:{defaultHandler:function(){return b._doLineUp({select:!0,wholeLine:!0})}},selectWholeLineDown:{defaultHandler:function(){return b._doLineDown({select:!0,wholeLine:!0})}},selectLineStart:{defaultHandler:function(){return b._doHome({select:!0,
ctrl:!1})}},selectLineEnd:{defaultHandler:function(){return b._doEnd({select:!0,ctrl:!1})}},selectCharPrevious:{defaultHandler:function(){return b._doCursorPrevious({select:!0,unit:"character"})}},selectCharNext:{defaultHandler:function(){return b._doCursorNext({select:!0,unit:"character"})}},selectPageUp:{defaultHandler:function(){return b._doPageUp({select:!0})}},selectPageDown:{defaultHandler:function(){return b._doPageDown({select:!0})}},selectWordPrevious:{defaultHandler:function(){return b._doCursorPrevious({select:!0,
unit:"word"})}},selectWordNext:{defaultHandler:function(){return b._doCursorNext({select:!0,unit:"word"})}},selectTextStart:{defaultHandler:function(){return b._doHome({select:!0,ctrl:!0})}},selectTextEnd:{defaultHandler:function(){return b._doEnd({select:!0,ctrl:!0})}},deletePrevious:{defaultHandler:function(){return b._doBackspace({unit:"character"})}},deleteNext:{defaultHandler:function(){return b._doDelete({unit:"character"})}},deleteWordPrevious:{defaultHandler:function(){return b._doBackspace({unit:"word"})}},
deleteWordNext:{defaultHandler:function(){return b._doDelete({unit:"word"})}},deleteLineStart:{defaultHandler:function(){return b._doBackspace({unit:"line"})}},deleteLineEnd:{defaultHandler:function(){return b._doDelete({unit:"line"})}},tab:{defaultHandler:function(){return b._doTab()}},shiftTab:{defaultHandler:function(){return b._doShiftTab()}},enter:{defaultHandler:function(){return b._doEnter()}},enterNoCursor:{defaultHandler:function(){return b._doEnter({noCursor:!0})}},selectAll:{defaultHandler:function(){return b._doSelectAll()}},
copy:{defaultHandler:function(){return b._doCopy()}},cut:{defaultHandler:function(){return b._doCut()}},paste:{defaultHandler:function(){return b._doPaste()}},toggleWrapMode:{defaultHandler:function(){return b._doWrapMode()}},toggleTabMode:{defaultHandler:function(){return b._doTabMode()}}}},_createRuler:function(d,a){if(this._clientDiv){var j=d.getLocation()==="left"?this._leftDiv:this._rightDiv;j.style.display="block";var b=c.createElement(j.ownerDocument,"div");b._ruler=d;b.rulerChanged=!0;b.style.position=
"relative";b.style.cssFloat="left";b.style.styleFloat="left";b.style.borderWidth="0px";b.style.margin="0px";b.style.padding="0px";b.style.outline="none";if(a===void 0||a<0||a>=j.children.length)j.appendChild(b);else{for(var l=j.firstChild;l&&--a>0;)l=l.nextSibling;j.insertBefore(b,l)}}},_createView:function(){if(!this._clientDiv){for(var d=this._parent;d.hasChildNodes();)d.removeChild(d.lastChild);var a=d.ownerDocument,j=c.createElement(a,"div");this._rootDiv=j;j.tabIndex=-1;j.style.position="relative";
j.style.overflow="hidden";j.style.width="100%";j.style.height="100%";j.style.overflow="hidden";j.style.WebkitTextSizeAdjust="100%";j.setAttribute("role","application");d.appendChild(j);d=c.createElement(a,"div");d.className="textviewLeftRuler";this._leftDiv=d;d.tabIndex=-1;d.style.overflow="hidden";d.style.MozUserSelect="none";d.style.WebkitUserSelect="none";d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.cursor="default";d.style.display="none";d.setAttribute("aria-hidden",
"true");j.appendChild(d);d=c.createElement(a,"div");d.className="textviewScroll";this._viewDiv=d;d.tabIndex=-1;d.style.overflow="auto";d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.borderWidth="0px";d.style.margin="0px";d.style.outline="none";d.style.background="transparent";if(c.isMac&&c.isWebkit)d.style.pointerEvents="none",d.style.zIndex="2";j.appendChild(d);var b=c.createElement(a,"div");b.className="textviewRightRuler";this._rightDiv=b;b.tabIndex=-1;b.style.display=
"none";b.style.overflow="hidden";b.style.MozUserSelect="none";b.style.WebkitUserSelect="none";b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.cursor="default";b.style.right="0px";b.setAttribute("aria-hidden","true");j.appendChild(b);this._scrollDiv=b=c.createElement(a,"div");b.style.margin="0px";b.style.borderWidth="0px";b.style.padding="0px";d.appendChild(b);if(c.isFirefox)this._clipboardDiv=d=c.createElement(a,"div"),d.style.position="fixed",d.style.whiteSpace="pre",d.style.left=
"-1000px",j.appendChild(d);if(!c.isIE&&!c.isIOS)this._clipDiv=d=c.createElement(a,"div"),d.style.position="absolute",d.style.overflow="hidden",d.style.margin="0px",d.style.borderWidth="0px",d.style.padding="0px",d.style.background="transparent",j.appendChild(d),this._clipScrollDiv=b=c.createElement(a,"div"),b.style.position="absolute",b.style.height="1px",b.style.top="-1000px",b.style.background="transparent",d.appendChild(b);this._setFullSelection(this._fullSelection,!0);d=c.createElement(a,"div");
d.className="textviewContent";this._clientDiv=d;d.style.position="absolute";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.zIndex="1";d.style.WebkitUserSelect="text";d.setAttribute("spellcheck","false");if(c.isIOS||c.isAndroid)d.style.WebkitTapHighlightColor="transparent";(this._clipDiv||j).appendChild(d);if(c.isIOS||c.isAndroid)this._vScrollDiv=b=c.createElement(a,"div"),b.style.position="absolute",b.style.borderWidth="1px",b.style.borderColor=
"white",b.style.borderStyle="solid",b.style.borderRadius="4px",b.style.backgroundColor="black",b.style.opacity="0.5",b.style.margin="0px",b.style.padding="0px",b.style.outline="none",b.style.zIndex="3",b.style.width="8px",b.style.display="none",j.appendChild(b),this._hScrollDiv=b=c.createElement(a,"div"),b.style.position="absolute",b.style.borderWidth="1px",b.style.borderColor="white",b.style.borderStyle="solid",b.style.borderRadius="4px",b.style.backgroundColor="black",b.style.opacity="0.5",b.style.margin=
"0px",b.style.padding="0px",b.style.outline="none",b.style.zIndex="3",b.style.height="8px",b.style.display="none",j.appendChild(b);if(c.isFirefox&&!d.setCapture)this._overlayDiv=a=c.createElement(a,"div"),a.style.position=d.style.position,a.style.borderWidth=d.style.borderWidth,a.style.margin=d.style.margin,a.style.padding=d.style.padding,a.style.cursor="text",a.style.zIndex="2",(this._clipDiv||j).appendChild(a);d.contentEditable="true";d.setAttribute("role","textbox");d.setAttribute("aria-multiline",
"true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._hookEvents();j=this._rulers;for(a=0;a<j.length;a++)this._createRuler(j[a]);this._update()}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},
tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},wrapMode:{value:!1,update:this._setWrapMode},theme:{value:i.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(d){var a=d.getLocation()==="left"?this._leftDiv:this._rightDiv;if(a)for(var b=a.firstChild;b;){if(b._ruler===d){b._ruler=void 0;a.removeChild(b);if(a.children.length===0)a.style.display="none";break}b=b.nextSibling}},
_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var d=this._getWindow();if(this._autoScrollTimerID)d.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null;if(this._updateTimer)d.clearTimeout(this._updateTimer),this._updateTimer=null;d=this._rootDiv;d.parentNode.removeChild(d);this._hScrollDiv=this._vScrollDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=
this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(d,a,b){this._autoScrollDir=d;this._autoScrollX=a;this._autoScrollY=b;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var d=this._clientDiv;if(d){var a=this._hasFocus;this._ignoreFocus=!0;a&&d.blur();d.contentEditable=!1;d.contentEditable=
!0;a&&d.focus();this._ignoreFocus=!1}},_getBaseText:function(d,a){var b=this._model;b.getBaseModel&&(d=b.mapOffset(d),a=b.mapOffset(a),b=b.getBaseModel());return b.getText(d,a)},_getBottomIndex:function(d){var a=this._bottomChild;if(d&&this._getClientHeight()>this._getLineHeight()){var d=a.getBoundingClientRect(),b=this._clientDiv.getBoundingClientRect();d.bottom>b.bottom&&(a=this._getLinePrevious(a)||a)}return a.lineIndex},_getBoundsAtOffset:function(d){var a=this._getLine(this._model.getLineAtOffset(d)),
d=a.getBoundingClientRect(d),b=this._getLinePixel(a.lineIndex);d.top+=b;d.bottom+=b;a.destroy();return d},_getClientHeight:function(){var d=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-d.top-d.bottom)},_getClientWidth:function(){var d=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-d.left-d.right)},_getClipboardText:function(d,b){var j=this._model.getLineDelimiter(),h,l,f=this._getWindow();if(f.clipboardData)return h=[],l=f.clipboardData.getData("Text"),a(l,
function(d){h.push(d)},function(){h.push(j)}),l=h.join(""),b&&b(l),l;if(c.isFirefox){this._ignoreFocus=!0;var e=this._clipboardDiv;e.innerHTML="<pre contenteditable=''></pre>";e.firstChild.focus();var m=this,o=function(){var d=m._getTextFromElement(e);e.innerHTML="";h=[];a(d,function(d){h.push(d)},function(){h.push(j)});return h.join("")},g=!1;this._ignorePaste=!0;if(!c.isLinux||this._lastMouseButton!==2)try{g=e.ownerDocument.execCommand("paste",!1,null)}catch(n){g=e.childNodes.length>1||e.firstChild&&
e.firstChild.childNodes.length>0}this._ignorePaste=!1;if(!g)return d?(f.setTimeout(function(){m.focus();(l=o())&&b&&b(l);m._ignoreFocus=!1},0),null):(this.focus(),this._ignoreFocus=!1,"");this.focus();this._ignoreFocus=!1;(l=o())&&b&&b(l);return l}return d&&d.clipboardData?(h=[],l=d.clipboardData.getData("text/plain"),a(l,function(d){h.push(d)},function(){h.push(j)}),(l=h.join(""))&&b&&b(l),l):""},_getDOMText:function(d,a){for(var b=d.firstChild,c="",l=0;b;){var h;if(b.ignoreChars){h=b.lastChild;
for(var f=0,e=[],m=-1;h;){for(var o=h.data,g=o.length-1;g>=0;g--){var n=o.substring(g,g+1);f<b.ignoreChars&&(n===" "||n==="\u200c"||n==="\ufeff")?f++:e.push(n==="\u00a0"?"\t":n)}if(a===h)m=e.length;h=h.previousSibling}e=e.reverse().join("");m!==-1&&(l=c.length+e.length-m);c+=e}else for(h=b.firstChild;h;){if(a===h)l=c.length;c+=h.data;h=h.nextSibling}b=b.nextSibling}return{text:c,offset:l}},_getTextFromElement:function(d){var a=d.ownerDocument,b=a.defaultView;if(!b.getSelection)return d.innerText||
d.textContent;a=a.createRange();a.selectNode(d);var d=b.getSelection(),b=[],c;for(c=0;c<d.rangeCount;c++)b.push(d.getRangeAt(c));this._ignoreSelect=!0;d.removeAllRanges();d.addRange(a);a=d.toString();d.removeAllRanges();for(c=0;c<b.length;c++)d.addRange(b[c]);this._ignoreSelect=!1;return a},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(d){var a=this._getLineNode(d);return a&&!a.lineChanged&&!a.lineRemoved?a._line:new r(this,d)},_getLineHeight:function(d,a){if(d!==
void 0&&this._lineHeight){var b=this._lineHeight[d];if(b)return b;if(a||a===void 0)return this._lineHeight[d]=this._calculateLineHeight(d)}return this._metrics.lineHeight},_getLineNode:function(d){for(var a=this._clientDiv.firstChild;a;){if(d===a.lineIndex)return a;a=a.nextSibling}},_getLineNext:function(d){for(d=d?d.nextSibling:this._clientDiv.firstChild;d&&d.lineIndex===-1;)d=d.nextSibling;return d},_getLinePrevious:function(d){for(d=d?d.previousSibling:this._clientDiv.lastChild;d&&d.lineIndex===
-1;)d=d.previousSibling;return d},_getLinePixel:function(d){d=Math.min(Math.max(0,d),this._model.getLineCount());if(this._lineHeight){var a=this._getTopIndex(),b=-this._topIndexY+this._getScroll().y;if(d>a)for(;a<d;a++)b+=this._getLineHeight(a);else for(a-=1;a>=d;a--)b-=this._getLineHeight(a);return b}return this._getLineHeight()*d},_getLineIndex:function(d){var a,b=0,c=this._model.getLineCount();if(this._lineHeight){var b=this._getTopIndex(),l=-this._topIndexY+this._getScroll().y;if(d!==l)if(d<l)for(;d<
l&&b>0;)d+=this._getLineHeight(--b);else for(a=this._getLineHeight(b);d-a>=l&&b<c-1;)d-=a,a=this._getLineHeight(++b)}else a=this._getLineHeight(),b=Math.floor(d/a);return Math.max(0,Math.min(c-1,b))},_getScroll:function(d){(d===void 0||d)&&this._cancelAnimation();d=this._viewDiv;return{x:d.scrollLeft,y:d.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(d){var a=this._topChild;if(d&&this._getClientHeight()>this._getLineHeight()){var d=a.getBoundingClientRect(),
b=this._getViewPadding(),c=this._viewDiv.getBoundingClientRect();d.top<c.top+b.top&&(a=this._getLineNext(a)||a)}return a.lineIndex},_hookEvents:function(){var d=this;this._modelListener={onChanging:function(a){d._onModelChanging(a)},onChanged:function(a){d._onModelChanged(a)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){d._setThemeClass(d._themeClass)}};
this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var a=this._handlers=[],b=this._clientDiv,h=this._viewDiv,l=this._rootDiv,f=this._overlayDiv||b,m=b.ownerDocument,o=this._getWindow(),g=c.isIE?m:o;a.push({target:o,type:"resize",handler:function(a){return d._handleResize(a?a:o.event)}});a.push({target:b,type:"blur",handler:function(a){return d._handleBlur(a?a:o.event)}});a.push({target:b,type:"focus",handler:function(a){return d._handleFocus(a?a:o.event)}});a.push({target:h,
type:"focus",handler:function(){b.focus()}});a.push({target:h,type:"scroll",handler:function(a){return d._handleScroll(a?a:o.event)}});a.push({target:b,type:"textInput",handler:function(a){return d._handleTextInput(a?a:o.event)}});a.push({target:b,type:"keydown",handler:function(a){return d._handleKeyDown(a?a:o.event)}});a.push({target:b,type:"keypress",handler:function(a){return d._handleKeyPress(a?a:o.event)}});a.push({target:b,type:"keyup",handler:function(a){return d._handleKeyUp(a?a:o.event)}});
a.push({target:b,type:"contextmenu",handler:function(a){return d._handleContextMenu(a?a:o.event)}});a.push({target:b,type:"copy",handler:function(a){return d._handleCopy(a?a:o.event)}});a.push({target:b,type:"cut",handler:function(a){return d._handleCut(a?a:o.event)}});a.push({target:b,type:"paste",handler:function(a){return d._handlePaste(a?a:o.event)}});if(c.isIOS||c.isAndroid)a.push({target:m,type:"selectionchange",handler:function(a){return d._handleSelectionChange(a?a:o.event)}}),a.push({target:b,
type:"touchstart",handler:function(a){return d._handleTouchStart(a?a:o.event)}}),a.push({target:b,type:"touchmove",handler:function(a){return d._handleTouchMove(a?a:o.event)}}),a.push({target:b,type:"touchend",handler:function(a){return d._handleTouchEnd(a?a:o.event)}});else{a.push({target:b,type:"selectstart",handler:function(a){return d._handleSelectStart(a?a:o.event)}});a.push({target:b,type:"mousedown",handler:function(a){return d._handleMouseDown(a?a:o.event)}});a.push({target:b,type:"mouseover",
handler:function(a){return d._handleMouseOver(a?a:o.event)}});a.push({target:b,type:"mouseout",handler:function(a){return d._handleMouseOut(a?a:o.event)}});a.push({target:g,type:"mouseup",handler:function(a){return d._handleMouseUp(a?a:o.event)}});a.push({target:g,type:"mousemove",handler:function(a){return d._handleMouseMove(a?a:o.event)}});a.push({target:l,type:"mousedown",handler:function(a){return d._handleRootMouseDown(a?a:o.event)}});a.push({target:l,type:"mouseup",handler:function(a){return d._handleRootMouseUp(a?
a:o.event)}});a.push({target:f,type:"dragstart",handler:function(a){return d._handleDragStart(a?a:o.event)}});a.push({target:f,type:"drag",handler:function(a){return d._handleDrag(a?a:o.event)}});a.push({target:f,type:"dragend",handler:function(a){return d._handleDragEnd(a?a:o.event)}});a.push({target:f,type:"dragenter",handler:function(a){return d._handleDragEnter(a?a:o.event)}});a.push({target:f,type:"dragover",handler:function(a){return d._handleDragOver(a?a:o.event)}});a.push({target:f,type:"dragleave",
handler:function(a){return d._handleDragLeave(a?a:o.event)}});a.push({target:f,type:"drop",handler:function(a){return d._handleDrop(a?a:o.event)}});a.push({target:this._clientDiv,type:c.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return d._handleMouseWheel(a?a:o.event)}});if(c.isFirefox&&(!c.isWindows||c.isFirefox>=15))(h=o.MutationObserver||o.MozMutationObserver)?(this._mutationObserver=new h(function(a){d._handleDataModified(a)}),this._mutationObserver.observe(b,{subtree:!0,characterData:!0})):
a.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(a){return d._handleDataModified(a?a:o.event)}});this._overlayDiv&&(a.push({target:this._overlayDiv,type:"mousedown",handler:function(a){return d._handleMouseDown(a?a:o.event)}}),a.push({target:this._overlayDiv,type:"mouseover",handler:function(a){return d._handleMouseOver(a?a:o.event)}}),a.push({target:this._overlayDiv,type:"mouseout",handler:function(a){return d._handleMouseOut(a?a:o.event)}}),a.push({target:this._overlayDiv,
type:"contextmenu",handler:function(a){return d._handleContextMenu(a?a:o.event)}}));this._isW3CEvents||a.push({target:this._clientDiv,type:"dblclick",handler:function(a){return d._handleDblclick(a?a:o.event)}})}h=this._leftDiv;l=this._rightDiv;c.isIE&&a.push({target:h,type:"selectstart",handler:function(){return!1}});a.push({target:h,type:c.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return d._handleMouseWheel(a?a:o.event)}});a.push({target:h,type:"click",handler:function(a){d._handleRulerEvent(a?
a:o.event)}});a.push({target:h,type:"dblclick",handler:function(a){d._handleRulerEvent(a?a:o.event)}});a.push({target:h,type:"mousemove",handler:function(a){d._handleRulerEvent(a?a:o.event)}});a.push({target:h,type:"mouseover",handler:function(a){d._handleRulerEvent(a?a:o.event)}});a.push({target:h,type:"mouseout",handler:function(a){d._handleRulerEvent(a?a:o.event)}});c.isIE&&a.push({target:l,type:"selectstart",handler:function(){return!1}});a.push({target:l,type:c.isFirefox?"DOMMouseScroll":"mousewheel",
handler:function(a){return d._handleMouseWheel(a?a:o.event)}});a.push({target:l,type:"click",handler:function(a){d._handleRulerEvent(a?a:o.event)}});a.push({target:l,type:"dblclick",handler:function(a){d._handleRulerEvent(a?a:o.event)}});a.push({target:l,type:"mousemove",handler:function(a){d._handleRulerEvent(a?a:o.event)}});a.push({target:l,type:"mouseover",handler:function(a){d._handleRulerEvent(a?a:o.event)}});a.push({target:l,type:"mouseout",handler:function(a){d._handleRulerEvent(a?a:o.event)}});
for(h=0;h<a.length;h++)l=a[h],e(l.target,l.type,l.handler,l.capture)},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_init:function(a){var b=a.parent;typeof b==="string"&&(b=(a.document||document).getElementById(b));if(!b)throw"no parent";a.parent=b;a.model=a.model||new s.TextModel;var j=this._defaultOptions(),h;for(h in j)j.hasOwnProperty(h)&&(this["_"+h]=a[h]!==void 0?a[h]:j[h].value);this._rulers=[];this._selection=new m(0,0,!1);this._linksVisible=
!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=(!c.isIE||c.isIE>=9)&&typeof b.ownerDocument.createRange().getBoundingClientRect==="function";this._isW3CEvents=b.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=
this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_modifyContent:function(a,b){if(!this._readonly||a._code)if(a.type="Verify",this.onVerify(a),!(a.text===null||a.text===void 0)){var c=this._model;try{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!0;c.setText(a.text,a.start,a.end)}finally{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!1}b&&(c=
this._getSelection(),c.setCaret(a.start+a.text.length),this._setSelection(c,!0));this.onModify({type:"Modify"})}},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var b=a.start,c=a.addedCharCount,h=a.removedCharCount,l=a.addedLineCount,f=a.removedLineCount,e=this._getSelection();e.end>b&&(e.end>b&&e.start<b+h?e.setCaret(b+c):(e.start+=c-h,e.end+=c-h),this._setSelection(e,!1,!1));b=this._model.getLineAtOffset(b);for(c=this._getLineNext();c;){h=c.lineIndex;if(b<=
h&&h<=b+f)b===h&&!c.modelChangedEvent&&!c.lineRemoved?(c.modelChangedEvent=a,c.lineChanged=!0):(c.lineRemoved=!0,c.lineChanged=!1,c.modelChangedEvent=null);if(h>b+f)c.lineIndex=h+l-f,c._line.lineIndex=c.lineIndex;c=this._getLineNext(c)}if(!this._wrapMode&&b<=this._maxLineIndex&&this._maxLineIndex<=b+f)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&
!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,b){if(this._wrapMode){if(a!==void 0&&b!==void 0)for(var c=a;c<b;c++)this._lineHeight[c]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=
-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._resetLineHeight();this._setSelection(new m(0,0,!1),!1,!1);if(this._viewDiv)this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0;var a=this._clientDiv;if(a){for(var b=a.firstChild;b;)b.lineRemoved=!0,b=b.nextSibling;if(c.isFirefox)this._ignoreFocus=!1,(b=this._hasFocus)&&a.blur(),a.contentEditable=!1,a.contentEditable=!0,b&&a.focus(),this._ignoreFocus=!1}},_scrollViewAnimated:function(a,b,c){if(c&&
this._scrollAnimation){var h=this;this._animation=new t({window:this._getWindow(),duration:this._scrollAnimation,curve:[b,0],onAnimate:function(a){a=b-Math.floor(a);h._scrollView(0,a);b-=a},onEnd:function(){h._animation=null;h._scrollView(a,b);c&&c()}});this._animation.play()}else this._scrollView(a,b),c&&c()},_scrollView:function(a,b){this._ensureCaretVisible=!1;var c=this._viewDiv;a&&(c.scrollLeft+=a);b&&(c.scrollTop+=b)},_setClipboardText:function(d,b){var h,f=this._parent.ownerDocument,l=this._getWindow();
if(l.clipboardData)return h=[],a(d,function(a){h.push(a)},function(){h.push(c.platformDelimiter)}),l.clipboardData.setData("Text",h.join(""));if(b&&b.clipboardData&&(h=[],a(d,function(a){h.push(a)},function(){h.push(c.platformDelimiter)}),b.clipboardData.setData("text/plain",h.join(""))))return!0;var e=c.createElement(f,"pre");e.style.position="fixed";e.style.left="-1000px";a(d,function(a){e.appendChild(f.createTextNode(a))},function(){e.appendChild(c.createElement(f,"br"))});e.appendChild(f.createTextNode(" "));
this._clientDiv.appendChild(e);var o=f.createRange();o.setStart(e.firstChild,0);o.setEndBefore(e.lastChild);var m=l.getSelection();m.rangeCount>0&&m.removeAllRanges();m.addRange(o);var g=this,o=function(){e&&e.parentNode===g._clientDiv&&g._clientDiv.removeChild(e);g._updateDOMSelection()},m=!1;this._ignoreCopy=!0;try{m=f.execCommand("copy",!1,null)}catch(n){}this._ignoreCopy=!1;if(!m&&b)return l.setTimeout(o,0),!1;o();return!0},_setDOMSelection:function(a,b,h,f){for(var l,e,o,m,g=0,n=a.firstChild,
r,i,u=this._model.getLine(a.lineIndex).length;n;){r=n.firstChild;i=r.length;n.ignoreChars&&(i-=n.ignoreChars);if(g+i>b||g+i>=u){l=r;e=b-g;n.ignoreChars&&i>0&&e===i&&(e+=n.ignoreChars);break}g+=i;n=n.nextSibling}for(var g=0,n=h.firstChild,C=this._model.getLine(h.lineIndex).length;n;){r=n.firstChild;i=r.length;n.ignoreChars&&(i-=n.ignoreChars);if(i+g>f||g+i>=C){o=r;m=f-g;n.ignoreChars&&i>0&&m===i&&(m+=n.ignoreChars);break}g+=i;n=n.nextSibling}this._setDOMFullSelection(a,b,u,h,f,C);if(this._hasFocus)if(b=
this._getWindow(),a=this._parent.ownerDocument,b.getSelection){if(b=b.getSelection(),!(b.anchorNode===l&&b.anchorOffset===e&&b.focusNode===o&&b.focusOffset===m||b.anchorNode===o&&b.anchorOffset===m&&b.focusNode===l&&b.focusOffset===e))a=a.createRange(),a.setStart(l,e),a.setEnd(o,m),this._ignoreSelect=!1,b.rangeCount>0&&b.removeAllRanges(),b.addRange(a),this._ignoreSelect=!0}else if(a.selection)b=a.body,a=c.createElement(a,"div"),b.appendChild(a),b.removeChild(a),a=b.createTextRange(),a.moveToElementText(l.parentNode),
a.moveStart("character",e),l=b.createTextRange(),l.moveToElementText(o.parentNode),l.moveStart("character",m),a.setEndPoint("EndToStart",l),this._ignoreSelect=!1,a.select(),this._ignoreSelect=!0},_setDOMFullSelection:function(a,b,c,h,l){if(this._selDiv1&&(c=this._selDiv1,c.style.width="0px",c.style.height="0px",c=this._selDiv2,c.style.width="0px",c.style.height="0px",c=this._selDiv3,c.style.width="0px",c.style.height="0px",!(a===h&&b===l))){var f=this._model,e=this._getViewPadding(),o=this._clientDiv.getBoundingClientRect(),
m=this._viewDiv.getBoundingClientRect(),c=m.left+e.left,g=o.right,e=m.top+e.top,n=o.bottom,m=o=0;this._clipDiv?(m=this._clipDiv.getBoundingClientRect(),o=m.left-this._clipDiv.scrollLeft):(m=this._rootDiv.getBoundingClientRect(),o=m.left);m=m.top;this._ignoreDOMSelection=!0;var a=(new r(this,a.lineIndex,a)).getBoundingClientRect(f.getLineStart(a.lineIndex)+b,!1),i=a.left,l=(new r(this,h.lineIndex,h)).getBoundingClientRect(f.getLineStart(h.lineIndex)+l,!1),b=l.left;this._ignoreDOMSelection=!1;var f=
this._selDiv1,i=Math.min(g,Math.max(c,i)),u=Math.min(n,Math.max(e,a.top)),C=g,h=Math.min(n,Math.max(e,a.bottom));f.style.left=i-o+"px";f.style.top=u-m+"px";f.style.width=Math.max(0,C-i)+"px";f.style.height=Math.max(0,h-u)+"px";if(a.top===l.top)C=Math.min(b,g),f.style.width=Math.max(0,C-i)+"px";else if(a=Math.min(n,Math.max(e,l.top)),b=Math.min(g,Math.max(c,b)),e=Math.min(n,Math.max(e,l.bottom)),n=this._selDiv3,n.style.left=c-o+"px",n.style.top=a-m+"px",n.style.width=Math.max(0,b-c)+"px",n.style.height=
Math.max(0,e-a)+"px",a-h>0)e=this._selDiv2,e.style.left=c-o+"px",e.style.top=h-m+"px",e.style.width=Math.max(0,g-c)+"px",e.style.height=Math.max(0,a-h)+"px"}},_setGrab:function(a){if(a!==this._grabControl)a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null)},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;if(c.isIE&&a)this._hadFocus=this._hasFocus;var b=this._clientDiv;b.contentEditable=
!a;this._hadFocus&&!a&&b.focus();if(this._overlayDiv)this._overlayDiv.style.zIndex=a?"-1":"1";for(a=this._getLineNext();a;){if(a.hasLink)for(b=a.firstChild;b;){var h=b.nextSibling,e=b.viewStyle;e&&e.tagName==="A"&&a.replaceChild(a._line._createSpan(a,b.firstChild.data,e),b);b=h}a=this._getLineNext(a)}}},_setSelection:function(a,b,c,h,l){if(a){this._columnX=-1;c===void 0&&(c=!0);var e=this._selection;this._selection=a;b!==!1&&this._showCaret(!1,h,b,l);c&&this._updateDOMSelection();if(!e.equals(a))this.onSelection({type:"Selection",
oldValue:{start:e.start,end:e.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,b,c,h){var l=this._model,e=this._getSelection(),b=this.convert({x:a,y:b},"page","document"),a=this._getLineIndex(b.y);if(this._clickCount===1){l=this._getLine(a);a=l.getOffset(b.x,b.y-this._getLinePixel(a));l.destroy();if(h&&!c&&e.start<=a&&a<e.end)return this._dragOffset=a,!1;e.extend(a);c||e.collapse()}else(this._clickCount&1)===0?(l=this._getLine(a),a=l.getOffset(b.x,b.y-this._getLinePixel(a)),
this._doubleClickSelection?a>=this._doubleClickSelection.start?(c=this._doubleClickSelection.start,h=l.getNextOffset(a,"wordend",1)):(c=l.getNextOffset(a,"word",-1),h=this._doubleClickSelection.end):(c=l.getNextOffset(a,"word",-1),h=l.getNextOffset(c,"wordend",1)),l.destroy()):this._doubleClickSelection?(h=l.getLineAtOffset(this._doubleClickSelection.start),a>=h?(c=l.getLineStart(h),h=l.getLineEnd(a)):(c=l.getLineStart(a),h=l.getLineEnd(h))):(c=l.getLineStart(a),h=l.getLineEnd(a)),e.setCaret(c),e.extend(h);
this._setSelection(e,!0,!0);return!0},_setFullSelection:function(a,b){this._fullSelection=a;if(c.isWebkit)this._fullSelection=!0;var h=this._clipDiv||this._rootDiv;if(h)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!c.isIOS){var e=h.ownerDocument;this._highlightRGB=c.isWebkit?"transparent":"Highlight";var l=c.createElement(e,"div");this._selDiv1=l;l.style.position="absolute";l.style.borderWidth="0px";l.style.margin="0px";l.style.padding="0px";l.style.outline="none";l.style.background=
this._highlightRGB;l.style.width="0px";l.style.height="0px";l.style.zIndex="0";h.appendChild(l);var f=c.createElement(e,"div");this._selDiv2=f;f.style.position="absolute";f.style.borderWidth="0px";f.style.margin="0px";f.style.padding="0px";f.style.outline="none";f.style.background=this._highlightRGB;f.style.width="0px";f.style.height="0px";f.style.zIndex="0";h.appendChild(f);this._selDiv3=e=c.createElement(e,"div");e.style.position="absolute";e.style.borderWidth="0px";e.style.margin="0px";e.style.padding=
"0px";e.style.outline="none";e.style.background=this._highlightRGB;e.style.width="0px";e.style.height="0px";e.style.zIndex="0";h.appendChild(e);if(c.isFirefox&&c.isMac){h=this._getWindow().getComputedStyle(e,null).getPropertyValue("background-color");switch(h){case "rgb(119, 141, 168)":h="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":h="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":h="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":h="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":h=
"rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":h="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":h="rgb(232, 184, 255)";break;default:h="rgb(180, 213, 255)"}this._highlightRGB=h;l.style.background=h;f.style.background=h;e.style.background=h}b||this._updateDOMSelection()}}else{if(this._selDiv1)h.removeChild(this._selDiv1),this._selDiv1=null;if(this._selDiv2)h.removeChild(this._selDiv2),this._selDiv2=null;if(this._selDiv3)h.removeChild(this._selDiv3),this._selDiv3=null}},_setReadOnly:function(a){this._readonly=
a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setTabSize:function(a,b){this._tabSize=a;this._customTabSize=void 0;var h=this._clientDiv;if(c.isOpera){if(h)h.style.OTabSize=this._tabSize+""}else if(c.isWebkit>=537.1){if(h)h.style.tabSize=this._tabSize+""}else if(c.isFirefox>=4){if(h)h.style.MozTabSize=this._tabSize+""}else if(this._tabSize!==8)this._customTabSize=this._tabSize;b||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",
this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,b){this._themeClass=a;var c="textview",h=this._theme.getThemeClass();h&&(c+=" "+h);this._themeClass&&h!==this._themeClass&&(c+=" "+this._themeClass);this._rootDiv.className=c;this._updateStyle(b)},_setWrapMode:function(a,b){this._wrapMode=a;var c=this._clientDiv,h=this._viewDiv;a?(c.style.whiteSpace="pre-wrap",c.style.wordWrap=
"break-word",h.style.overflowX="hidden",h.style.overflowY="scroll"):(c.style.whiteSpace="pre",c.style.wordWrap="normal",h.style.overflowX="auto",h.style.overflowY="auto");b||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,b,c,h){if(this._clientDiv){var l=this._model,e=this._getSelection(),f=this._getScroll(),o=e.getCaret(),m=e.start,g=e.end,n=l.getLineAtOffset(g),r=Math.max(Math.max(m,l.getLineStart(n)),g-1),l=this._getClientWidth(),n=this._getClientHeight(),
i=l/4,u=this._getBoundsAtOffset(o===m?m:r),t=u.left,p=u.right,q=u.top,s=u.bottom;a&&!e.isEmpty()&&(u=this._getBoundsAtOffset(o===g?m:r),u.top===q?o===m?p=t+Math.min(u.right-t,l):t=p-Math.min(p-u.left,l):o===m?s=q+Math.min(u.bottom-q,n):q=s-Math.min(s-u.top,n));a=0;t<f.x&&(a=Math.min(t-f.x,-i));p>f.x+l&&(a=Math.max(p-f.x-l,i));e=0;q<f.y?e=q-f.y:s>f.y+n&&(e=s-f.y-n);h&&(h>0?e>0&&(e=Math.max(e,h)):e<0&&(e=Math.min(e,h)));return a!==0||e!==0?(e!==0&&typeof c==="number"&&(c<0&&(c=0),c>1&&(c=1),e+=Math.floor(e>
0?c*n:-c*n)),this._scrollViewAnimated(a,e,b),n!==this._getClientHeight()||l!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0):!1}},_startIME:function(){if(this._imeOffset===-1){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);
this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var b=this._handlers[a],c=b.target,h=b.type,b=b.handler;typeof c.removeEventListener==="function"?c.removeEventListener(h,b,!1):c.detachEvent("on"+h,b)}this._handlers=null;if(this._mutationObserver)this._mutationObserver.disconnect(),this._mutationObserver=null},_updateDOMSelection:function(){if(!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),
b=this._model,c=b.getLineAtOffset(a.start),h=b.getLineAtOffset(a.end),l=this._getLineNext();if(l){var e=this._getLinePrevious(),f;c<l.lineIndex?(f=l,c=0):c>e.lineIndex?(f=e,c=0):(f=this._getLineNode(c),c=a.start-b.getLineStart(c));h<l.lineIndex?a=0:h>e.lineIndex?(l=e,a=0):(l=this._getLineNode(h),a=a.end-b.getLineStart(h));this._setDOMSelection(f,c,l,a)}}},_update:function(a){if(!(this._redrawCount>0)){if(this._updateTimer)this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=
!1;var b=this._clientDiv;if(b){if(this._metrics.invalid)this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1;var h=this._model,e=this._getScroll(!1),l=this._getViewPadding(),f=h.getLineCount(),o=this._getLineHeight(),m=this._getClientWidth();if(this._wrapMode)b.style.width=m+"px";var g,n,i,u,t=0,p=0;if(this._lineHeight){for(;p<f;){i=this._getLineHeight(p);if(t+i>e.y)break;t+=i;p++}g=p;n=Math.max(0,g-1);i=h=e.y-t;g>0&&(h+=this._getLineHeight(g-1))}else u=Math.max(0,e.y)/o,g=Math.floor(u),
n=Math.max(0,g-1),h=Math.round((u-n)*o),i=Math.round((u-g)*o);this._topIndexY=i;u=this._parent;var q=u.clientWidth,s=u.clientHeight;u=this._getClientHeight();if(a){n=0;this._leftDiv&&(g=this._leftDiv.getBoundingClientRect(),n=g.right-g.left);g=m;for(this._wrapMode||(g=Math.max(this._maxLineWidth,g));p<f;)i=this._getLineHeight(p,!1),t+=i,p++;f=t}else{var m=this._viewDiv,o=Math.min(g+Math.floor((u+i)/o),f-1),e=Math.min(o+1,f-1),w;for(i=b.firstChild;i;){w=i.lineIndex;var x=i.nextSibling;if(!(n<=w&&w<=
e)||i.lineRemoved||i.lineIndex===-1)this._mouseWheelLine===i?(i.style.display="none",i.lineIndex=-1):b.removeChild(i);i=x}i=this._getLineNext();var x=m.ownerDocument,z=x.createDocumentFragment();for(w=n;w<=e;w++)if(!i||i.lineIndex>w)(new r(this,w)).create(z,null);else{z.firstChild&&(b.insertBefore(z,i),z=x.createDocumentFragment());if(i&&i.lineChanged)i=(new r(this,w)).create(z,i),i.lineChanged=!1;i=this._getLineNext(i)}z.firstChild&&b.insertBefore(z,i);if(c.isWebkit&&!this._wrapMode)b.style.width=
"0x7fffffffpx";i=this._getLineNext();w=u+h;for(z=!1;i;){n=i.lineWidth;if(n===void 0)x=i._line.getBoundingClientRect(),n=i.lineWidth=Math.ceil(x.right-x.left),this._lineHeight&&(this._lineHeight[i.lineIndex]=Math.ceil(x.bottom-x.top));if(this._lineHeight&&!z&&(w-=this._lineHeight[i.lineIndex],w<0))o=i.lineIndex,z=!0;if(!this._wrapMode){if(n>=this._maxLineWidth)this._maxLineWidth=n,this._maxLineIndex=i.lineIndex;if(this._checkMaxLineIndex===i.lineIndex)this._checkMaxLineIndex=-1}if(i.lineIndex===g)this._topChild=
i;if(i.lineIndex===o)this._bottomChild=i;i=this._getLineNext(i)}if(this._checkMaxLineIndex!==-1&&(w=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=w&&w<f)){i=new r(this,w);x=i.getBoundingClientRect();n=x.right-x.left;if(n>=this._maxLineWidth)this._maxLineWidth=n,this._maxLineIndex=w;i.destroy()}for(;p<f;)i=this._getLineHeight(p,p<=o),t+=i,p++;f=t;this._updateRuler(this._leftDiv,g,e,s);this._updateRuler(this._rightDiv,g,e,s);n=0;this._leftDiv&&(g=this._leftDiv.getBoundingClientRect(),n=g.right-
g.left);e=0;this._rightDiv&&(e=this._rightDiv.getBoundingClientRect(),e=e.right-e.left);m.style.left=n+"px";m.style.right=e+"px";e=this._scrollDiv;e.style.height=f+"px";t=m=this._getClientWidth();this._wrapMode||(t=Math.max(this._maxLineWidth,t));g=t;if((!c.isIE||c.isIE>=9)&&this._maxLineWidth>m)t+=l.right+l.left;e.style.width=t+"px";if(this._clipScrollDiv)this._clipScrollDiv.style.width=t+"px";e=this._getScroll(!1)}if(this._vScrollDiv)t=u-8,p=Math.max(15,Math.ceil(Math.min(1,t/(f+l.top+l.bottom))*
t)),this._vScrollDiv.style.left=n+m-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,e.y*t/f))+"px",this._vScrollDiv.style.height=p+"px";if(!this._wrapMode&&this._hScrollDiv)t=m-8,p=Math.max(15,Math.ceil(Math.min(1,t/(this._maxLineWidth+l.left+l.right))*t)),this._hScrollDiv.style.left=n+Math.floor(Math.max(0,Math.floor(e.x*t/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=u-9+"px",this._hScrollDiv.style.width=p+"px";w=e.x;i=this._clipDiv;t=this._overlayDiv;if(i){i.scrollLeft=w;p=n+l.left;
o=l.top;a=m;n=u;w=0;x=-h;if(e.x===0)p-=l.left,a+=l.left,w=l.left;e.x+m===g&&(a+=l.right);e.y===0&&(o-=l.top,n+=l.top,x+=l.top);e.y+u===f&&(n+=l.bottom);i.style.left=p+"px";i.style.top=o+"px";i.style.right=q-a-p+"px";i.style.bottom=s-n-o+"px";b.style.left=w+"px";b.style.top=x+"px";b.style.width=g+"px";b.style.height=u+h+"px";if(t)t.style.left=b.style.left,t.style.top=b.style.top,t.style.width=b.style.width,t.style.height=b.style.height}else{p=w;o=h;q=w+m;s=h+u;p===0&&(p-=l.left);o===0&&(o-=l.top);
q===g&&(q+=l.right);e.y+u===f&&(s+=l.bottom);b.style.clip="rect("+o+"px,"+q+"px,"+s+"px,"+p+"px)";b.style.left=-w+n+l.left+"px";b.style.width=(c.isWebkit?g:m+w)+"px";if(!a)b.style.top=-h+l.top+"px",b.style.height=u+h+"px";if(t&&(t.style.clip=b.style.clip,t.style.left=b.style.left,t.style.width=b.style.width,!a))t.style.top=b.style.top,t.style.height=b.style.height}this._updateDOMSelection();b=this._ensureCaretVisible;this._ensureCaretVisible=!1;u!==this._getClientHeight()&&(this._update(),b&&this._showCaret())}}},
_updateRuler:function(a,b,h,e){if(a)for(var l=this._parent.ownerDocument,o=this._getLineHeight(),m=this._getViewPadding(),a=a.firstChild;a;){var g=a._ruler,n=o,i=g.getOverview();i==="page"&&(n+=this._topIndexY);a.style.top=-n+"px";a.style.height=e+n+"px";a.rulerChanged&&f(g.getRulerStyle(),a);var r,u=a.firstChild;u?(r=u,u=u.nextSibling):(r=c.createElement(l,"div"),r.style.visibility="hidden",a.appendChild(r));var t;if(a.rulerChanged&&r){n=-1;if(t=g.getWidestAnnotation())if(f(t.style,r),t.html)r.innerHTML=
t.html;r.lineIndex=n;r.style.height=o+m.top+"px"}var p;if(i==="page"){for(g=g.getAnnotations(b,h+1);u;)n=u.lineIndex,t=u.nextSibling,(!(b<=n&&n<=h)||u.lineChanged)&&a.removeChild(u),u=t;u=a.firstChild.nextSibling;p=l.createDocumentFragment();for(n=b;n<=h;n++)if(!u||u.lineIndex>n){r=c.createElement(l,"div");if(t=g[n]){f(t.style,r);if(t.html)r.innerHTML=t.html;r.annotation=t}r.lineIndex=n;r.style.height=this._getLineHeight(n)+"px";p.appendChild(r)}else if(p.firstChild&&(a.insertBefore(p,u),p=l.createDocumentFragment()),
u)u=u.nextSibling;p.firstChild&&a.insertBefore(p,u)}else{t=this._getClientHeight();n=this._model.getLineCount();u=t+m.top+m.bottom-2*this._metrics.scrollWidth;i=o*n<u?o:u/n;if(a.rulerChanged){for(t=a.childNodes.length;t>1;)a.removeChild(a.lastChild),t--;g=g.getAnnotations(0,n);p=l.createDocumentFragment();for(var q in g)if(n=q>>>0,!(n<0)){r=c.createElement(l,"div");t=g[q];f(t.style,r);r.style.position="absolute";r.style.top=this._metrics.scrollWidth+o+Math.floor(n*i)+"px";if(t.html)r.innerHTML=t.html;
r.annotation=t;r.lineIndex=n;p.appendChild(r)}a.appendChild(p)}else if(a._oldTrackHeight!==u)for(r=a.firstChild?a.firstChild.nextSibling:null;r;)r.style.top=this._metrics.scrollWidth+o+Math.floor(r.lineIndex*i)+"px",r=r.nextSibling;a._oldTrackHeight=u}a.rulerChanged=!1;a=a.nextSibling}},_updateStyleSheet:function(){var a="";c.isWebkit&&this._metrics.scrollWidth>0&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");c.isFirefox&&c.isMac&&this._highlightRGB&&this._highlightRGB!=="Highlight"&&
(a+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(a){var b=document.getElementById("_textviewStyle");if(b)b.removeChild(b.firstChild),b.appendChild(document.createTextNode(a));else{b=c.createElement(document,"style");b.id="_textviewStyle";var h=document.getElementsByTagName("head")[0]||document.documentElement;b.appendChild(document.createTextNode(a));h.insertBefore(b,h.firstChild)}}},_updateStyle:function(a){if(!a&&c.isIE)this._rootDiv.style.lineHeight="normal";var b=this._metrics=
this._calculateMetrics();this._rootDiv.style.lineHeight=c.isIE?b.lineHeight-(b.lineTrim.top+b.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();a||(this.redraw(),this._resetLineWidth())}};p.EventTarget.addMixin(u.prototype);return{TextView:u}});
(function(){function s(c,e,f,g,b,a){e[c]&&(f.push(c),(e[c]===!0||e[c]===1)&&g.push(b+c+"/"+a))}function q(c,e,f,g,b){e=g+e+"/"+b;require._fileExists(c.toUrl(e))&&f.push(e)}var p=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/,i={};define("i18n",{version:"1.0.0",load:function(c,e,f,g){var g=g||{},b=p.exec(c),a=b[1],h=b[4],o=b[5],m=h.split("-"),n=[],r={},u,t,d="";b[5]?(a=b[1],c=a+o):(o=b[4],h=g.locale||(g.locale=typeof navigator==="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),
m=h.split("-"));if(g.isBuild){n.push(c);q(e,"root",n,a,o);for(u=0;t=m[u];u++)d+=(d?"-":"")+t,q(e,d,n,a,o);e(n,function(){f()})}else e([c],function(b){var c=[];s("root",b,c,n,a,o);for(u=0;t=m[u];u++)d+=(d?"-":"")+t,s(d,b,c,n,a,o);e(n,function(){var d,h;for(d=c.length-1;d>-1&&(t=c[d]);d--){h=b[t];if(h===!0||h===1)h=e(a+t+"/"+o);var m=r,g=void 0;for(g in h)!(g in i)&&!(g in m)&&(m[g]=h[g])}f(r)})})}})})();
define("orion/editor/i18n",{load:function(s,q,p){q.specified&&q.specified("orion/bootstrap")?q(["orion/i18n!"+s],function(i){p(i)}):p({})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",Comment:"Comment","Flat outline":"Flat outline",incrementalFind:"Incremental find: ${0}",incrementalFindNotFound:"Incremental find: ${0} (not found)",find:"Find...",
undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFindKey:"Incremental Find",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",
collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}"});
define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(s,q){var p={root:q},i;for(i in s)s.hasOwnProperty(i)&&typeof p[i]==="undefined"&&(p[i]=s[i]);return p});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(s,q){function p(a,b,c){this.start=a;this.end=b;this._projectionModel=c;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function i(){}function c(a,b){var c=a.lastIndexOf("."),c=a.substring(c+1),e={title:s[c],style:{styleClass:"annotation "+c},html:"<div class='annotationHTML "+c+"'></div>",overviewStyle:{styleClass:"annotationOverview "+c}};b?e.lineStyle={styleClass:"annotationLine "+
c}:e.rangeStyle={styleClass:"annotationRange "+c};i.registerType(a,e)}function e(){}function f(a){this._annotations=[];var b=this;this._listener={onChanged:function(a){b._onChanged(a)}};this.setTextModel(a)}function g(a,b){this._view=a;this._annotationModel=b;var c=this;this._listener={onDestroy:function(a){c._onDestroy(a)},onLineStyle:function(a){c._onLineStyle(a)},onChanged:function(a){c._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",
this._listener.onLineStyle);b.addEventListener("Changed",this._listener.onChanged)}p.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},collapse:function(){if(this.expanded){this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;var a=this._projectionModel,b=a.getBaseModel();this._projection=
{start:b.getLineStart(b.getLineAtOffset(this.start)+1),end:b.getLineEnd(b.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},expand:function(){if(!this.expanded)this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._projectionModel.removeProjection(this._projection)}};i.ANNOTATION_ERROR="orion.annotation.error";i.ANNOTATION_WARNING="orion.annotation.warning";i.ANNOTATION_TASK="orion.annotation.task";i.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";
i.ANNOTATION_BOOKMARK="orion.annotation.bookmark";i.ANNOTATION_FOLDING="orion.annotation.folding";i.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";i.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";i.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";i.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";i.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";i.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";i.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";
var b={};i.registerType=function(a,c){var e=c;if(typeof e!=="function")e=function(a,b,c){this.start=a;this.end=b;if(c)this.title=c},e.prototype=c;e.prototype.type=a;b[a]=e;return a};i.createAnnotation=function(a,b,c,e){return new (this.getType(a))(b,c,e)};i.getType=function(a){return b[a]};c(i.ANNOTATION_ERROR);c(i.ANNOTATION_WARNING);c(i.ANNOTATION_TASK);c(i.ANNOTATION_BREAKPOINT);c(i.ANNOTATION_BOOKMARK);c(i.ANNOTATION_CURRENT_BRACKET);c(i.ANNOTATION_MATCHING_BRACKET);c(i.ANNOTATION_CURRENT_SEARCH);
c(i.ANNOTATION_MATCHING_SEARCH);c(i.ANNOTATION_READ_OCCURRENCE);c(i.ANNOTATION_WRITE_OCCURRENCE);c(i.ANNOTATION_CURRENT_LINE,!0);i.registerType(i.ANNOTATION_FOLDING,p);e.addMixin=function(a){var b=e.prototype,c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};e.prototype={addAnnotationType:function(a){if(!this._annotationTypes)this._annotationTypes=[];this._annotationTypes.push(a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===
a)return b+1;return 0},getAnnotationsByType:function(a,b,c){a=a.getAnnotations(b,c);for(c=[];a.hasNext();)b=a.next(),this.getAnnotationTypePriority(b.type)!==0&&c.push(b);var e=this;c.sort(function(a,b){return e.getAnnotationTypePriority(a.type)-e.getAnnotationTypePriority(b.type)});return c},isAnnotationTypeVisible:function(a){return this.getAnnotationTypePriority(a)!==0},removeAnnotationType:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===
a){this._annotationTypes.splice(b,1);break}}};f.prototype={addAnnotation:function(a){if(a){var b=this._annotations,c=this._binarySearch(b,a.start);b.splice(c,0,a);this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,b){var c=this._annotations,e,f=0,g=function(){for(;f<c.length;){var e=c[f++];if(a===e.start||(a>e.start?a<e.end:e.start<b))return e;if(e.start>=b)break}return null};e=g();return{next:function(){var a=e;
a&&(e=g());return a},hasNext:function(){return e!==null}}},modifyAnnotation:function(a){if(a&&!(this._getAnnotationIndex(a)<0))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var b=this._annotations,c,e;if(a){c=[];for(e=b.length-1;e>=0;e--){var f=b[e];f.type===a&&b.splice(e,1);c.splice(0,0,f)}}else c=b;this.onChanged({type:"Changed",removed:c,added:[],changed:[]})},removeAnnotation:function(a){if(a&&
(a=this._getAnnotationIndex(a),!(a<0)))this.onChanged({type:"Changed",removed:this._annotations.splice(a,1),added:[],changed:[]})},replaceAnnotations:function(a,b){var c=this._annotations,e,f,g,i=[];if(a)for(e=a.length-1;e>=0;e--)g=a[e],f=this._getAnnotationIndex(g),f<0||(c.splice(f,1),i.splice(0,0,g));b||(b=[]);for(e=0;e<b.length;e++)g=b[e],f=this._binarySearch(c,g.start),c.splice(f,0,g);this.onChanged({type:"Changed",removed:i,added:b,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",
this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_binarySearch:function(a,b){for(var c=a.length,e=-1,f;c-e>1;)f=Math.floor((c+e)/2),b<=a[f].start?c=f:e=f;return c},_getAnnotationIndex:function(a){for(var b=this._annotations,c=this._binarySearch(b,a.start);c<b.length&&b[c].start===a.start;){if(b[c]===a)return c;c++}return-1},_onChanged:function(a){var b=a.start,c=a.removedCharCount,e=this._annotations,f=b+c;if(0<e.length){for(var g={type:"Changed",
added:[],removed:[],changed:[],textModelChangedEvent:a},a=a.addedCharCount-c,c=0;c<e.length;c++){var i=e[c];i.start>=f?(i.start+=a,i.end+=a,g.changed.push(i)):i.end<=b||(i.start<b&&f<i.end?(i.end+=a,g.changed.push(i)):(e.splice(c,1),g.removed.push(i),c--))}if(g.added.length>0||g.removed.length>0||g.changed.length>0)this.onChanged(g)}}};q.EventTarget.addMixin(f.prototype);g.prototype={destroy:function(){var a=this._view;if(a)a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",
this._listener.onLineStyle),this.view=null;(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+=" "+b.styleClass:a.styleClass=b.styleClass;var c;if(b.style){if(!a.style)a.style={};for(c in b.style)a.style[c]||(a.style[c]=b.style[c])}if(b.attributes){if(!a.attributes)a.attributes={};for(c in b.attributes)a.attributes[c]||(a.attributes[c]=b.attributes[c])}}return a},
_mergeStyleRanges:function(a,b){a||(a=[]);var c,e;for(e=0;e<a.length&&b;e++){var f=a[e];if(b.end<=f.start)break;if(!(b.start>=f.end)){c=this._mergeStyle({},f.style);c=this._mergeStyle(c,b.style);var g=[];g.push(e,1);b.start<f.start&&g.push({start:b.start,end:f.start,style:b.style});b.start>f.start&&g.push({start:f.start,end:b.start,style:f.style});g.push({start:Math.max(f.start,b.start),end:Math.min(f.end,b.end),style:c});b.end<f.end&&g.push({start:b.end,end:f.end,style:f.style});b=b.end>f.end?{start:f.end,
end:b.end,style:b.style}:null;Array.prototype.splice.apply(a,g)}}b&&(c=this._mergeStyle({},b.style),a.splice(e,0,{start:b.start,end:b.end,style:c}));return a},_onAnnotationModelChanged:function(a){function b(a){for(var h=0;h<a.length;h++)if(e.isAnnotationTypeVisible(a[h].type)){var g=a[h].start,d=a[h].end;f.getBaseModel&&(g=f.mapOffset(g,!0),d=f.mapOffset(d,!0));g!==-1&&d!==-1&&c.redrawRange(g,d)}}if(!a.textModelChangedEvent){var c=this._view;if(c){var e=this,f=c.getModel();b(a.added);b(a.removed);
b(a.changed)}}},_onDestroy:function(){this.destroy()},_onLineStyle:function(a){var b=this._annotationModel,c=a.textView.getModel(),e=b.getTextModel(),f=a.lineStart,g=a.lineStart+a.lineText.length;e!==c&&(f=c.mapOffset(f),g=c.mapOffset(g));for(b=b.getAnnotations(f,g);b.hasNext();)if(f=b.next(),this.isAnnotationTypeVisible(f.type)){if(f.rangeStyle){var g=f.start,i=f.end;e!==c&&(g=c.mapOffset(g,!0),i=c.mapOffset(i,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:g,end:i,style:f.rangeStyle})}if(f.lineStyle)a.style=
this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,f.lineStyle)}}};e.addMixin(g.prototype);return{FoldingAnnotation:p,AnnotationType:i,AnnotationTypeList:e,AnnotationModel:f,AnnotationStyler:g}});
define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/util"],function(s,q,p,i,c){function e(c){this._view=c;this._create(c.getOptions("parent").ownerDocument);c.addEventListener("Destroy",this,this.destroy)}e.getTooltip=function(c){if(!c._tooltip)c._tooltip=new e(c);return c._tooltip};e.prototype={_create:function(e){if(!this._tooltipDiv){var g=this._tooltipDiv=c.createElement(e,"div");g.className=
"textviewTooltip";g.setAttribute("aria-live","assertive");g.setAttribute("aria-atomic","true");var b=this._tooltipContents=c.createElement(e,"div");g.appendChild(b);e.body.appendChild(g);this.hide()}},_getWindow:function(){var c=this._tooltipDiv.ownerDocument;return c.defaultView||c.parentWindow},destroy:function(){if(this._tooltipDiv){this.hide();var c=this._tooltipDiv.parentNode;c&&c.removeChild(this._tooltipDiv);this._tooltipDiv=null}},hide:function(){if(this._contentsView)this._contentsView.destroy(),
this._contentsView=null;if(this._tooltipContents)this._tooltipContents.innerHTML="";if(this._tooltipDiv)this._tooltipDiv.style.visibility="hidden";var c=this._getWindow();if(this._showTimeout)c.clearTimeout(this._showTimeout),this._showTimeout=null;if(this._hideTimeout)c.clearTimeout(this._hideTimeout),this._hideTimeout=null;if(this._fadeTimeout)c.clearInterval(this._fadeTimeout),this._fadeTimeout=null},isVisible:function(){return this._tooltipDiv&&this._tooltipDiv.style.visibility==="visible"},setTarget:function(c,
e){if(this.target!==c&&(this._target=c,this.hide(),c)){var b=this;if(e===0)b.show(!0);else{var a=this._getWindow();b._showTimeout=a.setTimeout(function(){b.show(!0)},e?e:500)}}},show:function(c){if(this._target){var e=this._target.getTooltipInfo();if(e){var b=this._tooltipDiv,a=this._tooltipContents;b.style.left=b.style.right=b.style.width=b.style.height=a.style.width=a.style.height="auto";var h=e.contents;h instanceof Array&&(h=this._getAnnotationContents(h));if(typeof h==="string")a.innerHTML=h;
else if(this._isNode(h))a.appendChild(h);else if(h instanceof i.ProjectionTextModel){var o=this._view,m=o.getOptions();m.wrapMode=!1;m.parent=a;var n=m.themeClass;n?((n=n.replace("tooltip",""))&&(n=" "+n),n="tooltip"+n):n="tooltip";m.themeClass=n;m=this._contentsView=new q.TextView(m);m._clientDiv.contentEditable=!1;m.addEventListener("LineStyle",function(a){o.onLineStyle(a)});m.setModel(h);h=m.computeSize();a.style.width=h.width+"px";a.style.height=h.height+"px";m.resize()}else return;a=b.ownerDocument.documentElement;
e.anchor==="right"?(h=a.clientWidth-e.x,b.style.right=h+"px"):(h=parseInt(this._getNodeStyle(b,"padding-left","0"),10),h+=parseInt(this._getNodeStyle(b,"border-left-width","0"),10),h=e.x-h,b.style.left=h+"px");b.style.maxWidth=a.clientWidth-h-10+"px";h=parseInt(this._getNodeStyle(b,"padding-top","0"),10);h+=parseInt(this._getNodeStyle(b,"border-top-width","0"),10);h=e.y-h;b.style.top=h+"px";b.style.maxHeight=a.clientHeight-h-10+"px";b.style.opacity="1";b.style.visibility="visible";if(c){var r=this,
u=this._getWindow();r._hideTimeout=u.setTimeout(function(){var a=parseFloat(r._getNodeStyle(b,"opacity","1"));r._fadeTimeout=u.setInterval(function(){b.style.visibility==="visible"&&a>0?(a-=0.1,b.style.opacity=a):r.hide()},50)},5E3)}}}},_getAnnotationContents:function(c){function e(b){var c=b.title;if(c==="")return null;var h="<div>";b.html&&(h+=b.html+"&nbsp;");if(!c)c=b.end,b=a.getLineStart(a.getLineAtOffset(b.start)),c=a.getLineEnd(a.getLineAtOffset(c),!0),c=a.getText(b,c);c=c.replace(/</g,"&lt;").replace(/>/g,
"&gt;");h+="<span style='vertical-align:middle;'>"+c+"</span><div>";return h}if(c.length===0)return null;var b=this._view.getModel(),a=b.getBaseModel?b.getBaseModel():b;if(c.length===1)if(b=c[0],b.title!==void 0)return e(b);else{var c=new i.ProjectionTextModel(a),h=a.getLineStart(a.getLineAtOffset(b.start)),o=a.getCharCount();b.end!==o&&c.addProjection({start:b.end,end:o});h>0&&c.addProjection({start:0,end:h});return c}else{h="<div><em>"+s.multipleAnnotations+"</em></div>";for(o=0;o<c.length;o++)b=
c[o],(b=e(b))&&(h+=b);return h}},_getNodeStyle:function(c,e,b){var a;if(c&&(a=c.style[e],!a))if(c.currentStyle){for(a=0;(a=e.indexOf("-",a))!==-1;)e=e.substring(0,a)+e.substring(a+1,a+2).toUpperCase()+e.substring(a+2);a=c.currentStyle[e]}else a=(c=c.ownerDocument.defaultView.getComputedStyle(c,null))?c.getPropertyValue(e):null;return a||b},_isNode:function(c){return typeof Node==="object"?c instanceof Node:c&&typeof c==="object"&&typeof c.nodeType==="number"&&typeof c.nodeName==="string"}};return{Tooltip:e}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(s,q,p,i){function c(a,b,c,e){this._location=b||"left";this._overview=c||"page";this._rulerStyle=e;this._view=null;var f=this;this._listener={onTextModelChanged:function(a){f._onTextModelChanged(a)},onAnnotationModelChanged:function(a){f._onAnnotationModelChanged(a)}};this.setAnnotationModel(a)}function e(a,b,e,f,g){c.call(this,a,b,"page",e);this._oddStyle=f||{style:{backgroundColor:"white"}};
this._evenStyle=g||{style:{backgroundColor:"white"}};this._numOfDigits=0}function f(a,b,e){c.call(this,a,b,"page",e)}function g(a,b,e){c.call(this,a,b,"document",e)}function b(a,b,c){f.call(this,a,b,c)}c.prototype={getAnnotations:function(a,b){var c=this._annotationModel;if(!c)return[];var e=this._view.getModel(),f=e.getLineStart(a),g=e.getLineEnd(b-1),i=e;e.getBaseModel&&(i=e.getBaseModel(),f=e.mapOffset(f),g=e.mapOffset(g));for(var t=[],c=this.getAnnotationsByType(c,f,g),f=0;f<c.length;f++)for(var g=
c[f],d=i.getLineAtOffset(g.start),k=i.getLineAtOffset(Math.max(g.start,g.end-1)),j=d;j<=k;j++){var v=j;if(e!==i){v=i.getLineStart(j);v=e.mapOffset(v,!0);if(v===-1)continue;v=e.getLineAtOffset(v)}if(a<=v&&v<b){var l=this._mergeAnnotation(t[v],g,j-d,k-d+1);l&&(t[v]=l)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var y in t)t[y]._multiple&&(t[y].html+=this._multiAnnotationOverlay.html);return t},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=
a},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(a){if(a!==void 0){var b=this._view,c=b.getModel(),e=c,f=c.getLineStart(a),g=f,i=this._annotationModel;if(i){g=b.getSelection();b=Math.max(g.start,g.end);g=c.getLineEnd(a,!0);f<=b&&b<c.getLineEnd(a)&&(f=b+1);c.getBaseModel&&
(f=c.mapOffset(f),g=c.mapOffset(g),e=c.getBaseModel());for(var t,a=i.getAnnotations(f,g);!t&&a.hasNext();)g=a.next(),this.isAnnotationTypeVisible(g.type)&&(t=g);t&&e.getLineAtOffset(t.start)===e.getLineAtOffset(f)?(f=t.start,g=t.end):g=f;c.getBaseModel&&(f=c.mapOffset(f,!0),g=c.mapOffset(g,!0))}(c=p.Tooltip.getTooltip(this._view))&&c.setTarget(null);this._view.setSelection(g,f,1/3,function(){})}},onDblClick:function(){},onMouseMove:function(a,b){var c=p.Tooltip.getTooltip(this._view);if(c&&!(c.isVisible()&&
this._tooltipLineIndex===a)){this._tooltipLineIndex=a;var e=this;c.setTarget({y:b.clientY,getTooltipInfo:function(){return e._getTooltipInfo(e._tooltipLineIndex,this.y)}})}},onMouseOver:function(a,b){this.onMouseMove(a,b)},onMouseOut:function(){var a=p.Tooltip.getTooltip(this._view);a&&a.setTarget(null)},_getTooltipInfo:function(a,b){if(a!==void 0){var c=this._view,e=c.getModel(),f=this._annotationModel,g=[];if(f){var g=e.getLineStart(a),i=e.getLineEnd(a);e.getBaseModel&&(g=e.mapOffset(g),i=e.mapOffset(i));
g=this.getAnnotationsByType(f,g,i)}f=this._getTooltipContents(a,g);if(!f)return null;f={contents:f,anchor:this.getLocation()};g=c.getClientArea();g.y=this.getOverview()==="document"?c.convert({y:b},"view","document").y:c.getLocationAtOffset(e.getLineStart(a)).y;c.convert(g,"document","page");f.x=g.x;f.y=g.y;f.anchor==="right"&&(f.x+=g.width);return f}},_getTooltipContents:function(a,b){return b},_onAnnotationModelChanged:function(a){function b(a){for(var h=0;h<a.length;h++)if(f.isAnnotationTypeVisible(a[h].type)){var d=
a[h].start,g=a[h].end;e.getBaseModel&&(d=e.mapOffset(d,!0),g=e.mapOffset(g,!0));d!==-1&&g!==-1&&c.redrawLines(e.getLineAtOffset(d),e.getLineAtOffset(Math.max(d,g-1))+1,f)}}var c=this._view;if(c){var e=c.getModel(),f=this,g=e.getLineCount();a.textModelChangedEvent?(a=a.textModelChangedEvent.start,e.getBaseModel&&(a=e.mapOffset(a,!0)),a=e.getLineAtOffset(a),c.redrawLines(a,g,f)):(b(a.added),b(a.removed),b(a.changed))}},_mergeAnnotation:function(a,b,c){a||(a={});if(c===0)if(a.html&&b.html){if(b.html!==
a.html&&!a._multiple&&this._multiAnnotation)a.html=this._multiAnnotation.html;a._multiple=!0}else a.html=b.html;a.style=this._mergeStyle(a.style,b.style);return a},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+=" "+b.styleClass:a.styleClass=b.styleClass;var c;if(b.style){if(!a.style)a.style={};for(c in b.style)a.style[c]||(a.style[c]=b.style[c])}if(b.attributes){if(!a.attributes)a.attributes={};for(c in b.attributes)a.attributes[c]||
(a.attributes[c]=b.attributes[c])}}return a}};q.AnnotationTypeList.addMixin(c.prototype);e.prototype=new c;e.prototype.getAnnotations=function(a,b){for(var e=c.prototype.getAnnotations.call(this,a,b),f=this._view.getModel(),g=a;g<b;g++){var i=g&1?this._oddStyle:this._evenStyle,u=g;f.getBaseModel&&(u=f.getLineStart(u),u=f.getBaseModel().getLineAtOffset(f.mapOffset(u)));e[g]||(e[g]={});e[g].html=u+1+"";if(!e[g].style)e[g].style=i}return e};e.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();
return this.getAnnotations(a-1,a)[a-1]};e.prototype._onTextModelChanged=function(a){var a=a.start,b=this._view.getModel(),c=((b.getBaseModel?b.getBaseModel().getLineCount():b.getLineCount())+"").length;if(this._numOfDigits!==c)this._numOfDigits=c,this._view.redrawLines(b.getLineAtOffset(a),b.getLineCount(),this)};f.prototype=new c;g.prototype=new c;g.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};g.prototype._getTooltipContents=
function(a,b){if(b.length===0){var e=this._view.getModel(),f=a;e.getBaseModel&&(f=e.getLineStart(f),f=e.getBaseModel().getLineAtOffset(e.mapOffset(f)));return i.formatMessage(s.line,f+1)}return c.prototype._getTooltipContents.call(this,a,b)};g.prototype._mergeAnnotation=function(a,b,c,e){if(c===0){if(!a)a={html:"&nbsp;",style:{style:{height:3*e+"px"}}},a.style=this._mergeStyle(a.style,b.overviewStyle);return a}};b.prototype=new f;b.prototype.onClick=function(a){if(a!==void 0){var b=this._annotationModel;
if(b){var c=this._view.getModel(),e=c.getLineStart(a),a=c.getLineEnd(a,!0);c.getBaseModel&&(e=c.mapOffset(e),a=c.mapOffset(a),c=c.getBaseModel());for(var f,b=b.getAnnotations(e,a);!f&&b.hasNext();)a=b.next(),this.isAnnotationTypeVisible(a.type)&&(f=a);f&&c.getLineAtOffset(f.start)===c.getLineAtOffset(e)&&((c=p.Tooltip.getTooltip(this._view))&&c.setTarget(null),f.expanded?f.collapse():f.expand(),this._annotationModel.modifyAnnotation(f))}}};b.prototype._getTooltipContents=function(a,b){return b.length===
1&&b[0].expanded?null:f.prototype._getTooltipContents.call(this,a,b)};b.prototype._onAnnotationModelChanged=function(a){function b(a){for(i=0;i<a.length;i++)if(g.isAnnotationTypeVisible(a[i].type)){var c=a[i].start;e.getBaseModel&&(c=e.mapOffset(c,!0));c!==-1&&(t=Math.min(t,e.getLineAtOffset(c)))}}if(a.textModelChangedEvent)f.prototype._onAnnotationModelChanged.call(this,a);else{var c=this._view;if(c){var e=c.getModel(),g=this,i,u=e.getLineCount(),t=u;b(a.added);b(a.removed);b(a.changed);a=c.getRulers();
for(i=0;i<a.length;i++)c.redrawLines(t,u,a[i])}}};return{Ruler:c,AnnotationRuler:f,LineNumberRuler:e,OverviewRuler:g,FoldingRuler:b}});
define("orion/editor/undoStack",[],function(){function s(i,c,e){this.offset=i;this.text=c;this.previousText=e}function q(){this.changes=[]}function p(i,c){this.view=i;this.size=c!==void 0?c:100;this.reset();var e=i.getModel();e.getBaseModel&&(e=e.getBaseModel());this.model=e;var f=this;this._listener={onChanging:function(c){f._onChanging(c)},onDestroy:function(c){f._onDestroy(c)}};e.addEventListener("Changing",this._listener.onChanging);i.addEventListener("Destroy",this._listener.onDestroy)}s.prototype=
{undo:function(i,c){this._doUndoRedo(this.offset,this.previousText,this.text,i,c)},redo:function(i,c){this._doUndoRedo(this.offset,this.text,this.previousText,i,c)},_doUndoRedo:function(i,c,e,f,g){var b=f.getModel();if(b.mapOffset&&f.annotationModel){var a=b.mapOffset(i,!0);if(a<0)for(var h=f.annotationModel.getAnnotations(i,i+1);h.hasNext();){var o=h.next();if(o.type==="orion.annotation.folding"){o.expand();a=b.mapOffset(i,!0);break}}if(a<0)return;i=a}f.setText(c,i,i+e.length);g&&f.setSelection(i,
i+c.length)}};q.prototype={add:function(i){this.changes.push(i)},end:function(i){this.endSelection=i.getSelection();this.endCaret=i.getCaretOffset()},undo:function(i,c){for(var e=this.changes.length-1;e>=0;e--)this.changes[e].undo(i,!1);if(c){var e=this.startSelection.start,f=this.startSelection.end;i.setSelection(this.startCaret?e:f,this.startCaret?f:e)}},redo:function(i,c){for(var e=0;e<this.changes.length;e++)this.changes[e].redo(i,!1);if(c){var e=this.endSelection.start,f=this.endSelection.end;
i.setSelection(this.endCaret?e:f,this.endCaret?f:e)}},start:function(i){this.startSelection=i.getSelection();this.startCaret=i.getCaretOffset()}};p.prototype={add:function(i){this.compoundChange?this.compoundChange.add(i):(this.stack.splice(this.index,this.stack.length-this.index,i),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--,this.cleanIndex--))},markClean:function(){this.endCompoundChange();this._commitUndo();this.cleanIndex=this.index},isClean:function(){return this.cleanIndex===
this.getSize().undo},canUndo:function(){return this.getSize().undo>0},canRedo:function(){return this.getSize().redo>0},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){var i=this.index,c=this.stack.length;this._undoStart!==void 0&&i++;return{undo:i,redo:c-i}},undo:function(){this._commitUndo();if(this.index<=0)return!1;var i=this.stack[--this.index];this._ignoreUndo=!0;i.undo(this.view,!0);this._ignoreUndo=!1;return!0},
redo:function(){this._commitUndo();if(this.index>=this.stack.length)return!1;var i=this.stack[this.index++];this._ignoreUndo=!0;i.redo(this.view,!0);this._ignoreUndo=!1;return!0},reset:function(){this.index=this.cleanIndex=0;this.stack=[];this._undoStart=void 0;this._undoText="";this._undoType=0;this._ignoreUndo=!1;this._compoundChange=void 0},startCompoundChange:function(){this._commitUndo();var i=new q;this.add(i);this.compoundChange=i;this.compoundChange.start(this.view)},_commitUndo:function(){if(this._undoStart!==
void 0)this._undoType===-1?this.add(new s(this._undoStart,"",this._undoText)):this.add(new s(this._undoStart,this._undoText,"")),this._undoStart=void 0,this._undoText="",this._undoType=0},_onDestroy:function(){this.model.removeEventListener("Changing",this._listener.onChanging);this.view.removeEventListener("Destroy",this._listener.onDestroy)},_onChanging:function(i){var c=i.text,e=i.start,f=i.removedCharCount,i=i.addedCharCount;if(!this._ignoreUndo){this._undoStart!==void 0&&!(i===1&&f===0&&this._undoType===
1&&e===this._undoStart+this._undoText.length||i===0&&f===1&&this._undoType===-1&&(e+1===this._undoStart||e===this._undoStart))&&this._commitUndo();if(!this.compoundChange)if(i===1&&f===0){if(this._undoStart===void 0)this._undoStart=e;this._undoText+=c;this._undoType=1;return}else if(i===0&&f===1){c=this._undoText.length>0&&this._undoStart===e;this._undoStart=e;this._undoType=-1;c?this._undoText+=this.model.getText(e,e+f):this._undoText=this.model.getText(e,e+f)+this._undoText;return}this.add(new s(e,
c,this.model.getText(e,e+f)))}}};return{UndoStack:p}});
define("orion/editor/textDND",[],function(){function s(q,p){this._view=q;this._undoStack=p;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var i=this;this._listener={onDragStart:function(c){i._onDragStart(c)},onDragEnd:function(c){i._onDragEnd(c)},onDragEnter:function(c){i._onDragEnter(c)},onDragOver:function(c){i._onDragOver(c)},onDrop:function(c){i._onDrop(c)},onDestroy:function(c){i._onDestroy(c)}};q.addEventListener("DragStart",this._listener.onDragStart);q.addEventListener("DragEnd",
this._listener.onDragEnd);q.addEventListener("DragEnter",this._listener.onDragEnter);q.addEventListener("DragOver",this._listener.onDragOver);q.addEventListener("Drop",this._listener.onDrop);q.addEventListener("Destroy",this._listener.onDestroy)}s.prototype={destroy:function(){var q=this._view;if(q)q.removeEventListener("DragStart",this._listener.onDragStart),q.removeEventListener("DragEnd",this._listener.onDragEnd),q.removeEventListener("DragEnter",this._listener.onDragEnter),q.removeEventListener("DragOver",
this._listener.onDragOver),q.removeEventListener("Drop",this._listener.onDrop),q.removeEventListener("Destroy",this._listener.onDestroy),this._view=null},_onDestroy:function(){this.destroy()},_onDragStart:function(q){var p=this._view,i=p.getSelection(),p=p.getModel();if(p.getBaseModel)i.start=p.mapOffset(i.start),i.end=p.mapOffset(i.end),p=p.getBaseModel();if(p=p.getText(i.start,i.end))this._dragSelection=i,q.event.dataTransfer.effectAllowed="copyMove",q.event.dataTransfer.setData("Text",p)},_onDragEnd:function(q){var p=
this._view;if(this._dragSelection){this._undoStack&&this._undoStack.startCompoundChange();(q=q.event.dataTransfer.dropEffect==="move")&&p.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var i=this._dropText,c=this._dropOffset;if(q)if(c>=this._dragSelection.end)c-=this._dragSelection.end-this._dragSelection.start;else if(c>=this._dragSelection.start)c=this._dragSelection.start;p.setText(i,c,c);p.setSelection(c,c+i.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&
this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(q){this._onDragOver(q)},_onDragOver:function(q){var p=q.event.dataTransfer.types;if(p){var i=!this._view.getOptions("readonly");i&&(i=p.contains?p.contains("text/plain"):p.indexOf("text/plain")!==-1);if(!i)q.event.dataTransfer.dropEffect="none"}},_onDrop:function(q){var p=this._view,i=q.event.dataTransfer.getData("Text");if(i)q=p.getOffsetAtLocation(q.x,q.y),this._dragSelection?(this._dropOffset=q,this._dropText=i):
(p.setText(i,q,q),p.setSelection(q,q+i.length))}};return{TextDND:s}});
define("orion/editor/editor","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/eventTarget,orion/editor/tooltip,orion/editor/annotations,orion/util".split(","),function(s,q,p,i,c,e){function f(b){this._textViewFactory=b.textViewFactory;this._undoStackFactory=b.undoStackFactory;this._textDNDFactory=b.textDNDFactory;this._annotationFactory=b.annotationFactory;this._foldingRulerFactory=b.foldingRulerFactory;this._lineNumberRulerFactory=b.lineNumberRulerFactory;this._contentAssistFactory=
b.contentAssistFactory;this._keyBindingFactory=b.keyBindingFactory;this._statusReporter=b.statusReporter;this._domNode=b.domNode;this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null;this._dirty=!1;this._title=this._contentAssist=null;this._keyModes=[]}function g(b){var a=this,c=Array.prototype.slice.call(arguments,1);return c.length?function(){return arguments.length?a.apply(b,c.concat(Array.prototype.slice.call(arguments))):
a.apply(b,c)}:function(){return arguments.length?a.apply(b,arguments):a.call(b)}}f.prototype={destroy:function(){this.uninstallTextView();this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._statusReporter=this._domNode=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},
getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getTitle:function(){return this._title},getKeyModes:function(){return this._keyModes},isDirty:function(){return this._dirty},setAnnotationRulerVisible:function(b){if(this._annotationRulerVisible!==
b&&(this._annotationRulerVisible=b,this._annotationRuler)){var a=this._textView;b?a.addRuler(this._annotationRuler,0):a.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(b){if(this._foldingRulerVisible!==b&&(this._foldingRulerVisible=b,this._foldingRuler)){var a=this._textView;a.getModel().getBaseModel&&(b?a.addRuler(this._foldingRuler,100):a.removeRuler(this._foldingRuler))}},setDirty:function(b){if(this._dirty!==b)this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"})},setLineNumberRulerVisible:function(b){if(this._lineNumberRulerVisible!==
b&&(this._lineNumberRulerVisible=b,this._lineNumberRuler)){var a=this._textView;b?a.addRuler(this._lineNumberRuler,1):a.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(b){if(this._overviewRulerVisible!==b&&(this._overviewRulerVisible=b,this._overviewRuler)){var a=this._textView;b?a.addRuler(this._overviewRuler):a.removeRuler(this._overviewRuler)}},mapOffset:function(b,a){var c=this._textView.getModel();c.getBaseModel&&(b=c.mapOffset(b,a));return b},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},
getSelection:function(){var b=this._textView,a=b.getSelection(),b=b.getModel();if(b.getBaseModel)a.start=b.mapOffset(a.start),a.end=b.mapOffset(a.end);return a},getText:function(b,a){var c=this._textView.getModel();c.getBaseModel&&(c=c.getBaseModel());return c.getText(b,a)},_expandOffset:function(b){var a=this._textView.getModel(),e=this._annotationModel;if(e&&a.getBaseModel)for(b=e.getAnnotations(b,b+1);b.hasNext();)a=b.next(),a.type===c.AnnotationType.ANNOTATION_FOLDING&&a.expand&&(a.expand(),e.modifyAnnotation(a))},
setCaretOffset:function(b,a,c){var e=this._textView,f=e.getModel();f.getBaseModel&&(this._expandOffset(b),b=f.mapOffset(b,!0));e.setCaretOffset(b,a,c)},setText:function(b,a,c){var e=this._textView,f=e.getModel();f.getBaseModel&&(a!==void 0&&(this._expandOffset(a),a=f.mapOffset(a,!0)),c!==void 0&&(this._expandOffset(c),c=f.mapOffset(c,!0)));e.setText(b,a,c)},setFoldingEnabled:function(b){this.setFoldingRulerVisible(b)},setSelection:function(b,a,c,e){var f=this._textView,g=f.getModel();g.getBaseModel&&
(this._expandOffset(b),this._expandOffset(a),b=g.mapOffset(b,!0),a=g.mapOffset(a,!0));f.setSelection(b,a,c,e)},moveSelection:function(b,a,c,e){var f=this._textView;this.setSelection(b,a||b,1/3,function(){(e===void 0||e)&&f.focus();c&&c()})},checkDirty:function(){this.setDirty(!this._undoStack.isClean())},reportStatus:function(b,a,c){this._statusReporter&&this._statusReporter(b,a,c)},_getTooltipInfo:function(b,a){var c=this._textView,e=this.getAnnotationModel();if(!e)return null;var f=this._annotationStyler;
if(!f)return null;var g=c.getOffsetAtLocation(b,a);if(g===-1)return null;g=this.mapOffset(g);f=f.getAnnotationsByType(e,g,g+1);e=[];for(g=0;g<f.length;g++)f[g].rangeStyle&&e.push(f[g]);if(e.length===0)return null;c=c.convert({x:b,y:a},"document","page");return{contents:e,anchor:"left",x:c.x+10,y:c.y+20}},_highlightCurrentLine:function(b,a){var e=this._annotationModel;if(e){var f=this._textView.getModel(),g=a?f.getLineAtOffset(a.start):-1,i=f.getLineAtOffset(b.start),r=b.start===b.end,u=!a||a.start===
a.end,t=f.getLineStart(i),d=f.getLineEnd(i);f.getBaseModel&&(t=f.mapOffset(t),d=f.mapOffset(d));f=this._currentLineAnnotation;if(!(g===i&&u&&r&&f&&f.start===t&&f.end===d)){var g=f?[f]:null,k;r&&(f=c.AnnotationType.createAnnotation(c.AnnotationType.ANNOTATION_CURRENT_LINE,t,d),k=[f]);this._currentLineAnnotation=f;e.replaceAnnotations(g,k)}}},installTextView:function(){this._textView=this._textViewFactory();if(this._undoStackFactory)this._undoStack=this._undoStackFactory.createUndoStack(this);if(this._textDNDFactory)this._textDND=
this._textDNDFactory.createTextDND(this,this._undoStack);if(this._contentAssistFactory){var b=this._contentAssistFactory.createContentAssistMode(this);this._keyModes.push(b);this._contentAssist=b.getContentAssist()}var a=this,e=this._textView,f=this;this._listener={onModelChanged:function(){f.checkDirty()},onMouseOver:function(a){f._listener.onMouseMove(a)},onMouseMove:function(a){var b=i.Tooltip.getTooltip(e);if(b&&!(f._listener.lastMouseX===a.event.clientX&&f._listener.lastMouseY===a.event.clientY))f._listener.lastMouseX=
a.event.clientX,f._listener.lastMouseY=a.event.clientY,b.setTarget({x:a.x,y:a.y,getTooltipInfo:function(){return f._getTooltipInfo(this.x,this.y)}})},onMouseOut:function(a){var b=i.Tooltip.getTooltip(e);if(b&&!(f._listener.lastMouseX===a.event.clientX&&f._listener.lastMouseY===a.event.clientY))f._listener.lastMouseX=a.event.clientX,f._listener.lastMouseY=a.event.clientY,b.setTarget(null)},onScroll:function(){var a=i.Tooltip.getTooltip(e);a&&a.setTarget(null)},onSelection:function(a){f._updateCursorStatus();
f._highlightCurrentLine(a.newValue,a.oldValue)}};e.addEventListener("ModelChanged",this._listener.onModelChanged);e.addEventListener("Selection",this._listener.onSelection);e.addEventListener("MouseOver",this._listener.onMouseOver);e.addEventListener("MouseOut",this._listener.onMouseOut);e.addEventListener("MouseMove",this._listener.onMouseMove);e.addEventListener("Scroll",this._listener.onScroll);this._keyBindingFactory&&this._keyBindingFactory(this,this._keyModes,this._undoStack,this._contentAssist);
e.setKeyBinding(new q.KeyBinding(27),"cancelMode");e.setAction("cancelMode",function(){for(var a=!1,b=0;b<this._keyModes.length;b++)this._keyModes[b].isActive()&&(a=this._keyModes[b].cancel()||a);return a}.bind(this),{name:s.cancelMode});e.setAction("lineUp",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].lineUp();return!1}.bind(this));e.setAction("lineDown",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].lineDown();
return!1}.bind(this));e.setAction("enter",function(){for(var a=0;a<this._keyModes.length;a++)if(this._keyModes[a].isActive())return this._keyModes[a].enter();return!1}.bind(this));b=function(b){if(b!==void 0&&b!==-1){for(var e=this.getView().getModel(),f=this.getAnnotationModel(),d=a.mapOffset(e.getLineStart(b)),b=a.mapOffset(e.getLineEnd(b)),e=f.getAnnotations(d,b),h=null;e.hasNext();){var g=e.next();if(g.type===c.AnnotationType.ANNOTATION_BOOKMARK){h=g;break}}h?f.removeAnnotation(h):(h=c.AnnotationType.createAnnotation(c.AnnotationType.ANNOTATION_BOOKMARK,
d,b),h.title=void 0,f.addAnnotation(h))}};if(this._annotationFactory){var g=e.getModel();g.getBaseModel&&(g=g.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(g))if(g=this._annotationStyler=this._annotationFactory.createAnnotationStyler(e,this._annotationModel))g.addAnnotationType(c.AnnotationType.ANNOTATION_CURRENT_SEARCH),g.addAnnotationType(c.AnnotationType.ANNOTATION_MATCHING_SEARCH),g.addAnnotationType(c.AnnotationType.ANNOTATION_ERROR),g.addAnnotationType(c.AnnotationType.ANNOTATION_WARNING),
g.addAnnotationType(c.AnnotationType.ANNOTATION_MATCHING_BRACKET),g.addAnnotationType(c.AnnotationType.ANNOTATION_CURRENT_BRACKET),g.addAnnotationType(c.AnnotationType.ANNOTATION_CURRENT_LINE),g.addAnnotationType(c.AnnotationType.ANNOTATION_READ_OCCURRENCE),g.addAnnotationType(c.AnnotationType.ANNOTATION_WRITE_OCCURRENCE),g.addAnnotationType("orion.annotation.highlightError");e.annotationModel=this._annotationModel;var g=this._annotationFactory.createAnnotationRulers(this._annotationModel),n=this._annotationRuler=
g.annotationRuler;if(n)n.onDblClick=b,n.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),n.addAnnotationType(c.AnnotationType.ANNOTATION_ERROR),n.addAnnotationType(c.AnnotationType.ANNOTATION_WARNING),n.addAnnotationType(c.AnnotationType.ANNOTATION_TASK),n.addAnnotationType(c.AnnotationType.ANNOTATION_BOOKMARK);this.setAnnotationRulerVisible(!0);if(n=this._overviewRuler=g.overviewRuler)n.addAnnotationType(c.AnnotationType.ANNOTATION_CURRENT_SEARCH),n.addAnnotationType(c.AnnotationType.ANNOTATION_MATCHING_SEARCH),
n.addAnnotationType(c.AnnotationType.ANNOTATION_ERROR),n.addAnnotationType(c.AnnotationType.ANNOTATION_WARNING),n.addAnnotationType(c.AnnotationType.ANNOTATION_TASK),n.addAnnotationType(c.AnnotationType.ANNOTATION_BOOKMARK),n.addAnnotationType(c.AnnotationType.ANNOTATION_MATCHING_BRACKET),n.addAnnotationType(c.AnnotationType.ANNOTATION_CURRENT_BRACKET),n.addAnnotationType(c.AnnotationType.ANNOTATION_CURRENT_LINE),n.addAnnotationType(c.AnnotationType.ANNOTATION_READ_OCCURRENCE),n.addAnnotationType(c.AnnotationType.ANNOTATION_WRITE_OCCURRENCE);
this.setOverviewRulerVisible(!0)}if(this._lineNumberRulerFactory)this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.onDblClick=b,this.setLineNumberRulerVisible(!0);if(this._foldingRulerFactory)this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(c.AnnotationType.ANNOTATION_FOLDING),this.setFoldingRulerVisible(!1);this.dispatchEvent({type:"TextViewInstalled",textView:e})},
uninstallTextView:function(){var b=this._textView;if(b)b.destroy(),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._keyModes=[],this.dispatchEvent({type:"TextViewUninstalled",textView:b})},_updateCursorStatus:function(){var b=this.getModel(),a=this.getCaretOffset(),c=b.getLineAtOffset(a),
b=b.getLineStart(c);a-=b;for(b=0;b<this._keyModes.length;b++){var f=this._keyModes[b];if(f.isActive()&&f.isStatusActive&&f.isStatusActive())return}this.reportStatus(e.formatMessage(s.lineColumn,c+1,a+1))},showProblems:function(b){var a=this._annotationModel;if(a){for(var e=[],f=[],g=a.getTextModel(),i=a.getAnnotations(0,g.getCharCount()),r;i.hasNext();)r=i.next(),(r.type===c.AnnotationType.ANNOTATION_ERROR||r.type===c.AnnotationType.ANNOTATION_WARNING)&&e.push(r);if(b)for(i=0;i<b.length;i++)if(r=
b[i]){var u=r.description.replace(/'/g,"&#39;").replace(/"/g,"&#34;"),t=g.getLineStart(r.line-1);r=c.AnnotationType.createAnnotation(r.severity==="error"?c.AnnotationType.ANNOTATION_ERROR:c.AnnotationType.ANNOTATION_WARNING,t+r.start-1,t+r.end,u);f.push(r)}a.replaceAnnotations(e,f)}},showOccurrences:function(b){var a=this._annotationModel;if(a){for(var e=[],f=[],g=a.getTextModel(),i=a.getAnnotations(0,g.getCharCount()),r;i.hasNext();)r=i.next(),(r.type===c.AnnotationType.ANNOTATION_READ_OCCURRENCE||
r.type===c.AnnotationType.ANNOTATION_WRITE_OCCURRENCE)&&e.push(r);if(b)for(i=0;i<b.length;i++)if(r=b[i]){var u=g.getLineStart(r.line-1);r=c.AnnotationType.createAnnotation(r.readAccess===!0?c.AnnotationType.ANNOTATION_READ_OCCURRENCE:c.AnnotationType.ANNOTATION_WRITE_OCCURRENCE,u+r.start-1,u+r.end,r.description);f.push(r)}a.replaceAnnotations(e,f)}},showSelection:function(b,a,c,e,f){typeof b==="number"?(typeof a!=="number"&&(a=b),this.moveSelection(b,a)):typeof c==="number"&&(b=this.getModel().getLineStart(c-
1),typeof e==="number"&&(b+=e),typeof f!=="number"&&(f=0),this.moveSelection(b,b+f))},setInput:function(b,a,c,e){this._title=b;this._textView&&(e?(this._undoStack.markClean(),this.checkDirty()):(a?this._textView.setText(a):c!==null&&c!==void 0&&(this._textView.setText(c),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection())),this._undoStack.reset(),this.checkDirty(),this._textView.focus()));this.onInputChanged({type:"InputChanged",title:b,message:a,
contents:c,contentsSaved:e})},onInputChanged:function(b){return this.dispatchEvent(b)},onGotoLine:function(b,a,c){if(this._textView){var e=this.getModel(),f=e.getLineStart(b),g=0;c===void 0&&(c=0);typeof a==="string"?(b=e.getLine(b).indexOf(a),b!==-1&&(g=b,c=g+a.length)):(g=a,a=e.getLineEnd(b)-f,g=Math.min(g,a),c=Math.min(c,a));this.moveSelection(f+g,f+c)}},onDirtyChanged:function(b){return this.dispatchEvent(b)}};p.EventTarget.addMixin(f.prototype);if(!Function.prototype.bind)Function.prototype.bind=
g;return{Editor:f}});define("orion/editor/regex",[],function(){return{escape:function(s){return s.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")},parse:function(s){return(s=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(s))?{pattern:s[1],flags:s[2]}:null}}});
define("orion/editor/editorFeatures","i18n!orion/editor/nls/messages,orion/editor/undoStack,orion/keyBinding,orion/editor/rulers,orion/editor/annotations,orion/editor/tooltip,orion/editor/textDND,orion/editor/regex,orion/util".split(","),function(s,q,p,i,c,e,f,g,b){function a(){}function h(){}function o(){}function m(){}function n(){}function r(a){this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";var b=this;this._listener={onVerify:function(a){var d=b.editor,
c=d.getModel(),e=d.mapOffset(a.start),d=d.mapOffset(a.end),c=c.getText(e,d);if((c=b._prefix.match(RegExp("^"+g.escape(c),"i")))&&c.length>0)b._prefix+=a.text,b._success=!0,b._status(),b.find(!0),a.text=null},onSelection:function(){b._ignoreSelection||b.setActive(!1)}}}function u(a,b,d){this.editor=a;this.undoStack=b;this._incrementalFind=new r(a);this._searcher=d;this._lastEditLocation=null;this.init()}function t(a,b,d,c){this.editor=a;this.undoStack=b;this.contentAssist=d;this.linkedMode=c;this.contentAssist&&
this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this));this.init()}function d(a){this.editor=a;this.linkedModeActive=!1;this.linkedModePositions=[];this.linkedModeEscapePosition=this.linkedModeCurrentPositionIndex=0;this.linkedModeListener={onVerify:function(a){for(var b=!1,d=0,c=0;c<this.linkedModePositions.length;++c){var e=this.linkedModePositions[c];if(b)e.offset+=d;else if(a.start>=e.offset&&a.end<=e.offset+e.length)b=e.length,e.length=a.start-e.offset+
a.text.length+(e.offset+e.length-a.end),d=e.length-b,b=!0}b?this.linkedModeEscapePosition+=d:this.cancel()}.bind(this)}}a.prototype={createUndoStack:function(a){var a=a.getTextView(),b=new q.UndoStack(a,200);a.setAction("undo",function(){b.undo();return!0},{name:s.undo});a.setAction("redo",function(){b.redo();return!0},{name:s.redo});return b}};h.prototype={createLineNumberRuler:function(a){return new i.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};
o.prototype={createFoldingRuler:function(a){return new i.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};m.prototype={createAnnotationModel:function(a){return new c.AnnotationModel(a)},createAnnotationStyler:function(a,b){return new c.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new i.AnnotationRuler(a,"left",{styleClass:"ruler annotations"}),a=new i.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};n.prototype={createTextDND:function(a,
b){return new f.TextDND(a.getTextView(),b)}};r.prototype={backspace:function(){if(!this.isActive())return!1;var a=this._prefix,a=this._prefix=a.substring(0,a.length-1);return a.length===0?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(!1)},find:function(a){if(!this.isActive())return!1;var b=this._prefix;if(b.length===0)return!1;var d=this.editor,c=d.getModel(),c=a?this._success?d.getSelection().start+
1:0:this._success?d.getCaretOffset()-b.length-1:c.getCharCount()-1;(a=d.getModel().find({string:b,start:c,reverse:!a,caseInsensitive:b.toLowerCase()===b}).next())?(this._ignoreSelection=this._success=!0,d.moveSelection(a.start,a.end),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},setActive:function(a){this._active=a;this._prefix="";this._success=!0;a=this.editor.getTextView();this.editor.setCaretOffset(this.editor.getCaretOffset());this._active?
(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection));this._status()},_status:function(){this.isActive()?this.editor.reportStatus(b.formatMessage(this._success?s.incrementalFind:s.incrementalFindNotFound,this._prefix),this._success?"":"error"):this.editor.reportStatus("")}};u.prototype={init:function(){var a=this,d=this.editor.getTextView();
this._lastEditListener={onModelChanged:function(d){if(a.editor.isDirty())a._lastEditLocation=d.start+d.addedCharCount}};d.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);d.setKeyBinding(new p.KeyBinding("k",!0),"findNext");d.setAction("findNext",function(){if(this._searcher){var a=d.getSelection();a.start<a.end?this._searcher.findNext(!0,d.getText(a.start,a.end)):this._searcher.findNext(!0);return!0}return!1}.bind(this),{name:s.findNext});d.setKeyBinding(new p.KeyBinding("k",
!0,!0),"findPrevious");d.setAction("findPrevious",function(){if(this._searcher){var a=d.getSelection();a.start<a.end?this._searcher.findNext(!1,d.getText(a.start,a.end)):this._searcher.findNext(!1);return!0}return!1}.bind(this),{name:s.findPrevious});d.setKeyBinding(new p.KeyBinding("j",!0),"incrementalFind");d.setAction("incrementalFind",function(){if(this._searcher&&this._searcher.visible())return!0;this._incrementalFind.isActive()?this._incrementalFind.find(!0):this._incrementalFind.setActive(!0);
return!0}.bind(this),{name:s.incrementalFindKey});d.setAction("deletePrevious",function(){return this._incrementalFind.backspace()}.bind(this));d.setAction("tab",function(){if(d.getOptions("readonly"))return!1;if(d.getOptions("tabMode")){var a=this.editor,b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),f=b.getLineAtOffset(c.end>c.start?c.end-1:c.end);if(e!==f){var h=[];h.push("");for(var g=e;g<=f;g++)h.push(b.getLine(g,!0));var g=b.getLineStart(e),b=b.getLineEnd(f,!0),i=d.getOptions("tabSize",
"expandTab"),i=i.expandTab?Array(i.tabSize+1).join(" "):"\t";a.setText(h.join(i),g,b);a.setSelection(g===c.start?c.start:c.start+i.length,c.end+(f-e+1)*i.length);return!0}a=a.getKeyModes();for(c=0;c<a.length;c++)if(a[c].isActive())return a[c].tab();return!1}}.bind(this));d.setAction("shiftTab",function(){if(d.getOptions("readonly"))return!1;if(d.getOptions("tabMode")){for(var a=this.editor,b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),f=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),
h=d.getOptions("tabSize"),g=Array(h+1).join(" "),i=[],k=0,m=0,o=e;o<=f;o++){var n=b.getLine(o,!0);if(b.getLineStart(o)!==b.getLineEnd(o))if(n.indexOf("\t")===0)n=n.substring(1),k++;else if(n.indexOf(g)===0)n=n.substring(h),k+=h;else return!0;o===e&&(m=k);i.push(n)}e=b.getLineStart(e);h=b.getLineEnd(f,!0);b=b.getLineStart(f);a.setText(i.join(""),e,h);i=e===c.start?c.start:c.start-m;c=Math.max(i,c.end-k+(c.end===b+1&&c.start!==c.end?1:0));a.setSelection(i,c);return!0}}.bind(this),{name:s.unindentLines});
d.setKeyBinding(new p.KeyBinding(38,!1,!1,!0),"moveLinesUp");d.setAction("moveLinesUp",function(){if(d.getOptions("readonly"))return!1;var a=this.editor,b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start);if(e===0)return!0;var f=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),h=b.getLineCount(),c=b.getLineStart(e-1),g=b.getLineStart(e),i=b.getLineEnd(f,!0),k=b.getText(g,i),m=0;f===h-1&&(f=b.getLineEnd(e-1),e=b.getLineEnd(e-1,!0),k+=b.getText(f,e),g=f,m=e-f);this.startUndo();a.setText("",
g,i);a.setText(k,c,c);a.setSelection(c,c+k.length-m);this.endUndo();return!0}.bind(this),{name:s.moveLinesUp});d.setKeyBinding(new p.KeyBinding(40,!1,!1,!0),"moveLinesDown");d.setAction("moveLinesDown",function(){if(d.getOptions("readonly"))return!1;var a=this.editor,b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),f=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),h=b.getLineCount();if(f===h-1)return!0;var e=b.getLineStart(e),c=b.getLineEnd(f,!0),g=b.getLineEnd(f+1,!0)-(c-e),i=0;f!==
h-2?b=b.getText(e,c):(f=b.getLineEnd(f),b=b.getText(f,c)+b.getText(e,f),i+=c-f);this.startUndo();a.setText("",e,c);a.setText(b,g,g);a.setSelection(g+i,g+i+b.length);this.endUndo();return!0}.bind(this),{name:s.moveLinesDown});d.setKeyBinding(new p.KeyBinding(38,!0,!1,!0),"copyLinesUp");d.setAction("copyLinesUp",function(){if(d.getOptions("readonly"))return!1;var a=this.editor,b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),e=b.getLineStart(e),
f=b.getLineEnd(c,!0),h=b.getLineCount(),g="",f=b.getText(e,f);c===h-1&&(f+=g=b.getLineDelimiter());a.setText(f,e,e);a.setSelection(e,e+f.length-g.length);return!0}.bind(this),{name:s.copyLinesUp});d.setKeyBinding(new p.KeyBinding(40,!0,!1,!0),"copyLinesDown");d.setAction("copyLinesDown",function(){if(d.getOptions("readonly"))return!1;var a=this.editor,b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),f=b.getLineStart(e),e=b.getLineEnd(c,
!0),h=b.getLineCount(),g="",f=b.getText(f,e);c===h-1&&(f=(g=b.getLineDelimiter())+f);a.setText(f,e,e);a.setSelection(e+g.length,e+f.length);return!0}.bind(this),{name:s.copyLinesDown});d.setKeyBinding(new p.KeyBinding("d",!0,!1,!1),"deleteLines");d.setAction("deleteLines",function(){if(d.getOptions("readonly"))return!1;var a=this.editor,b=a.getSelection(),c=a.getModel(),e=c.getLineAtOffset(b.start),b=c.getLineAtOffset(b.end>b.start?b.end-1:b.end),e=c.getLineStart(e),c=c.getLineEnd(b,!0);a.setText("",
e,c);return!0}.bind(this),{name:s.deleteLines});d.setKeyBinding(new p.KeyBinding("l",!0),"gotoLine");d.setAction("gotoLine",function(){var a=this.editor,b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=prompt(s.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0}.bind(this),{name:s.gotoLine});d.setKeyBinding(new p.KeyBinding(190,!0),"nextAnnotation");d.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:s.nextAnnotation});d.setKeyBinding(new p.KeyBinding(188,
!0),"previousAnnotation");d.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:s.prevAnnotation});d.setKeyBinding(new p.KeyBinding("e",!0,!1,!0,!1),"expand");d.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:s.expand});d.setKeyBinding(new p.KeyBinding("c",!0,!1,!0,!1),"collapse");d.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:s.collapse});d.setKeyBinding(new p.KeyBinding("e",!0,!0,!0,!1),
"expandAll");d.setAction("expandAll",function(){return this.expandAnnotations(!0)}.bind(this),{name:s.expandAll});d.setKeyBinding(new p.KeyBinding("c",!0,!0,!0,!1),"collapseAll");d.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:s.collapseAll});d.setKeyBinding(new p.KeyBinding("q",!b.isMac,!1,!1,b.isMac),"lastEdit");d.setAction("lastEdit",function(){typeof this._lastEditLocation==="number"&&this.editor.showSelection(this._lastEditLocation);return!0}.bind(this),
{name:s.lastEdit})},nextAnnotation:function(a){var b=this.editor,d=b.getAnnotationModel();if(!d)return!0;for(var f=b.getModel(),h=b.getCaretOffset(),d=d.getAnnotations(a?h:0,a?f.getCharCount():h),g=null;d.hasNext();){var i=d.next();if(a){if(i.start<=h)continue}else if(i.start>=h)continue;switch(i.type){case c.AnnotationType.ANNOTATION_ERROR:case c.AnnotationType.ANNOTATION_WARNING:case c.AnnotationType.ANNOTATION_TASK:case c.AnnotationType.ANNOTATION_BOOKMARK:break;default:continue}g=i;if(a)break}if(g){var m=
b.getTextView(),o=f.getLineAtOffset(g.start),n=e.Tooltip.getTooltip(m);if(!n)return b.moveSelection(g.start),!0;b.moveSelection(g.start,g.start,function(){n.setTarget({getTooltipInfo:function(){var a=m.convert({x:m.getLocationAtOffset(g.start).x,y:m.getLocationAtOffset(f.getLineStart(o)).y},"document","page");return{contents:[g],x:a.x,y:a.y+Math.floor(m.getLineHeight(o)*1.33)}}},0)})}return!0},expandAnnotation:function(a){var b=this.editor,d=b.getAnnotationModel();if(!d)return!0;var e=b.getModel(),
f=b.getCaretOffset(),h=e.getLineAtOffset(f),f=e.getLineStart(h),h=e.getLineEnd(h,!0);e.getBaseModel&&(f=e.mapOffset(f),h=e.mapOffset(h),e.getBaseModel());for(var g,e=d.getAnnotations(f,h);!g&&e.hasNext();)f=e.next(),f.type===c.AnnotationType.ANNOTATION_FOLDING&&(g=f);g&&a!==g.expanded&&(a?g.expand():(b.setCaretOffset(g.start),g.collapse()),d.modifyAnnotation(g));return!0},expandAnnotations:function(a){var b=this.editor,d=b.getTextView(),e=b.getAnnotationModel();if(!e)return!0;var b=b.getModel(),f=
e.getAnnotations(0,b.getCharCount());for(d.setRedraw(!1);f.hasNext();)b=f.next(),b.type===c.AnnotationType.ANNOTATION_FOLDING&&a!==b.expanded&&(a?b.expand():b.collapse(),e.modifyAnnotation(b));d.setRedraw(!0);return!0},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},cancel:function(){this._incrementalFind.setActive(!1)},isActive:function(){return this._incrementalFind.isActive()},isStatusActive:function(){return this._incrementalFind.isActive()},
lineUp:function(){return this._incrementalFind.find(!1)},lineDown:function(){return this._incrementalFind.find(!0)},enter:function(){return!1}};t.prototype={startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},init:function(){function a(b,d,c){var e=b.getLineAtOffset(d),f=b.getLineAtOffset(c),h,g,i,j,k,m;for(h=e;h>=0;h--)if(g=b.getLine(h),i=h===e?d-b.getLineStart(e):g.length,j=g.lastIndexOf("/*",i),g=g.lastIndexOf("*/",
i),g>j)break;else if(j!==-1){k=b.getLineStart(h)+j;break}for(h=f;h<b.getLineCount();h++)if(g=b.getLine(h),i=h===f?c-b.getLineStart(f):0,j=g.indexOf("/*",i),g=g.indexOf("*/",i),j!==-1&&j<g)break;else if(g!==-1){m=b.getLineStart(h)+g;break}return{commentStart:k,commentEnd:m}}var d=this.editor.getTextView();d.setAction("lineStart",function(){for(var a=this.editor,b=a.getModel(),d=a.getCaretOffset(),c=b.getLineAtOffset(d),e=b.getLineStart(c),b=b.getLine(c),c=0;c<b.length;c++){var f=b.charCodeAt(c);if(!(f===
32||f===9))break}c+=e;return d!==c?(a.setSelection(c,c),!0):!1}.bind(this));d.setKeyBinding(new p.KeyBinding(191,!0),"toggleLineComment");d.setAction("toggleLineComment",function(){if(d.getOptions("readonly"))return!1;for(var a=this.editor,b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),f=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),h=!0,g=[],i,k,m=e;m<=f;m++)if(i=b.getLine(m,!0),g.push(i),!h||(k=i.indexOf("//"))===-1)h=!1;else if(k!==0){var o;for(o=0;o<k;o++)if(h=i.charCodeAt(o),
!(h===32||h===9))break;h=o===k}m=b.getLineStart(e);o=b.getLineEnd(f,!0);if(h){for(h=0;h<g.length;h++)i=g[h],k=i.indexOf("//"),g[h]=i.substring(0,k)+i.substring(k+2);g=g.join("");i=b.getLineStart(f);b=m===c.start?c.start:c.start-2;c=c.end-2*(f-e+1)+(c.end===i+1?2:0)}else g.splice(0,0,""),g=g.join("//"),b=m===c.start?c.start:c.start+2,c=c.end+2*(f-e+1);a.setText(g,m,o);a.setSelection(b,c);return!0}.bind(this),{name:s.toggleLineComment});d.setKeyBinding(new p.KeyBinding(191,!0,!b.isMac,!1,b.isMac),"addBlockComment");
d.setAction("addBlockComment",function(){if(d.getOptions("readonly"))return!1;var b=this.editor,c=b.getModel(),e=b.getSelection(),f=RegExp("/\\*|\\*/","g"),h=a(c,e.start,e.end);if(h.commentStart!==void 0&&h.commentEnd!==void 0)return!0;c=c.getText(e.start,e.end);if(c.length===0)return!0;h=c.length;c=c.replace(f,"");f=c.length;b.setText("/*"+c+"*/",e.start,e.end);b.setSelection(e.start+2,e.end+2+(f-h));return!0}.bind(this),{name:s.addBlockComment});d.setKeyBinding(new p.KeyBinding(220,!0,!b.isMac,
!1,b.isMac),"removeBlockComment");d.setAction("removeBlockComment",function(){if(d.getOptions("readonly"))return!1;var b=this.editor,c=b.getModel(),e=b.getSelection(),f=c.getText(e.start,e.end),h,g,i;for(i=0;i<f.length;i++)if(f.substring(i,i+2)==="/*"){h=e.start+i;break}for(;i<f.length;i++)if(f.substring(i,i+2)==="*/"){g=e.start+i;break}if(h!==void 0&&g!==void 0)b.setText(c.getText(h+2,g),h,g+2),b.setSelection(h,g);else{f=a(c,e.start,e.end);if(f.commentStart===void 0||f.commentEnd===void 0)return!0;
c=c.getText(f.commentStart+2,f.commentEnd);b.setText(c,f.commentStart,f.commentEnd+2);b.setSelection(e.start-2,e.end-2)}return!0}.bind(this),{name:s.removeBlockComment})},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&this.linkedMode){for(var b=[],d=0;d<a.positions.length;++d)b[d]={positions:[{offset:a.positions[d].offset,length:a.positions[d].length}]};this.linkedMode.enterLinkedMode({groups:b,escapePosition:a.escapePosition})}else a.escapePosition&&this.editor.getTextView().setCaretOffset(a.escapePosition);
return!0},cancel:function(){return!1},isActive:function(){return!0},isStatusActive:function(){return!1},lineUp:function(){return!1},lineDown:function(){return!1},enter:function(){if(this.editor.getTextView().getOptions("readonly"))return!1;var a=this.editor,b=a.getSelection();if(b.start===b.end){for(var d=a.getModel(),c=d.getLineAtOffset(b.start),e=d.getLine(c,!0),f=d.getLineStart(c),c=0,f=b.start-f,h;c<f&&((h=e.charCodeAt(c))===32||h===9);)c++;if(c>0){for(var g=e.substring(0,c),c=f;c<e.length&&((h=
e.charCodeAt(c++))===32||h===9);)b.end++;a.setText(d.getLineDelimiter()+g,b.start,b.end);return!0}}return!1},tab:function(){return!1}};d.prototype={enterLinkedMode:function(a){if(!this.linkedModeActive){this.linkedModeActive=!0;this.linkedModePositions=[];for(var b=0;b<a.groups.length;++b){var d=a.groups[b];this.linkedModePositions[b]={offset:d.positions[0].offset,length:d.positions[0].length}}this.linkedModeEscapePosition=a.escapePosition;this.linkedModeCurrentPositionIndex=0;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);
a=this.editor.getTextView();a.addEventListener("Verify",this.linkedModeListener.onVerify);a.setKeyBinding(new p.KeyBinding(9),"nextLinkedModePosition");a.setAction("nextLinkedModePosition",function(){this.linkedModeCurrentPositionIndex=++this.linkedModeCurrentPositionIndex%this.linkedModePositions.length;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);return!0}.bind(this));a.setKeyBinding(new p.KeyBinding(9,!1,!0),"previousLinkedModePosition");a.setAction("previousLinkedModePosition",
function(){this.linkedModeCurrentPositionIndex=this.linkedModeCurrentPositionIndex>0?this.linkedModeCurrentPositionIndex-1:this.linkedModePositions.length-1;this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);return!0}.bind(this));this.editor.reportStatus(s.linkedModeEntered,null,!0)}},isActive:function(){return this.linkedModeActive},isStatusActive:function(){return this.linkedModeActive},enter:function(){this.cancel();return!0},cancel:function(a){if(this.linkedModeActive){this.linkedModeActive=
!1;var b=this.editor.getTextView();b.removeEventListener("Verify",this.linkedModeListener.onVerify);b.setKeyBinding(new p.KeyBinding(9),"tab");b.setKeyBinding(new p.KeyBinding(9,!1,!0),"shiftTab");a||b.setCaretOffset(this.linkedModeEscapePosition,!1);this.editor.reportStatus(s.linkedModeExited,null,!0)}},lineUp:function(){this.cancel(!0);return!1},lineDown:function(){this.cancel(!0);return!1},selectTextForLinkedModePosition:function(a){this.editor.getTextView().setSelection(a.offset,a.offset+a.length)}};
return{UndoFactory:a,LineNumberRulerFactory:h,FoldingRulerFactory:o,AnnotationFactory:m,TextDNDFactory:n,TextActions:u,SourceCodeActions:t,LinkedMode:d}});
(function(s,q){typeof define==="function"&&define.amd?define("orion/Deferred",[],q):typeof exports==="object"?module.exports=q():(s.orion=s.orion||{},s.orion.Deferred=q())})(this,function(){function s(){for(var a;a=f.shift()||g.shift();)a();b=!1}function q(a,c){(c?g:f).push(a);b||(b=!0,c?setTimeout(s,0):s())}function p(a){return function(){a.apply(null,arguments)}}function i(){}function c(){var a=Error("Cancel");a.name="Cancel";return a}function e(){function a(){for(var a;a=g.shift();){var c=a.deferred,
e=f==="resolved"?"resolve":"reject";if(typeof a[e]==="function")try{var d=a[e](b);d&&typeof d.then==="function"?(c.cancel=d.cancel||i,d.then(p(c.resolve),p(c.reject),c.progress)):c.resolve(d)}catch(k){c.reject(k)}else c[e](b)}}var b,f,g=[],n=this;this.reject=function(c){f||(f="rejected",b=c,g.length&&q(a));return n.promise};this.resolve=function(c){f||(f="resolved",b=c,g.length&&q(a));return n.promise};this.progress=function(a){f||g.forEach(function(b){b.progress&&b.progress(a)});return n.promise};
this.cancel=function(){f||n.reject(c())};this.then=function(b,c,h){var b={resolve:b,reject:c,progress:h,deferred:new e},d=b.deferred,i=this.cancel.bind(this),j=function(){q(function(){(d.cancel===j?i:d.cancel)()},!0)};d.cancel=j;c=d.promise;c.cancel=function(){d.cancel()};g.push(b);f&&q(a,!0);return c};this.promise={then:this.then,cancel:this.cancel}}var f=[],g=[],b=!1;e.all=function(a,b){function c(a,b){u||(i[a]=b,--g===0&&p.resolve(i))}function f(a,e){if(!u){if(b)try{c(a,b(e));return}catch(g){e=
g}p.reject(e)}}var g=a.length,i=[],u=!1,p=new e;p.then(null,function(){u=!0;a.forEach(function(a){a.cancel&&a.cancel()})});g===0?p.resolve(i):a.forEach(function(a,b){a.then(c.bind(null,b),f.bind(null,b))});return p.promise};e.when=function(a,b,c,f){var g;if(!(a&&typeof a.then==="function"))g=new e,g.resolve(a),a=g.promise;return a.then(b,c,f)};return e});
define("orion/editor/contentAssist",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/eventTarget","orion/Deferred","orion/util"],function(s,q,p,i,c){var e,f,g;function b(a){this.textView=a;this.state=e;this.providers=[];var b=this;this.contentAssistListener={onModelChanging:function(a){b.isDeactivatingChange(a)?b.setState(e):b.state===f&&b.setState(g)},onScroll:function(){b.setState(e)},onSelection:function(){var a=b.state;if(a===f||a===g)b.computeProposals(),b.setState(g)}};a.setKeyBinding(c.isMac?
new q.KeyBinding(" ",!1,!1,!1,!0):new q.KeyBinding(" ",!0),"contentAssist");a.setAction("contentAssist",function(){b.activate();return!0},{name:s.contentAssist})}function a(a,b){this.contentAssist=a;this.widget=b;this.proposals=[];var c=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){c.proposals=a.data.proposals;c.selectedIndex=c.proposals.length?0:-1})}function h(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=
!1;var e=this.textView.getOptions("parent").ownerDocument;this.parentNode=typeof b==="string"?e.getElementById(b):b;if(!this.parentNode){this.parentNode=c.createElement(e,"div");this.parentNode.className="contentassist";var f=e.getElementsByTagName("body")[0];if(f)f.appendChild(this.parentNode);else throw Error("parentNode is required");}var g=this;this.textViewListener={onMouseDown:function(a){a.event.target.parentElement!==g.parentNode&&g.contentAssist.deactivate()}};this.contentAssist.addEventListener("ProposalsComputed",
function(a){g.setProposals(a.data.proposals);g.show();if(!g.textViewListenerAdded)g.textView.addEventListener("MouseDown",g.textViewListener.onMouseDown),g.textViewListenerAdded=!0});this.contentAssist.addEventListener("Deactivating",function(){g.setProposals([]);g.hide();if(g.textViewListenerAdded)g.textView.removeEventListener("MouseDown",g.textViewListener.onMouseDown),g.textViewListenerAdded=!1;g.textViewListenerAdded=!1});this.scrollListener=function(){g.isShowing&&g.position()};e.addEventListener&&
e.addEventListener("scroll",this.scrollListener)}e=1;f=2;g=3;var o={selected:" selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",dfault:"proposal-default"};b.prototype={apply:function(a){if(!a)return!1;var b=this.textView.getSelection(),c=Math.min(b.start,b.end),b=Math.max(b.start,b.end);a.overwrite&&(c=this.getPrefixStart(c));var f={proposal:a,start:c,end:b};this.setState(e);this.textView.setText(a.proposal||a,c,b);this.dispatchEvent({type:"ProposalApplied",
data:f});return!0},activate:function(){this.state===e&&this.setState(f)},deactivate:function(){this.setState(e)},getTextView:function(){return this.textView},isActive:function(){return this.state===f||this.state===g},isDeactivatingChange:function(a){var b=a.removedCharCount>0&&a.addedCharCount===0,c=this.textView,c=a.start+1<=c.getModel().getCharCount()&&/^\s*$/.test(c.getText(a.start,a.start+1));return a.removedLineCount>0||a.addedLineCount>0||b&&c},setState:function(a){var b;a===f?b="Activating":
a===e&&(b="Deactivating");b&&this.dispatchEvent({type:b});this.state=a;this.onStateChange(a)},onStateChange:function(a){if(a===e){if(this.listenerAdded)this.textView.removeEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!1}else if(a===f){if(!this.listenerAdded)this.textView.addEventListener("ModelChanging",
this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!0;this.computeProposals()}},computeProposals:function(){var a=this;this._computeProposals(this.textView.getCaretOffset()).then(function(b){a.dispatchEvent({type:"ProposalsComputed",data:{proposals:b}})})},getPrefixStart:function(a){for(;a>0&&/[A-Za-z0-9_]/.test(this.textView.getText(a-
1,a));)a--;return a},handleError:function(a){typeof console!=="undefined"&&(console.log("Error retrieving content assist proposals"),console.log(a))},_computeProposals:function(a){var b=this.providers,c=this.textView,e=c.getModel(),f=c.getText(),d={line:e.getLine(e.getLineAtOffset(a)),prefix:c.getText(this.getPrefixStart(a),a),selection:c.getSelection()},g=this,b=b.map(function(b){var c=b.computeProposals||b.getProposals,e;try{typeof c==="function"&&(e=g.progress?g.progress.progress(c.apply(b,[f,
a,d]),"Generating content assist proposal"):c.apply(b,[f,a,d]))}catch(h){g.handleError(h)}return i.when(e)});return i.all(b,this.handleError).then(function(a){return a.reduce(function(a,b){return b instanceof Array?a.concat(b):a},[])})},setProviders:function(a){this.providers=a.slice(0)},setProgress:function(a){this.progress=a}};p.EventTarget.addMixin(b.prototype);a.prototype={cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},isActive:function(){return this.getContentAssist().isActive()},
lineUp:function(){for(var a=this.selectedIndex===0?this.proposals.length-1:this.selectedIndex-1;this.proposals[a].unselectable&&a>0;)a--;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},lineDown:function(){for(var a=this.selectedIndex===this.proposals.length-1?0:this.selectedIndex+1;this.proposals[a].unselectable&&a<this.proposals.length-1;)a++;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||
null)},tab:function(){return this.widget?(this.widget.createAccessible(this),this.widget.parentNode.focus(),!0):!1}};h.prototype={onClick:function(a){this.contentAssist.apply(this.getProposal(a.target));this.textView.focus()},createDiv:function(a,b,e,f){var g=e.ownerDocument,d=c.createElement(g,"div");d.id="contentoption"+f;d.setAttribute("role","option");a.style==="hr"?a=c.createElement(g,"hr"):(d.className=this.calculateClasses(a.style,b),a=g.createTextNode(this.getDisplayString(a)),b&&this.parentNode.setAttribute("aria-activedescendant",
d.id));d.appendChild(a,d);e.appendChild(d)},createAccessible:function(a){this._isAccessible||this.parentNode.addEventListener("keydown",function(b){b.preventDefault();if(b.keyCode===27)return a.cancel();else if(b.keyCode===38)return a.lineUp();else if(b.keyCode===40)return a.lineDown();else if(b.keyCode===13)return a.enter();return!1});this._isAccessible=!0},calculateClasses:function(a,b){var c=o[a];if(!c)c=o.dfault;return b?c+o.selected:c},getDisplayString:function(a){return typeof a==="string"?
a:a.description&&typeof a.description==="string"?a.description:a.proposal},getProposal:function(a){for(var b=0,c=this.parentNode.firstChild;c!==null;c=c.nextSibling){if(c===a)return this.proposals[b]||null;b++}return null},setSelectedIndex:function(a){this.selectedIndex=a;this.selectNode(this.parentNode.childNodes[this.selectedIndex])},selectNode:function(a){for(var b=this.parentNode.childNodes,c=0;c<b.length;c++){var e=b[c],f=e.className.indexOf(o.selected);if(f>=0)e.className=e.className.substring(0,
f)+e.className.substring(f+o.selected.length);e===a&&(e.className+=o.selected,this.parentNode.setAttribute("aria-activedescendant",e.id),e.focus(),e.offsetTop<this.parentNode.scrollTop?e.scrollIntoView(!0):e.offsetTop+e.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&e.scrollIntoView(!1))}},setProposals:function(a){this.proposals=a},show:function(){if(this.proposals.length===0)this.hide();else{this.parentNode.innerHTML="";for(var a=0;a<this.proposals.length;a++)this.createDiv(this.proposals[a],
a===0,this.parentNode,a);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1},position:function(){var a=this.textView.getLocationAtOffset(this.textView.getCaretOffset());a.y+=this.textView.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";
this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;var b=this.parentNode.ownerDocument,c=b.documentElement.clientWidth;if(a.y+this.parentNode.offsetHeight>b.documentElement.clientHeight)this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px";if(a.x+this.parentNode.offsetWidth>c)this.parentNode.style.left=c-this.parentNode.offsetWidth+"px"}};return{ContentAssist:b,ContentAssistMode:a,
ContentAssistWidget:h}});
define("orion/editor/cssContentAssist",[],function(){function s(){}var q="alignment-adjust,alignment-baseline,animation,animation-delay,animation-direction,animation-duration,animation-iteration-count,animation-name,animation-play-state,animation-timing-function,appearance,azimuth,backface-visibility,background,background-attachment,background-clip,background-color,background-image,background-origin,background-position,background-repeat,background-size,baseline-shift,binding,bleed,bookmark-label,bookmark-level,bookmark-state,bookmark-target,border,border-bottom,border-bottom-color,border-bottom-left-radius,border-bottom-right-radius,border-bottom-style,border-bottom-width,border-collapse,border-color,border-image,border-image-outset,border-image-repeat,border-image-slice,border-image-source,border-image-width,border-left,border-left-color,border-left-style,border-left-width,border-radius,border-right,border-right-color,border-right-style,border-right-width,border-spacing,border-style,border-top,border-top-color,border-top-left-radius,border-top-right-radius,border-top-style,border-top-width,border-width,bottom,box-align,box-decoration-break,box-direction,box-flex,box-flex-group,box-lines,box-ordinal-group,box-orient,box-pack,box-shadow,box-sizing,break-after,break-before,break-inside,caption-side,clear,clip,color,color-profile,column-count,column-fill,column-gap,column-rule,column-rule-color,column-rule-style,column-rule-width,column-span,column-width,columns,content,counter-increment,counter-reset,crop,cue,cue-after,cue-before,cursor,direction,display,dominant-baseline,drop-initial-after-adjust,drop-initial-after-align,drop-initial-before-adjust,drop-initial-before-align,drop-initial-size,drop-initial-value,elevation,empty-cells,fit,fit-position,flex-align,flex-flow,flex-inline-pack,flex-order,flex-pack,float,float-offset,font,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,grid-columns,grid-rows,hanging-punctuation,height,hyphenate-after,hyphenate-before,hyphenate-character,hyphenate-lines,hyphenate-resource,hyphens,icon,image-orientation,image-rendering,image-resolution,inline-box-align,left,letter-spacing,line-height,line-stacking,line-stacking-ruby,line-stacking-shift,line-stacking-strategy,list-style,list-style-image,list-style-position,list-style-type,margin,margin-bottom,margin-left,margin-right,margin-top,mark,mark-after,mark-before,marker-offset,marks,marquee-direction,marquee-loop,marquee-play-count,marquee-speed,marquee-style,max-height,max-width,min-height,min-width,move-to,nav-down,nav-index,nav-left,nav-right,nav-up,opacity,orphans,outline,outline-color,outline-offset,outline-style,outline-width,overflow,overflow-style,overflow-x,overflow-y,padding,padding-bottom,padding-left,padding-right,padding-top,page,page-break-after,page-break-before,page-break-inside,page-policy,pause,pause-after,pause-before,perspective,perspective-origin,phonemes,pitch,pitch-range,play-during,position,presentation-level,punctuation-trim,quotes,rendering-intent,resize,rest,rest-after,rest-before,richness,right,rotation,rotation-point,ruby-align,ruby-overhang,ruby-position,ruby-span,size,speak,speak-header,speak-numeral,speak-punctuation,speech-rate,stress,string-set,table-layout,target,target-name,target-new,target-position,text-align,text-align-last,text-decoration,text-emphasis,text-height,text-indent,text-justify,text-outline,text-shadow,text-transform,text-wrap,top,transform,transform-origin,transform-style,transition,transition-delay,transition-duration,transition-property,transition-timing-function,unicode-bidi,vertical-align,visibility,voice-balance,voice-duration,voice-family,voice-pitch,voice-pitch-range,voice-rate,voice-stress,voice-volume,volume,white-space,white-space-collapse,widows,width,word-break,word-spacing,word-wrap,z-index".split(",");s.prototype=
{computeProposals:function(p,i){var c;for(c=i;c&&/[A-Za-z\-]/.test(p.charAt(c-1));)c--;c=c?p.substring(c,i):"";for(var e=[],f=0;f<q.length;f++){var g=q[f];g.indexOf(c)===0&&e.push({proposal:g.substring(c.length),description:g})}return e}};return{CssContentAssistProvider:s}});
define("orion/editor/htmlContentAssist",[],function(){function s(){}s.prototype={leadingWhitespace:function(q,p){var i="";for(p-=1;p>0;){var c=q.charAt(p--);if(c==="\n"||c==="\r")break;i=/\s/.test(c)?c.concat(i):""}return i},computeProposals:function(q,p,i){function c(a){return a.substring(i.prefix.length)}var e=[];if(q.length===0)return e.push({proposal:'<!DOCTYPE html>\n<html lang="en">\n\t<head>\n\t\t<meta charset=utf-8>\n\t\t<title>My Document</title>\n\t</head>\n\t<body>\n\t\t<h1>A basic HTML document</h1>\n\t\t<p>\n\t\t\t\n\t\t</p>\n\t</body>\n</html>',
description:"Simple HTML document",escapePosition:p+152}),e;var f=i.prefix;if(q.charAt(p-f.length-1)!=="<")return e;for(var g,b,a="abbr,b,button,canvas,cite,command,dd,del,dfn,dt,em,embed,font,h1,h2,h3,h4,h5,h6,i,ins,kbd,label,li,mark,meter,object,option,output,progress,q,rp,rt,samp,small,strong,sub,sup,td,time,title,tt,u,var".split(","),h=0;h<a.length;h++)g=a[h],g.indexOf(f)===0&&(b=g+"></"+g+">",g=p+g.length-f.length+1,e.push({proposal:c(b),description:"<"+b,escapePosition:g}));a="address,article,aside,audio,bdo,blockquote,body,caption,code,colgroup,datalist,details,div,fieldset,figure,footer,form,head,header,hgroup,iframe,legend,map,menu,nav,noframes,noscript,optgroup,p,pre,ruby,script,section,select,span,style,tbody,textarea,tfoot,th,thead,tr,video".split(",");
q=this.leadingWhitespace(q,p);for(h=0;h<a.length;h++)g=a[h],g.indexOf(f)===0&&(b=g+">\n"+q+"\t\n"+q+"</"+g+">",g=p+g.length-f.length+q.length+3,e.push({proposal:c(b),description:"<"+b,escapePosition:g}));a="area,base,br,col,hr,input,link,meta,param,keygen,source".split(",");for(h=0;h<a.length;h++)g=a[h],g.indexOf(f)===0&&(b=g+"/>",g=p+g.length-f.length+2,e.push({proposal:c(b),description:"<"+b,escapePosition:g}));"img".indexOf(f)===0&&(b='img src="" alt="Image"/>',e.push({proposal:c(b),description:"<"+
b,escapePosition:p+9-f.length}));f==="a"&&e.push({proposal:c('a href=""></a>'),description:"<a></a> - HTML anchor element",escapePosition:p+7});"ul".indexOf(f)===0&&(b="<ul> - unordered list",g=p-f.length+q.length+9,e.push({proposal:c("ul>\n"+q+"\t<li></li>\n"+q+"</ul>"),description:b,escapePosition:g}));"ol".indexOf(f)===0&&(b="<ol> - ordered list",g=p-f.length+q.length+9,e.push({proposal:c("ol>\n"+q+"\t<li></li>\n"+q+"</ol>"),description:b,escapePosition:g}));"dl".indexOf(f)===0&&(b="<dl> - definition list",
g=p-f.length+q.length+9,e.push({proposal:c("dl>\n"+q+"\t<dt></dt>\n"+q+"\t<dd></dd>\n"+q+"</dl>"),description:b,escapePosition:g}));"table".indexOf(f)===0&&(b="<table> - basic HTML table",g=p-f.length+q.length*2+19,e.push({proposal:c("table>\n"+q+"\t<tr>\n"+q+"\t\t<td></td>\n"+q+"\t</tr>\n"+q+"</table>"),description:b,escapePosition:g}));return e}};return{HTMLContentAssistProvider:s}});
define("orion/editor/jsTemplateContentAssist",[],function(){function s(c,e,f){var g=f-c.length,b=[],a="";for(f-=1;f>0;){var h=e.charAt(f--);if(h==="\n"||h==="\r")break;a=/\s/.test(h)?h.concat(a):""}e=a;"if".indexOf(c)===0&&(f="if - if statement",a=[{offset:g+4,length:9}],h=g+e.length+18,b.push({proposal:("if (condition) {\n"+e+"\t\n"+e+"}").substring(c.length),description:f,positions:a,escapePosition:h}),f="if - if else statement",a=[{offset:g+4,length:9}],h=g+e.length+18,b.push({proposal:("if (condition) {\n"+
e+"\t\n"+e+"} else {\n"+e+"\t\n"+e+"}").substring(c.length),description:f,positions:a,escapePosition:h}));"for".indexOf(c)===0&&(f="for - iterate over array",a=[{offset:g+9,length:1},{offset:g+20,length:5}],h=g+e.length+42,b.push({proposal:("for (var i = 0; i < array.length; i++) {\n"+e+"\t\n"+e+"}").substring(c.length),description:f,positions:a,escapePosition:h}),f="for..in - iterate over properties of an object",a=[{offset:g+9,length:8},{offset:g+21,length:6}],h=g+2*e.length+73,b.push({proposal:("for (var property in object) {\n"+
e+"\tif (object.hasOwnProperty(property)) {\n"+e+"\t\t\n"+e+"\t}\n"+e+"}").substring(c.length),description:f,positions:a,escapePosition:h}));"while".indexOf(c)===0&&(f="while - while loop with condition",a=[{offset:g+7,length:9}],h=g+e.length+21,b.push({proposal:("while (condition) {\n"+e+"\t\n"+e+"}").substring(c.length),description:f,positions:a,escapePosition:h}));"do".indexOf(c)===0&&(f="do - do while loop with condition",a=[{offset:g+16,length:9}],h=g+e.length+6,b.push({proposal:("do {\n"+e+
"\t\n"+e+"} while (condition);").substring(c.length),description:f,positions:a,escapePosition:h}));"switch".indexOf(c)===0&&(f="switch - switch case statement",a=[{offset:g+8,length:10},{offset:g+28,length:6}],h=g+2*e.length+38,b.push({proposal:("switch (expression) {\n"+e+"\tcase value1:\n"+e+"\t\t\n"+e+"\t\tbreak;\n"+e+"\tdefault:\n"+e+"}").substring(c.length),description:f,positions:a,escapePosition:h}));"try".indexOf(c)===0&&(f="try - try..catch statement",h=g+e.length+7,b.push({proposal:("try {\n"+
e+"\t\n"+e+"} catch (err) {\n"+e+"}").substring(c.length),description:f,escapePosition:h}),f="try - try..catch statement with finally block",h=g+e.length+7,b.push({proposal:("try {\n"+e+"\t\n"+e+"} catch (err) {\n"+e+"} finally {\n"+e+"}").substring(c.length),description:f,escapePosition:h}));return b}function q(c){for(var e="break,case,catch,continue,debugger,default,delete,do,else,finally,for,function,if,in,instanceof,new,return,switch,this,throw,try,typeof,var,void,while,with".split(","),f=[],
g=0;g<e.length;g++)e[g].indexOf(c)===0&&f.push({proposal:e[g].substring(c.length),description:e[g]});return f}function p(){}var i={":":":","!":"!","@":"@","#":"#",$:"$","^":"^","&":"&","*":"*",".":".","?":"?","<":"<",">":">"};p.prototype={computeProposals:function(c,e,f){for(var f=f.prefix,g=[],b=e-f.length-1,a="";b>=0;)if(a=c[b],a==="\n"||a==="\r")break;else if(/\s/.test(a))b--;else break;if(i[a])return g;g=g.concat(s(f,c,e));return g=g.concat(q(f,c,e))}};return{JSTemplateContentAssistProvider:p}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(s,q){function p(e){return e.getProperty("objectClass").indexOf(c)!==-1&&e.getProperty("type")==="highlighter"}function i(c,e,b){this.initialize(c,e,b);this.lineStyles=[]}var c="orion.edit.highlighter",e=c+" service must be an event emitter";q.AnnotationType.registerType("orion.annotation.highlightError",{title:s.syntaxError,html:"<div class='annotationHTML error'></div>",rangeStyle:{styleClass:"annotationRange error"}});
i.prototype={initialize:function(e,g,b){this.textView=e;this.serviceRegistry=g;this.annotationModel=b;this.services=[];var a=this;this.listener={onModelChanging:function(b){a.onModelChanging(b)},onModelChanged:function(b){a.onModelChanged(b)},onDestroy:function(b){a.onDestroy(b)},onLineStyle:function(b){a.onLineStyle(b)},onStyleReady:function(b){a.onStyleReady(b)},onServiceAdded:function(b){a.onServiceAdded(b.serviceReference,a.serviceRegistry.getService(b.serviceReference))},onServiceRemoved:function(b){a.onServiceRemoved(b.serviceReference,
a.serviceRegistry.getService(b.serviceReference))}};e.addEventListener("ModelChanging",this.listener.onModelChanging);e.addEventListener("ModelChanged",this.listener.onModelChanged);e.addEventListener("Destroy",this.listener.onDestroy);e.addEventListener("LineStyle",this.listener.onLineStyle);g.addEventListener("registered",this.listener.onServiceAdded);g.addEventListener("unregistering",this.listener.onServiceRemoved);e=g.getServiceReferences(c);for(b=0;b<e.length;b++){var h=e[b];p(h)&&this.addServiceListener(g.getService(h))}},
onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null;if(this.services){for(var c=0;c<this.services.length;c++)this.removeServiceListener(this.services[c]);this.services=
null}if(this.serviceRegistry)this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null;this.lineStyles=this.listener=null},onModelChanging:function(c){this.startLine=this.textView.getModel().getLineAtOffset(c.start)},onModelChanged:function(c){var e=this.startLine;(c.addedLineCount||c.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[e,c.removedLineCount].concat(this._getEmptyStyle(c.addedLineCount)))},
onStyleReady:function(c){var e=c.lineStyles||c.style,c=Number.MAX_VALUE,b=-1,a=this.textView.getModel(),h;for(h in e)e.hasOwnProperty(h)&&(this.lineStyles[h]=e[h],c=Math.min(c,h),b=Math.max(b,h));c=Math.max(c,0);b=Math.min(b,a.getLineCount());if(e=this.annotationModel){for(var i=e.getAnnotations(a.getLineStart(c),a.getLineEnd(b)),m=[];i.hasNext();){var n=i.next();n.type==="orion.annotation.highlightError"&&m.push(n)}i=[];for(n=c;n<=b;n++){h=n;var r=this.lineStyles[h],r=r&&r.errors;h=a.getLineStart(h);
if(r)for(var p=0;p<r.length;p++){var t=r[p];i.push(q.AnnotationType.createAnnotation("orion.annotation.highlightError",t.start+h,t.end+h))}}e.replaceAnnotations(m,i)}this.textView.redrawLines(c,b+1)},onLineStyle:function(c){function e(a,b){for(var c=a.length,f=[],g=0;g<c;g++){var i=a[g];f.push({start:i.start+b,end:i.end+b,style:i.style})}return f}var b=this.lineStyles[c.lineIndex];if(b)if(b.ranges)c.ranges=e(b.ranges,c.lineStart);else if(b.style)c.style=b.style},_getEmptyStyle:function(c){for(var e=
[],b=0;b<c;b++)e.push(null);return e},setContentType:function(c){this.contentType=c;if(this.services)for(c=0;c<this.services.length;c++){var e=this.services[c];if(e.setContentType){var b=this.serviceRegistry.getService("orion.page.progress");b?b.progress(e.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):e.setContentType(this.contentType)}}},onServiceAdded:function(c,e){p(c)&&this.addServiceListener(e)},onServiceRemoved:function(c,
e){this.services.indexOf(e)!==-1&&this.removeServiceListener(e)},addServiceListener:function(c){if(typeof c.addEventListener==="function"){if(c.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(c),c.setContentType&&this.contentType){var g=this.serviceRegistry.getService("orion.page.progress");g?g.progress(c.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):c.setContentType(this.contentType)}}else typeof console!==
"undefined"&&console.log(Error(e))},removeServiceListener:function(c){typeof c.removeEventListener==="function"?(c.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),c=this.services.indexOf(c),c!==-1&&this.services.splice(c,1)):typeof console!=="undefined"&&console.log(Error(e))}};return i});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(s,q,p){function i(b){this.string=b;this.tokenStart=this.pos=0}function c(){this._modes={};this.mimeModes={};this.options={};this.StringStream=i}function e(b){var a=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&a.push(c);return a}function f(b,a,c){c=c||{};this.model=b;this.codeMirror=a;this.isWhitespaceVisible=typeof c.whitespacesVisible==="undefined"?!1:c.whitespacesVisible;
this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(b)}function g(b,a,c){this.init(b,a,c)}i.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos===0},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},eat:function(b){var a=this.string[this.pos];return typeof a==="string"&&(a===b||b.test&&b.test(a)||typeof b==="function"&&
b(a))?this.string[this.pos++]:void 0},eatWhile:function(b){for(var a=!1;this.eat(b)!==void 0;)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){b=this.string.indexOf(b,this.pos);return b!==-1?(this.pos=b,!0):!1},match:function(b,a,c){a=a===!0||typeof a==="undefined";if(typeof b==="string"){var e=c?this.string.toLowerCase():this.string,b=c?b.toLowerCase():b,c=e.indexOf(b,this.pos);if(c!==-1&&a)this.pos=c+b.length;return c!==
-1}else return(b=this.string.substring(this.pos).match(b))&&a&&typeof b[0]==="string"&&(this.pos+=b.index+b[0].length),b},backUp:function(b){this.pos-=b},column:function(){for(var b=0,a=0;a<this.tokenStart;)b+=this.string[a++]==="\t"?4:1;return b},indentation:function(){for(var b=this.string.search(/\S/),a=0,c=0;c<b;)a+=this.string[c++]==="\t"?4:1;return a},current:function(){return this.string.substring(this.tokenStart,this.pos)},advance:function(){this.tokenStart=this.pos}};c.prototype={options:{},
setOption:function(b,a){this.options[b]=a},getOption:function(b){return this.options[b]},copyState:function(b,a){if(typeof b.copyState==="function")return b.copyState(a);var c={},e;for(e in a){var f=a[e];c[e]=f instanceof Array?f.slice():f}return c},defineMode:function(b,a){this._modes[b]=a},defineMIME:function(b,a){this.mimeModes[b]=a},getMode:function(b,a){var c={},e;typeof a==="string"&&this.mimeModes[a]&&(a=this.mimeModes[a]);typeof a==="object"&&(c=a,e=this._modes[a.name]);e=e||this._modes[a];
if(typeof e!=="function")throw"Mode not found "+a;return e(b,c)},listModes:function(){return e(this._modes)},listMIMEs:function(){return e(this.mimeModes)},_getModeName:function(b){b=this.mimeModes[b];if(typeof b==="object")b=b.name;return b}};f.prototype={initialize:function(){var b=this;this.listener={onModelChanging:function(a){b._onModelChanging(a)},onModelChanged:function(a){b._onModelChanged(a)},onDestroy:function(a){b._onDestroy(a)}};this.model.addEventListener("Changing",this.listener.onModelChanging);
this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(b){this.startLine=
this.model.getLineAtOffset(b.start)},_onModelChanged:function(b){this._dbgEvent(b);var a=this.startLine;(b.removedLineCount||b.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,b.removedLineCount].concat(this._newLines(b.addedLineCount)));this.mode&&(b=Math.max(b.addedLineCount,b.removedLineCount),b=a+Math.min(b,500),this.highlight(a,b),this.highlightLater(b+1))},_onDestroy:function(){this.destroy()},setViewportIndex:function(b){this.viewportIndex=b},_dbgEvent:function(){},_dbgStyle:function(){},
_newLines:function(b){for(var a=[],c=0;c<b;c++)a.push({style:null,eolState:null});return a},setMode:function(b,a){if(b)this.mode=this.codeMirror.getMode(this.codeMirror.options,b),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight()},highlight:function(b,a,c){if(this.mode){for(var e=this.model.getLineCount(),b=typeof b==="undefined"?0:b,a=typeof a==="undefined"?e-1:Math.min(a,e-1),e=this.mode,f=this.getState(b),g=b;g<=a;g++){var i=this.lines[g];this.highlightLine(g,i,f);i.eolState=
this.codeMirror.copyState(e,f)}this._expandRange(b,a);if(!c)this.onHighlightDone()}},highlightLater:function(b){this.dirtyLines.push(b);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var b=+new Date+30,a=this.mode.compareStates,c=this.model.getLineCount();this.dirtyLines.length;){var e=this.viewportIndex,f=this.lines[e],e=f&&!f.eolState?e:this.dirtyLines.pop();if(e>=c)break;this._expandRange(e,e);for(var f=this._getResumeLineIndex(e),e=f+1,f=(f=f>=
0&&this.lines[f].eolState)?this.codeMirror.copyState(this.mode,f):this.mode.startState(),g=0,i=e;i<c;i++){var p=this.lines[i],q=p.eolState,d=this.highlightLine(i,p,f);p.eolState=this.codeMirror.copyState(this.mode,f);d&&this._expandRange(e,i+1);var p=a&&q&&a(q,p.eolState),k=!a&&!d&&g++>3;if(p||k)break;else if(!q||d)g=0;q=i<c||this.dirtyLines.length;if(+new Date>b&&q){this.highlightLater(i+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&
this.endLine!==-1&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(b){for(var a=this.lines,c=b-1;c>=0;c--)if(a[c].eolState||b-c>40)return c;return-1},getState:function(b){var a=this.mode,c=this.lines,e,f;for(e=b-1;e>=0;e--)if(f=c[e],f.eolState||b-e>40)break;var g=e>=0&&c[e].eolState;if(g){g=this.codeMirror.copyState(a,g);for(e=Math.max(0,e);e<b-1;e++)f=c[e],this.highlightLine(e,f,g),f.eolState=
this.codeMirror.copyState(a,g);return g}else return a.startState()},highlightLine:function(b,a,c){if(this.mode){var e=this.model;e.getLineStart(b)===e.getLineEnd(b)&&this.mode.blankLine&&this.mode.blankLine(c);for(var f=a.style||[],b=e.getLine(b),b=new i(b),e=!a.style,g=[],r=0;!b.eol();r++){var p=this.mode.token(b,c)||null,q=b.current();this._whitespaceStyle(p,q,b.tokenStart);p=[b.tokenStart,b.pos,p];q=f[r];g.push(p);e=e||!q||q[0]!==p[0]||q[1]!==p[1]||q[2]!==p[2];b.advance()}if(e=e||g.length!==f.length)a.style=
g.length?g:null;return e}},_whitespaceStyle:function(b,a,c){if(!b&&this.isWhitespaceVisible&&/\s+/.test(a)){for(var b=[],e,f,g=0;g<a.length;g++){var i=a[g];i!==f&&(f&&b.push([c+e,c+g,f==="\t"?"token_tab":"token_space"]),e=g,f=i)}b.push([c+e,c+g,f==="\t"?"token_tab":"token_space"]);return b}return null},_expandRange:function(b,a){this.startLine=Math.min(this.startLine,b);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(b,a){var c=b.style;if(!c)return null;for(var e=[],f=[],g=
typeof a==="undefined"?0:this.model.getLineStart(a),i=0;i<c.length;i++){var p=c[i],q=!p[2]?null:p[2]==="token_tab"||p[2]==="token_space"?p[2]:"cm-"+p[2];q&&(p={start:g+p[0],end:g+p[1],style:{styleClass:q}},e.push(p),q==="cm-error"&&f.push(p))}return[e,f]},getLineStyle:function(b){return this.lines[b]},getLineStyles:function(){return this.lines}};q.EventTarget.addMixin(f.prototype);p.AnnotationType.registerType("orion.annotation.highlightError",{title:s.syntaxError,html:"<div class='annotationHTML error'></div>",
rangeStyle:{styleClass:"annotationRange error"}});g.prototype={init:function(b,a,c){this.textView=b;this.annotationModel=c;this.modeApplier=new f(b.getModel(),a);var e=this;this.listener={onLineStyle:function(a){e.onLineStyle(a)},onDestroy:function(a){e.onDestroy(a)},onHighlight:function(a){e.onHighlight(a)}};b.addEventListener("LineStyle",this.listener.onLineStyle);b.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&
(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(b){this.modeApplier.setMode(b)},onLineStyle:function(b){var a=b.lineIndex,c=this.modeApplier,e=c.getLineStyle(a);if(!e||!e.eolState){var f=this.textView.getModel().getLineCount();
c.highlight(a,Math.min(a+20,f-1),!0);e=c.getLineStyle(a)}f=this.textView.getModel();if(e){var g=c.toStyleRangesAndErrors(e,a);if(g&&(b.ranges=g[0],b=this.annotationModel)){c=[];e=[];if(g=g[1])for(var i=0;i<g.length;i++){var q=g[i];q.style.styleClass==="cm-error"&&e.push(p.AnnotationType.createAnnotation("orion.annotation.highlightError",q.start,q.end))}for(a=b.getAnnotations(f.getLineStart(a),f.getLineEnd(a));a.hasNext();)f=a.next(),f.type==="orion.annotation.highlightError"&&c.push(f);b.replaceAnnotations(c,
e)}}},onHighlight:function(b){this.textView.redrawLines(b.start,b.end)},onDestroy:function(){this.destroy()}};return{Mirror:c,ModeApplier:f,CodeMirrorStyler:g}});
define("orion/editor/textMateStyler",["orion/editor/regex"],function(s){function q(c){var e;if(c instanceof Array){e=Array(c.length);for(var f=0;f<c.length;f++)e[f]=q(c[f])}else for(f in e={},c)if(Object.prototype.hasOwnProperty.call(c,f)){var g=c[f];e[f]=typeof g==="object"&&g!==null?q(g):g}return e}function p(c,e,f){this.initialize(c);this.grammar=q(e);this.externalGrammars=f?q(f):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var i={unsupported:[{regex:/\(\?[ims\-]:/,
func:function(){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(c){return c[1]==="="?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(){return"atomic group"}}],toRegExp:function(c){function e(a,b){throw Error('Unsupported regex feature "'+a+'": "'+b[0]+'" at index: '+b.index+" in "+b.input);}var f="",g,c=i.processGlobalFlag("x",c,function(a){for(var b="",c=!1,e=a.length,f=0;f<e;){var g=a.charAt(f);if(!c&&g==="#")for(;f<e&&g!=="\r"&&g!=="\n";)g=a.charAt(++f);
else if(!c&&/\s/.test(g))for(;f<e&&/\s/.test(g);)g=a.charAt(++f);else g==="\\"?(b+=g,/\s/.test(a.charAt(f+1))||(b+=a.charAt(f+1),f+=1)):(g==="["?c=!0:g==="]"&&(c=!1),b+=g),f+=1}return b}),c=i.processGlobalFlag("i",c,function(a){f+="i";return a});for(g=0;g<this.unsupported.length;g++){var b;(b=this.unsupported[g].regex.exec(c))&&e(this.unsupported[g].func(b),b)}return RegExp(c,f)},processGlobalFlag:function(c,e,f){function g(a,b){for(var c=0,e=a.length,f=-1,g=b;g<e&&f===-1;g++)switch(a.charAt(g)){case "\\":g++;
break;case "(":c++;break;case ")":c--,c===0&&(f=g)}return f}var b="(?"+c+")",c="(?"+c+":";if(e.substring(0,b.length)===b)return f(e.substring(b.length));else if(e.substring(0,c.length)===c){b=g(e,0);if(b<e.length-1)throw Error("Only a "+c+") group that encloses the entire regex is supported in: "+e);return f(e.substring(c.length,b))}return e},hasBackReference:function(c){return/\\\d+/.test(c.source)},getSubstitutedRegex:function(c,e,f){for(var f=typeof f==="undefined"?!0:!1,c=c.source.split(/(\\\d+)/g),
g=[],b=0;b<c.length;b++){var a=c[b],h=/\\(\d+)/.exec(a);h?(a=e[h[1]]||"",g.push(f?s.escape(a):a)):g.push(a)}return RegExp(g.join(""))},groupify:function(c,e){for(var f=c.source,g=f.length,b=[],a=0,h=[],i=1,m=1,n=[],p={},q={},t=0;t<g;t++){var d=b[b.length-1],k=f.charAt(t);switch(k){case "(":if(d===4)b.pop(),n.push(")"),h[h.length-1].end=t;var j=t+2<g?f.charAt(t+1)+""+f.charAt(t+2):null;if(j==="?:"||j==="?="||j==="?!"){var s;j==="?:"?s=1:(s=3,a++);b.push(s);h.push({start:t,end:-1,type:s});n.push(k);
n.push(j);t+=j.length}else b.push(2),h.push({start:t,end:-1,type:2,oldNum:i,num:m}),n.push(k),a===0&&(q[m]=null),p[i]=m,i++,m++;break;case ")":d=b.pop();d===3&&a--;h[h.length-1].end=t;n.push(k);break;case "*":case "+":case "?":case "}":var l=k,y=f.charAt(t-1),j=t-1;if(k==="}"){for(s=t-1;f.charAt(s)!=="{"&&s>=0;s--);y=f.charAt(s-1);j=s-1;l=f.substring(s,t+1)}s=h[h.length-1];if(y===")"&&(s.type===2||s.type===4)){n.splice(s.start,0,"(");n.push(l);n.push(")");k={start:s.start,end:n.length-1,type:4,num:s.num};
for(y=0;y<h.length;y++)if(d=h[y],(d.type===2||d.type===4)&&d.start>=s.start&&d.end<=j)if(d.start+=1,d.end+=1,d.num+=1,d.type===2)p[d.oldNum]=d.num;h.push(k);m++;break}default:k!=="|"&&d!==2&&d!==4&&a===0&&(b.push(4),h.push({start:t,end:-1,type:4,num:m}),n.push("("),q[m]=null,m++),n.push(k),k==="\\"&&(k=f.charAt(t+1),n.push(k),t+=1)}}for(;b.length;)b.pop(),n.push(")");var f=RegExp(n.join("")),g={},e=e||p,B;for(B in e)e.hasOwnProperty(B)&&(g[B]="\\"+e[B]);f=this.getSubstitutedRegex(f,g,!1);return[f,
p,q]},complexCaptures:function(c){if(!c)return!1;for(var e in c)if(c.hasOwnProperty(e)&&e!=="0")return!0;return!1}};p.prototype={initialize:function(c){this.textView=c;this.textView.stylerOptions=this;var e=this;this._listener={onModelChanged:function(c){e.onModelChanged(c)},onDestroy:function(c){e.onDestroy(c)},onLineStyle:function(c){e.onLineStyle(c)},onStorage:function(c){e.onStorage(c)}};c.addEventListener("ModelChanged",this._listener.onModelChanged);c.addEventListener("Destroy",this._listener.onDestroy);
c.addEventListener("LineStyle",this._listener.onLineStyle);c.redrawLines()},onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null;this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(c){for(c=[c];c.length!==0;){var e=
c.pop();if(!e._resolvedRule||!e._typedRule)if(e._resolvedRule=this._resolve(e),e._typedRule=this._createTypedRule(e),this.addStyles(e.name),this.addStyles(e.contentName),this.addStylesForCaptures(e.captures),this.addStylesForCaptures(e.beginCaptures),this.addStylesForCaptures(e.endCaptures),e._resolvedRule!==e&&c.push(e._resolvedRule),e.patterns)for(var f=0;f<e.patterns.length;f++)c.push(e.patterns[f])}},addStyles:function(c){if(c&&!this._styles[c]){this._styles[c]=[];for(var e=c.split("."),f=0;f<
e.length;f++)this._styles[c].push(e.slice(0,f+1).join("-"))}},addStylesForCaptures:function(c){for(var e in c)c.hasOwnProperty(e)&&this.addStyles(c[e].name)},ContainerRule:function(){function c(c){this.rule=c;this.subrules=c.patterns}c.prototype.valueOf=function(){return"aa"};return c}(),BeginEndRule:function(){function c(c){this.rule=c;this.beginRegex=i.toRegExp(c.begin);this.endRegex=i.toRegExp(c.end);this.subrules=c.patterns||[];this.endRegexHasBackRef=i.hasBackReference(this.endRegex);var f=i.complexCaptures(c.captures),
c=i.complexCaptures(c.beginCaptures)||i.complexCaptures(c.endCaptures);if(this.isComplex=f||c)f=i.groupify(this.beginRegex),this.beginRegex=f[0],this.beginOld2New=f[1],this.beginConsuming=f[2],f=i.groupify(this.endRegex,this.beginOld2New),this.endRegex=f[0],this.endOld2New=f[1],this.endConsuming=f[2]}c.prototype.valueOf=function(){return this.beginRegex};return c}(),MatchRule:function(){function c(c){this.rule=c;this.matchRegex=i.toRegExp(c.match);if(this.isComplex=i.complexCaptures(c.captures))c=
i.groupify(this.matchRegex),this.matchRegex=c[0],this.matchOld2New=c[1],this.matchConsuming=c[2]}c.prototype.valueOf=function(){return this.matchRegex};return c}(),_createTypedRule:function(c){return c.match?new this.MatchRule(c):c.begin?new this.BeginEndRule(c):new this.ContainerRule(c)},_resolve:function(c){var e=c;if(c.include){if(c.begin||c.end||c.match)throw Error('Unexpected regex pattern in "include" rule '+c.include);c=c.include;if(c.charAt(0)==="#"){if(e=this.grammar.repository&&this.grammar.repository[c.substring(1)],
!e)throw Error("Couldn't find included rule "+c+" in grammar repository");}else if(c==="$self")e=this.grammar;else if(c==="$base")throw Error('Include "$base" is not supported');else if(e=this._allGrammars[c],!e)for(var f=0;f<this.externalGrammars.length;f++){var g=this.externalGrammars[f];if(g.scopeName===c){this.preprocess(g);e=this._allGrammars[c]=g;break}}}return e},ContainerNode:function(){function c(c,f){this.parent=c;this.rule=f;this.children=[];this.end=this.start=null}c.prototype.addChild=
function(c){this.children.push(c)};c.prototype.valueOf=function(){var c=this.rule;return"ContainerNode { "+(c.include||"")+" "+(c.name||"")+(c.comment||"")+"}"};return c}(),BeginEndNode:function(){function c(c,f,g){this.parent=c;this.rule=f;this.children=[];this.setStart(g);this.endMatch=this.end=null;this.endRegexSubstituted=f.endRegexHasBackRef?i.getSubstitutedRegex(f.endRegex,g):null}c.prototype.addChild=function(c){this.children.push(c)};c.prototype.getIndexInParent=function(){return this.parent?
this.parent.children.indexOf(this):-1};c.prototype.setStart=function(c){this.start=c.index;this.beginMatch=c};c.prototype.setEnd=function(c){c&&typeof c==="object"?(this.endMatch=c,this.end=c.index+c[0].length):(this.endMatch=null,this.end=c)};c.prototype.shiftStart=function(c){this.start+=c;this.beginMatch.index+=c};c.prototype.shiftEnd=function(c){this.end+=c;this.endMatch&&(this.endMatch.index+=c)};c.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+this.start+".."+this.end+
"}"};return c}(),push:function(c,e){if(e)for(var f=e.length;f>0;)c.push(e[--f])},exec:function(c,e,f){(e=c.exec(e))&&(e.index+=f);c.lastIndex=0;return e},afterMatch:function(c){return c.index+c[0].length},getEndMatch:function(c,e,f){if(c instanceof this.BeginEndNode){var g=c.rule,c=c.endRegexSubstituted||g.endRegex;return!c?null:this.exec(c,e,f)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,
!1,0)},onModelChanged:function(c){var e=c.addedCharCount,f=c.removedCharCount,c=c.start;if(this._tree){var g=this.textView.getModel(),b=g.getCharCount(),g=g.getLineEnd(g.getLineAtOffset(c)-1),a=this.getFirstDamaged(g,g),g=g===-1?0:g,e=a?this.parse(a,!0,g,c,e,f):b;this.textView.redrawRange(g,e)}else this.initialParse()},getFirstDamaged:function(c,e){if(c<0)return this._tree;for(var f=[this._tree],g=null;f.length;){var b=f.pop();if(!b.parent||this.isDamaged(b,c,e)){b instanceof this.BeginEndNode&&(g=
b);for(var a=0;a<b.children.length;a++)f.push(b.children[a])}}return g||this._tree},isDamaged:function(c,e,f){return c.start<=f&&c.end>e},parse:function(c,e,f,g,b,a){var h=this.textView.getModel(),i=h.getLineStart(h.getLineCount()-1),m=h.getCharCount(),n=this.getInitialExpected(c,f),p=-1;if(e)c.repaired=!0,c.endNeedsUpdate=!0,p=(p=c.children[c.children.length-1])?h.getLineEnd(h.getLineAtOffset(p.end+(b-a))):-1,g=h.getLineEnd(h.getLineAtOffset(g+a)),p=Math.max(p,g);for(var p=p===-1?m:p,g=n,q=c,s=!1,
d=f,k=-1;q&&(!e||d<p);){var j=this.getNextMatch(h,q,d);j||(d=d>=i?m:h.getLineStart(h.getLineAtOffset(d)+1));var v=j&&j.match,l=j&&j.rule,y=j&&j.isEnd;if(j&&j.isSub){if(d=this.afterMatch(v),l instanceof this.BeginEndRule)s=!0,e&&l===g.rule&&q===g.parent?(q=g,q.setStart(v),q.repaired=!0,q.endNeedsUpdate=!0,g=this.getNextExpected(g,"begin")):(e&&(this.prune(q,g),e=!1),v=new this.BeginEndNode(q,l,v),q.addChild(v),q=v)}else if(y||d===m){if(q instanceof this.BeginEndNode)v?(s=!0,k=Math.max(k,q.end),q.setEnd(v),
d=this.afterMatch(v),e&&q===g&&q.parent===g.parent?(q.repaired=!0,delete q.endNeedsUpdate,g=this.getNextExpected(g,"end")):e&&(this.prune(q,g),e=!1)):(q.setEnd(m),delete q.endNeedsUpdate);q=q.parent}e&&d>=p&&!s&&(this.prune(c,n),e=!1)}this.removeUnrepairedChildren(c,e,f);this.cleanup(e,c,f,p,m,b,a);return e?Math.max(k,d):d},removeUnrepairedChildren:function(c,e,f){if(e){for(var e=c.children,g=-1,b=0;b<e.length;b++){var a=e[b];if(!a.repaired&&this.isDamaged(a,f,Number.MAX_VALUE)){g=b;break}}if(g!==
-1)c.children.length=g}},cleanup:function(c,e,f,g,b,a,h){if(c){c=a-h;b=this.getIntersecting(g-c+1,b);e=this.getIntersecting(f,g);for(f=0;f<b.length;f++)g=b[f],!g.repaired&&g instanceof this.BeginEndNode&&(g.shiftEnd(c),g.shiftStart(c));for(f=0;f<e.length;f++)g=e[f],g.repaired&&g.endNeedsUpdate&&g.shiftEnd(c),delete g.endNeedsUpdate,delete g.repaired}else{e=this.getIntersecting(f,g);for(f=0;f<e.length;f++)delete e[f].repaired}},getNextMatch:function(c,e,f,g){var b=c.getLineAtOffset(f),b=c.getLineEnd(b),
a=c.getText(f,b),h=[],i=[],c=[],b=[];for(this.push(h,e.rule.subrules);h.length;){var m=h.length?h.pop():null,m=m&&m._resolvedRule._typedRule;if(m instanceof this.ContainerRule&&i.indexOf(m)===-1)i.push(m),this.push(h,m.subrules);else if(!m||!g||m.matchRegex){var n=m&&this.exec(m.matchRegex||m.beginRegex,a,f);n&&(c.push(n),b.push(m))}}h=Number.MAX_VALUE;i=-1;for(m=0;m<c.length;m++)if(n=c[m],n.index<h)h=n.index,i=m;if(!g&&(f=this.getEndMatch(e,a,f)))if(g=e.rule.applyEndPatternLast,i===-1||f.index<h||
!g&&f.index===h)return{isEnd:!0,rule:e.rule,match:f};return i===-1?null:{isSub:!0,rule:b[i],match:c[i]}},getInitialExpected:function(c,e){var f,g;if(c===this._tree)for(f=0;f<c.children.length;f++){if(g=c.children[f],g.start>=e)return g}else if(c instanceof this.BeginEndNode&&c.endMatch){var b=c.endMatch.index;for(f=0;f<c.children.length;f++)if(g=c.children[f],g.start>=e)break;if(g&&g.start<b)return g}return c},getNextExpected:function(c,e){if(e==="begin"){var f=c.children[0];return f?f:c}else if(e===
"end"&&(f=c.parent)){var g=f.children[f.children.indexOf(c)+1];return g?g:f}return null},prune:function(c,e){if(e.parent===c)c.children.length=e.getIndexInParent();else if(c instanceof this.BeginEndNode)c.endMatch=null,c.end=null;if(c.parent)c.parent.children.length=c.getIndexInParent()+1},onLineStyle:function(c){this._tree||this.initialParse();var e=c.lineStart,f=this.textView.getModel(),g=f.getLineEnd(c.lineIndex),b=f.getLineEnd(f.getLineAtOffset(e)-1),b=this.getFirstDamaged(b,b),e=this.getLineScope(f,
b,e,g);c.ranges=this.toStyleRanges(e);c.ranges.sort(function(a,b){return a.start-b.start})},getLineScope:function(c,e,f,g){for(var b=f,a=this.getInitialExpected(e,f),h=[],i=[];e&&b<g;){var m=this.getNextMatch(c,e,b);if(!m)break;var n=m&&m.match,p=m&&m.rule,q=m&&m.isSub,m=m&&m.isEnd;n.index!==b&&i.push({start:b,end:n.index,node:e});if(q)b=this.afterMatch(n),p instanceof this.BeginEndRule?(this.addBeginScope(h,n,p),e=a,a=this.getNextExpected(a,"begin")):this.addMatchScope(h,n,p);else if(m)b=this.afterMatch(n),
this.addEndScope(h,n,p),a=this.getNextExpected(a,"end"),e=e.parent}b<g&&i.push({start:b,end:g,node:e});c=this.getInheritedLineScope(i,f,g);return h.concat(c)},getInheritedLineScope:function(c){for(var e=[],f=0;f<c.length;f++)for(var g=c[f],b=g.node;b;){var a=b.rule.rule,h=a.name;if(a=a.contentName||h){this.addScopeRange(e,g.start,g.end,a);break}b=b.parent}return e},addBeginScope:function(c,e,f){var g=f.rule;this.addCapturesScope(c,e,g.beginCaptures||g.captures,f.isComplex,f.beginOld2New,f.beginConsuming)},
addEndScope:function(c,e,f){var g=f.rule;this.addCapturesScope(c,e,g.endCaptures||g.captures,f.isComplex,f.endOld2New,f.endConsuming)},addMatchScope:function(c,e,f){var g=f.rule,b=g.name;(g=g.captures)?this.addCapturesScope(c,e,g,f.isComplex,f.matchOld2New,f.matchConsuming):this.addScope(c,e,b)},addScope:function(c,e,f){f&&c.push({start:e.index,end:this.afterMatch(e),scope:f})},addScopeRange:function(c,e,f,g){g&&c.push({start:e,end:f,scope:g})},addCapturesScope:function(c,e,f,g,b,a){if(f)if(g){for(var g=
{1:0},h=0,i=1;e[i]!==void 0;i++)a[i]!==void 0&&(h+=e[i].length),e[i+1]!==void 0&&(g[i+1]=h);a=e.index;for(h=1;f[h];h++){var i=f[h].name,m=b[h],n=a+g[m];typeof e[m]!=="undefined"&&this.addScopeRange(c,n,n+e[m].length,i)}}else this.addScope(c,e,f[0]&&f[0].name)},getIntersecting:function(c,e){for(var f=[],g=this._tree?[this._tree]:[];g.length;){var b=g.pop(),a=!1;b instanceof this.ContainerNode?a=!0:this.isDamaged(b,c,e)&&(a=!0,f.push(b));if(a)for(var a=b.children.length,h=0;h<a;h++)g.push(b.children[h])}return f.reverse()},
toStyleRanges:function(c){for(var e=[],f=0;f<c.length;f++){var g=c[f],b=this._styles[g.scope];if(!b)throw Error("styles not found for "+g.scope);b=b.join(" ");e.push({start:g.start,end:g.end,style:{styleClass:b}})}return e}};return{RegexUtil:i,TextMateStyler:p}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"<!(doctype|DOCTYPE)",end:">",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"<\!--",end:"--\>",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"<[A-Za-z0-9_\\-:]+(?= ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"</[A-Za-z0-9_\\-:]+>",name:"entity.name.tag.html"},{match:">",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?=\\s*=\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"&[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("examples/editor/textStyler",["orion/editor/annotations"],function(s){function q(a,b){this.keywords=a;this.whitespacesVisible=b;this.setText("")}function p(){q.call(this,null,!0)}function i(a){q.call(this,null,a)}function c(){q.call(this,null,!1)}function e(a,d,e){this.commentStart="/*";this.commentEnd="*/";var h=[];switch(d){case "java":h=g;break;case "js":h=f;break;case "css":h=b}this.whitespacesVisible=!1;this.detectHyperlinks=!0;this.highlightCaretLine=!1;this.detectTasks=this.foldingEnabled=
!0;this._scanner=new q(h,this.whitespacesVisible);this._firstScanner=new c;this._commentScanner=new i(this.whitespacesVisible);this._whitespaceScanner=new p;if(d==="css")this._scanner.isCSS=!0,this._firstScanner.isCSS=!0;this.view=a;this.annotationModel=e;this._bracketAnnotations=void 0;var j=this;this._listener={onChanged:function(a){j._onModelChanged(a)},onDestroy:function(a){j._onDestroy(a)},onLineStyle:function(a){j._onLineStyle(a)},onMouseDown:function(a){j._onMouseDown(a)},onSelection:function(a){j._onSelection(a)}};
d=a.getModel();d.getBaseModel&&(d=d.getBaseModel());d.addEventListener("Changed",this._listener.onChanged);a.addEventListener("MouseDown",this._listener.onMouseDown);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("LineStyle",this._listener.onLineStyle);this._computeComments();this._computeFolding();a.redrawLines()}var f="break,case,class,catch,continue,const,debugger,default,delete,do,else,enum,export,extends,false,finally,for,function,if,implements,import,in,instanceof,interface,let,new,null,package,private,protected,public,return,static,super,switch,this,throw,true,try,typeof,undefined,var,void,while,with,yield".split(","),
g="abstract,boolean,break,byte,case,catch,char,class,continue,default,do,double,else,extends,false,final,finally,float,for,if,implements,import,instanceof,int,interface,long,native,new,null,package,private,protected,public,return,short,static,super,switch,synchronized,this,throw,throws,transient,true,try,void,volatile,while".split(","),b="alignment-adjust,alignment-baseline,animation,animation-delay,animation-direction,animation-duration,animation-iteration-count,animation-name,animation-play-state,animation-timing-function,appearance,azimuth,backface-visibility,background,background-attachment,background-clip,background-color,background-image,background-origin,background-position,background-repeat,background-size,baseline-shift,binding,bleed,bookmark-label,bookmark-level,bookmark-state,bookmark-target,border,border-bottom,border-bottom-color,border-bottom-left-radius,border-bottom-right-radius,border-bottom-style,border-bottom-width,border-collapse,border-color,border-image,border-image-outset,border-image-repeat,border-image-slice,border-image-source,border-image-width,border-left,border-left-color,border-left-style,border-left-width,border-radius,border-right,border-right-color,border-right-style,border-right-width,border-spacing,border-style,border-top,border-top-color,border-top-left-radius,border-top-right-radius,border-top-style,border-top-width,border-width,bottom,box-align,box-decoration-break,box-direction,box-flex,box-flex-group,box-lines,box-ordinal-group,box-orient,box-pack,box-shadow,box-sizing,break-after,break-before,break-inside,caption-side,clear,clip,color,color-profile,column-count,column-fill,column-gap,column-rule,column-rule-color,column-rule-style,column-rule-width,column-span,column-width,columns,content,counter-increment,counter-reset,crop,cue,cue-after,cue-before,cursor,direction,display,dominant-baseline,drop-initial-after-adjust,drop-initial-after-align,drop-initial-before-adjust,drop-initial-before-align,drop-initial-size,drop-initial-value,elevation,empty-cells,fit,fit-position,flex-align,flex-flow,flex-inline-pack,flex-order,flex-pack,float,float-offset,font,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,grid-columns,grid-rows,hanging-punctuation,height,hyphenate-after,hyphenate-before,hyphenate-character,hyphenate-lines,hyphenate-resource,hyphens,icon,image-orientation,image-rendering,image-resolution,inline-box-align,left,letter-spacing,line-height,line-stacking,line-stacking-ruby,line-stacking-shift,line-stacking-strategy,list-style,list-style-image,list-style-position,list-style-type,margin,margin-bottom,margin-left,margin-right,margin-top,mark,mark-after,mark-before,marker-offset,marks,marquee-direction,marquee-loop,marquee-play-count,marquee-speed,marquee-style,max-height,max-width,min-height,min-width,move-to,nav-down,nav-index,nav-left,nav-right,nav-up,opacity,orphans,outline,outline-color,outline-offset,outline-style,outline-width,overflow,overflow-style,overflow-x,overflow-y,padding,padding-bottom,padding-left,padding-right,padding-top,page,page-break-after,page-break-before,page-break-inside,page-policy,pause,pause-after,pause-before,perspective,perspective-origin,phonemes,pitch,pitch-range,play-during,position,presentation-level,punctuation-trim,quotes,rendering-intent,resize,rest,rest-after,rest-before,richness,right,rotation,rotation-point,ruby-align,ruby-overhang,ruby-position,ruby-span,size,speak,speak-header,speak-numeral,speak-punctuation,speech-rate,stress,string-set,table-layout,target,target-name,target-new,target-position,text-align,text-align-last,text-decoration,text-emphasis,text-height,text-indent,text-justify,text-outline,text-shadow,text-transform,text-wrap,top,transform,transform-origin,transform-style,transition,transition-delay,transition-duration,transition-property,transition-timing-function,unicode-bidi,vertical-align,visibility,voice-balance,voice-duration,voice-family,voice-pitch,voice-pitch-range,voice-rate,voice-stress,voice-volume,volume,white-space,white-space-collapse,widows,width,word-break,word-spacing,word-wrap,z-index".split(","),
a={styleClass:"comment"},h={styleClass:"token_multiline_comment"},o={styleClass:"token_doc_comment"},m={styleClass:"token_doc_html_markup"},n={styleClass:"token_task_tag"},r={styleClass:"token_doc_tag"},u={styleClass:"token_string"},t={styleClass:"token_number"},d={styleClass:"token_keyword"},k={styleClass:"token_space"},j={styleClass:"token_tab"},v={styleClass:"line_caret"};q.prototype={getOffset:function(){return this.offset},getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,
this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(a){switch(a){case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===9);this._unread(a);return 9;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return a;default:var b=this.isCSS,c=this.offset-1;if(!b&&48<=a&&a<=57){var d=b=!1,e=!1,f=a;do if(a=this._read(),a===46&&!b)b=!0;else if(a===101&&!d)b=d=!0,a=this._read(),a!==45&&this._unread(a);else if(a===
120&&f===48&&this.offset-c===2)b=d=e=!0;else if(!(48<=a&&a<=57||e&&(65<=a&&a<=70||97<=a&&a<=102)))break;while(1);this._unread(a);return 3}if(97<=a&&a<=122||65<=a&&a<=90||a===95||45===a&&b){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57||45===a&&b);this._unread(a);a=this.keywords;if(a.length>0){c=this.text.substring(c,this.offset);for(b=0;b<a.length;b++)if(this.keywords[b]===c)return 2}}return 1}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):
-1},_unread:function(a){a!==-1&&this.offset--},nextToken:function(){for(this.startOffset=this.offset;;){var a=this._read(),b;switch(a){case -1:return null;case 47:a=this._read();if(!this.isCSS&&a===47)for(;;)if(a=this._read(),a===-1||a===10||a===13)return this._unread(a),6;if(a===42){a=this._read();b=7;for(a===42&&(b=8);;){for(;a===42;)if(a=this._read(),a===47)return b;if(a===-1)return this._unread(a),b;a=this._read()}}this._unread(a);return 1;case 39:for(b=4;;)switch(a=this._read(),a){case 39:return b;
case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;case 34:for(b=4;;)switch(a=this._read(),a){case 34:return b;case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;default:return this._default(a)}}},setText:function(a){this.text=a;this.startOffset=this.offset=0}};p.prototype=new q(null);p.prototype.nextToken=
function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:return 11;case 9:return 10;default:do a=this._read();while(!(a===32||a===9||a===-1));this._unread(a);return 1}}};i.prototype=new q(null);i.prototype.setType=function(a){this._type=a};i.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===
9);this._unread(a);return 9;case 60:if(this._type===8){do a=this._read();while(!(a===62||a===-1));if(a===62)return 12}return 1;case 64:if(this._type===8){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57);this._unread(a);return 13}return 1;case 84:if((a=this._read())===79)if((a=this._read())===68)if((a=this._read())===79)if(a=this._read(),!(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57))return this._unread(a),14;this._unread(a);default:do a=this._read();while(!(a===32||
a===9||a===-1||a===60||a===64||a===84));this._unread(a);return 1}}};c.prototype=new q(null);c.prototype._default=function(a){for(;;)switch(a=this._read(),a){case 47:case 34:case 39:case -1:return this._unread(a),1}};e.prototype={destroy:function(){var a=this.view;if(a){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);a.removeEventListener("MouseDown",this._listener.onMouseDown);a.removeEventListener("Selection",this._listener.onSelection);
a.removeEventListener("Destroy",this._listener.onDestroy);a.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},setHighlightCaretLine:function(a){this.highlightCaretLine=a},setWhitespacesVisible:function(a){this.whitespacesVisible=a;this._scanner.whitespacesVisible=a;this._commentScanner.whitespacesVisible=a},setDetectHyperlinks:function(a){this.detectHyperlinks=a},setFoldingEnabled:function(a){this.foldingEnabled=a},setDetectTasks:function(a){this.detectTasks=a},_binarySearch:function(a,
b,c,d,e){var f;d===void 0&&(d=-1);if(e===void 0)e=a.length;for(;e-d>1;)if(f=Math.floor((e+d)/2),b<=a[f].start)e=f;else if(c&&b<a[f].end){e=f;break}else d=f;return e},_computeComments:function(){var a=this.view.getModel();a.getBaseModel&&(a=a.getBaseModel());this.comments=this._findComments(a.getText())},_computeFolding:function(){if(this.foldingEnabled){var a=this.view.getModel();if(a.getBaseModel){var b=this.annotationModel;if(b){b.removeAnnotations(s.AnnotationType.ANNOTATION_FOLDING);for(var c=
[],d=a.getBaseModel(),e=this.comments,f=0;f<e.length;f++){var g=e[f];(g=this._createFoldingAnnotation(a,d,g.start,g.end))&&c.push(g)}b.replaceAnnotations(null,c)}}}},_createFoldingAnnotation:function(a,b,c,d){var e=b.getLineAtOffset(c),b=b.getLineAtOffset(d);return e===b?null:new (s.AnnotationType.getType(s.AnnotationType.ANNOTATION_FOLDING))(c,d,a)},_computeTasks:function(a,b,c){if(this.detectTasks){var d=this.annotationModel;if(d){var e=this.view.getModel(),f=e;e.getBaseModel&&(f=e.getBaseModel());
for(var g=d.getAnnotations(b,c),e=[],h=s.AnnotationType.ANNOTATION_TASK;g.hasNext();){var i=g.next();i.type===h&&e.push(i)}g=[];i=this._commentScanner;i.setText(f.getText(b,c));for(var j;j=i.nextToken();){var k=i.getStartOffset()+b;j===14&&(j=f.getLineEnd(f.getLineAtOffset(k)),a!==6&&(j=Math.min(j,c-this.commentEnd.length)),g.push(s.AnnotationType.createAnnotation(h,k,j,f.getText(k,j))))}d.replaceAnnotations(e,g)}}},_getLineStyle:function(a){if(this.highlightCaretLine){var b=this.view,c=b.getModel(),
b=b.getSelection();if(b.start===b.end&&c.getLineAtOffset(b.start)===a)return v}return null},_getStyles:function(a,b,c){a.getBaseModel&&(c=a.mapOffset(c));for(var d=c+b.length,e=[],f=c,g=this.comments,i=this._binarySearch(g,c,!0);i<g.length;i++){if(g[i].start>=d)break;var j=g[i].start,k=g[i].end;f<j&&this._parse(b.substring(f-c,j-c),f,e);var m=g[i].type,n;switch(m){case 8:n=o;break;case 7:n=h;break;case 5:n=u}f=Math.max(f,j);j=Math.min(d,k);(m===8||m===7)&&(this.whitespacesVisible||this.detectHyperlinks)?
this._parseComment(b.substring(f-c,j-c),f,e,n,m):m===5&&this.whitespacesVisible?this._parseString(b.substring(f-c,j-c),f,e,u):e.push({start:f,end:j,style:n});f=k}f<d&&this._parse(b.substring(f-c,d-c),f,e);if(a.getBaseModel)for(b=0;b<e.length;b++)c=e[b].end-e[b].start,e[b].start=a.mapOffset(e[b].start,!0),e[b].end=e[b].start+c;return e},_parse:function(b,c,e){var f=this._scanner;for(f.setText(b);b=f.nextToken();){var g=f.getStartOffset()+c,i=null;switch(b){case 2:i=d;break;case 3:i=t;break;case 5:case 4:if(this.whitespacesVisible){this._parseString(f.getData(),
g,e,u);continue}else i=u;break;case 8:this._parseComment(f.getData(),g,e,o,b);continue;case 6:this._parseComment(f.getData(),g,e,a,b);continue;case 7:this._parseComment(f.getData(),g,e,h,b);continue;case 10:this.whitespacesVisible&&(i=j);break;case 11:this.whitespacesVisible&&(i=k)}e.push({start:g,end:f.getOffset()+c,style:i})}},_parseComment:function(a,b,c,d,e){var f=this._commentScanner;f.setText(a);for(f.setType(e);a=f.nextToken();){var e=f.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&
(g=j);break;case 11:this.whitespacesVisible&&(g=k);break;case 12:g=m;break;case 13:g=r;break;case 14:g=n;break;default:this.detectHyperlinks&&(g=this._detectHyperlinks(f.getData(),e,c,g))}g&&c.push({start:e,end:f.getOffset()+b,style:g})}},_parseString:function(a,b,c,d){var e=this._whitespaceScanner;for(e.setText(a);a=e.nextToken();){var f=e.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&(g=j);break;case 11:this.whitespacesVisible&&(g=k)}g&&c.push({start:f,end:e.getOffset()+b,style:g})}},
_detectHyperlinks:function(a,b,c,d){var e=null,f;if((f=a.indexOf("://"))>0){for(var e=a,g=f;g>0;){f=e.charCodeAt(g-1);if(!(97<=f&&f<=122||65<=f&&f<=90||45===f||48<=f&&f<=57))break;g--}if(g>0&&(f="\"\"''(){}[]<>".indexOf(e.substring(g-1,g)),f!==-1&&(f&1)===0&&(f=e.lastIndexOf("\"\"''(){}[]<>".substring(f+1,f+2)))!==-1)){var h=f;f=this._clone(d);f.tagName="A";f.attributes={href:e.substring(g,h)};c.push({start:b,end:b+g,style:d});c.push({start:b+g,end:b+h,style:f});c.push({start:b+h,end:b+a.length,style:d});
return null}}else a.toLowerCase().indexOf("bug#")===0&&(e="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(a.substring(4),10));return e?(f=this._clone(d),f.tagName="A",f.attributes={href:e},f):d},_clone:function(a){if(!a)return a;var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_findComments:function(a,b){var b=b||0,c=this._firstScanner,d;c.setText(a);for(var e=[];d=c.nextToken();)(d===7||d===8||d===5)&&e.push({start:c.getStartOffset()+b,end:c.getOffset()+b,type:d}),(d===
6||d===7||d===8)&&this._computeTasks(d,c.getStartOffset()+b,c.getOffset()+b);return e},_findMatchingBracket:function(a,b){var c="{}()[]<>",d=a.getText(b,b+1),e=c.indexOf(d,0);if(e===-1)return-1;var f;f=e&1?c.substring(e-1,e):c.substring(e+1,e+2);for(var g=a.getLineAtOffset(b),c=a.getLine(g),h=a.getLineStart(g),i=a.getLineEnd(g),c=this._findBrackets(d,f,c,h,h,i),i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,c[i]*h-1===b){var j=1;if(e&1){for(i--;i>=0;i--)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;for(g-=1;g>=
0;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(e=c.length-1;e>=0;e--)if(h=c[e]>=0?1:-1,j+=h,j===0)return c[e]*h-1;g--}}else{for(i++;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g+=1;for(e=a.getLineCount();g<e;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g++}}break}return-1},_findBrackets:function(a,b,c,d,e,f){for(var g=[],a=
a.charCodeAt(0),b=b.charCodeAt(0),h=e,i=this._scanner,j,k=this.comments,m=this._binarySearch(k,e,!0);m<k.length;m++){if(k[m].start>=f)break;j=k[m].start;var n=k[m].end;if(h<j)for(i.setText(c.substring(h-e,j-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));h=n}if(h<f)for(i.setText(c.substring(h-e,f-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));return g},_onDestroy:function(){this.destroy()},
_onLineStyle:function(a){if(a.textView===this.view)a.style=this._getLineStyle(a.lineIndex);a.ranges=this._getStyles(a.textView.getModel(),a.lineText,a.lineStart)},_onSelection:function(a){var b=a.oldValue,c=a.newValue,d=this.view,a=d.getModel(),e;if(this.highlightCaretLine){var f=a.getLineAtOffset(b.start);e=a.getLineAtOffset(c.start);var g=c.start===c.end,b=b.start===b.end;f===e&&b&&g||(b&&d.redrawLines(f,f+1),(f!==e||!b)&&g&&d.redrawLines(e,e+1))}if(this.annotationModel){var b=this._bracketAnnotations,
h,i;if(c.start===c.end&&(i=d.getCaretOffset())>0)i-=1,a.getBaseModel&&(i=a.mapOffset(i),a=a.getBaseModel()),a=this._findMatchingBracket(a,i),a!==-1&&(h=[s.AnnotationType.createAnnotation(s.AnnotationType.ANNOTATION_MATCHING_BRACKET,a,a+1),s.AnnotationType.createAnnotation(s.AnnotationType.ANNOTATION_CURRENT_BRACKET,i,i+1)]);this._bracketAnnotations=h;this.annotationModel.replaceAnnotations(b,h)}},_onMouseDown:function(a){if(a.clickCount===2){var b=this.view,c=b.getModel(),d=b.getOffsetAtLocation(a.x,
a.y);if(d>0){var e=d-1,f=c;c.getBaseModel&&(e=c.mapOffset(e),f=c.getBaseModel());e=this._findMatchingBracket(f,e);e!==-1&&(a.preventDefault(),a=e,c.getBaseModel&&(a=c.mapOffset(a,!0)),d>a&&(d--,a++),b.setSelection(a,d))}}},_onModelChanged:function(a){var b=a.start,c=a.removedCharCount,d=a.addedCharCount-c,e=this.view,a=e.getModel(),f=a.getBaseModel?a.getBaseModel():a,c=b+c,g=f.getCharCount(),h=this.comments.length,i=f.getLineStart(f.getLineAtOffset(b)),j=this._binarySearch(this.comments,i,!0),k=this._binarySearch(this.comments,
c,!1,j-1,h);j<h&&this.comments[j].start<=i&&i<this.comments[j].end?(i=this.comments[j].start,i>b&&(i+=d)):i=j===h&&h>0&&g-d===this.comments[h-1].end?this.comments[h-1].start:i;var m;k<h?(m=this.comments[k].end,m>b&&(m+=d),k+=1):(k=h,m=g);for(var n,g=this._findComments(f.getText(i,m),i),h=j;h<this.comments.length;h++)n=this.comments[h],n.start>b&&(n.start+=d),n.start>b&&(n.end+=d);var o=k-j!==g.length;if(!o)for(h=0;h<g.length;h++){n=this.comments[j+h];var p=g[h];if(n.start!==p.start||n.end!==p.end||
n.type!==p.type){o=!0;break}}h=[j,k-j].concat(g);Array.prototype.splice.apply(this.comments,h);o&&(h=i,n=m,a!==f&&(h=a.mapOffset(h,!0),n=a.mapOffset(n,!0)),e.redrawRange(h,n));if(this.foldingEnabled&&f!==a&&this.annotationModel){e=this.annotationModel;j=e.getAnnotations(i,m);i=[];for(m=[];j.hasNext();)if(n=j.next(),n.type===s.AnnotationType.ANNOTATION_FOLDING){m.push(n);for(h=0;h<g.length;h++)if(n.start===g[h].start&&n.end===g[h].end)break;h===g.length?(i.push(n),n.expand()):(h=n.start,k=n.end,h>
b&&(h-=d),k>b&&(k-=d),h<=b&&b<k&&h<=c&&c<k&&(h=f.getLineAtOffset(n.start),k=f.getLineAtOffset(n.end),h!==k?n.expanded||(n.expand(),e.modifyAnnotation(n)):e.removeAnnotation(n)))}b=[];for(h=0;h<g.length;h++){n=g[h];for(d=0;d<m.length;d++)if(m[d].start===n.start&&m[d].end===n.end)break;d===m.length&&(n=this._createFoldingAnnotation(a,f,n.start,n.end))&&b.push(n)}e.replaceAnnotations(i,b)}}};return{TextStyler:e}});
define("orion/editor/edit","orion/editor/textView,orion/editor/textModel,orion/editor/textTheme,orion/editor/projectionTextModel,orion/editor/eventTarget,orion/keyBinding,orion/editor/rulers,orion/editor/annotations,orion/editor/tooltip,orion/editor/undoStack,orion/editor/textDND,orion/editor/editor,orion/editor/editorFeatures,orion/editor/contentAssist,orion/editor/cssContentAssist,orion/editor/htmlContentAssist,orion/editor/jsTemplateContentAssist,orion/editor/AsyncStyler,orion/editor/mirror,orion/editor/textMateStyler,orion/editor/htmlGrammar,examples/editor/textStyler".split(","),function(s,
q,p,i,c,e,f,g,b,a,h,o,m,n,r,u,t,d,k,j,v,l){function y(a){var b=a.firstChild;if(b&&b.tagName==="TEXTAREA")return b.value;var b=a.ownerDocument,c=b.defaultView||b.parentWindow;if(!c.getSelection)return a.innerText||a.textContent;b=b.createRange();b.selectNode(a);var a=c.getSelection(),c=[],d;for(d=0;d<a.rangeCount;d++)c.push(a.getRangeAt(d));a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(d=0;d<c.length;d++)a.addRange(c[d]);return b}function B(a){if(a.substring(0,12)==="data-editor-")return a=
a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function G(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function K(a,b){var c={};G(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);var h=B(d.nodeName);if(h){d=d.nodeValue;if(d==="true"||d==="false")d=d==="true";c[h]=d}}return c}function A(a){var b=a.ownerDocument,b=b.defaultView||b.parentWindow,c;if(b.getComputedStyle)c=b.getComputedStyle(a,null).getPropertyValue("height");else if(a.currentStyle)c=
a.currentStyle.height;return parseInt(c,10)||0}function H(a){var b=a.parent;b||(b="editor");typeof b==="string"&&(b=(a.document||document).getElementById(b));if(!b&&a.className){var c=(a.document||document).getElementsByClassName(a.className);if(c){a.className=void 0;for(var d=[],e=0;e<c.length;e++)a.parent=c[e],d.push(H(a));return d}}if(!b)throw"no parent";a=K(b,a);if(typeof a.theme==="string"){var c=p.TextTheme.getTheme(a.theme),e=a.theme.lastIndexOf("/"),f=a.theme;e!==-1&&(f=f.substring(e+1));
f.substring(f.length-4)===".css"&&(f=f.substring(0,f.length-4));c.setThemeClass(f,{href:a.theme});a.theme=c}var g;a.readonly||(d={createContentAssistMode:function(a){g=new n.ContentAssist(a.getTextView());a=new n.ContentAssistWidget(g);return new n.ContentAssistMode(g,a)}});d=new o.Editor({textViewFactory:function(){return new s.TextView({parent:b,model:new i.ProjectionTextModel(new q.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,
expandTab:a.expandTab,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode})},undoStackFactory:new m.UndoFactory,annotationFactory:new m.AnnotationFactory,lineNumberRulerFactory:new m.LineNumberRulerFactory,foldingRulerFactory:new m.FoldingRulerFactory,textDNDFactory:new m.TextDNDFactory,contentAssistFactory:d,keyBindingFactory:function(a,b,c,d){var e=new m.TextActions(a,c);b.push(e);a=new m.SourceCodeActions(a,c,d);b.push(a)},statusReporter:a.statusReporter,domNode:b});c=a.contents;c===void 0&&
(c=y(b));c||(c="");d.installTextView();d.setLineNumberRulerVisible(a.showLinesRuler===void 0||a.showLinesRuler);d.setAnnotationRulerVisible(a.showAnnotationRuler===void 0||a.showFoldingRuler);d.setOverviewRulerVisible(a.showOverviewRuler===void 0||a.showOverviewRuler);d.setFoldingRulerVisible(a.showFoldingRuler===void 0||a.showFoldingRuler);d.setInput(a.title,null,c);({styler:null,highlight:function(b,c){if(this.styler)this.styler.destroy(),this.styler=null;if(b){var d=c.getTextView(),e=c.getAnnotationModel();
switch(b){case "js":case "java":case "css":this.styler=new l.TextStyler(d,b,e);c.setFoldingRulerVisible(a.showFoldingRuler===void 0||a.showFoldingRuler);break;case "html":this.styler=new j.TextMateStyler(d,new v.HtmlGrammar)}}}}).highlight(a.lang,d);if(g){var h=new r.CssContentAssistProvider,k=new t.JSTemplateContentAssistProvider;g.addEventListener("Activating",function(){/css$/.test(a.lang)?g.setProviders([h]):/js$/.test(a.lang)&&g.setProviders([k])})}if(A(b)<=50)c=d.getTextView().computeSize().height,
b.style.height=c+"px";return d}var I=this.orion?this.orion.editor:void 0;if(I)for(var E=0;E<arguments.length;E++)G(I,arguments[E]);return H});var orion=this.orion||(this.orion={}),editor=orion.editor||(orion.editor={});editor.edit=require("orion/editor/edit");